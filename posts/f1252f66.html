<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>ETH Zurich：数字设计与计算机体系结构 | old-driver-zeroの小屋</title><meta name="author" content="old_driver_zero"><meta name="copyright" content="old_driver_zero"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="引言与基础 Introduction and Basics 当前的四大方向：  安全 节省能源 低延时和可预测 AI&#x2F;ML，生物，医疗，健康等的专属硬件  课程高层次目标：  了解基础 原则 惯例  基于此：  了解计算机工作 权衡不同的设计和思想 实现基于原则的硬件 在越来越复杂的系统中 debug 开发新颖的、开箱即用的设计  这些 DDCA 的原">
<meta property="og:type" content="article">
<meta property="og:title" content="ETH Zurich：数字设计与计算机体系结构">
<meta property="og:url" content="https://old-driver-zero.github.io/posts/f1252f66.html">
<meta property="og:site_name" content="old-driver-zeroの小屋">
<meta property="og:description" content="引言与基础 Introduction and Basics 当前的四大方向：  安全 节省能源 低延时和可预测 AI&#x2F;ML，生物，医疗，健康等的专属硬件  课程高层次目标：  了解基础 原则 惯例  基于此：  了解计算机工作 权衡不同的设计和思想 实现基于原则的硬件 在越来越复杂的系统中 debug 开发新颖的、开箱即用的设计  这些 DDCA 的原">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://old-driver-zero.github.io/gallery/cover/ETH%20Zurich%EF%BC%9A%E6%95%B0%E5%AD%97%E8%AE%BE%E8%AE%A1%E4%B8%8E%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84.webp">
<meta property="article:published_time" content="2023-10-25T00:32:28.742Z">
<meta property="article:modified_time" content="2023-12-09T00:29:34.747Z">
<meta property="article:author" content="old_driver_zero">
<meta property="article:tag" content="体系结构">
<meta property="article:tag" content="计算机科学">
<meta property="article:tag" content="ETH Zurich">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://old-driver-zero.github.io/gallery/cover/ETH%20Zurich%EF%BC%9A%E6%95%B0%E5%AD%97%E8%AE%BE%E8%AE%A1%E4%B8%8E%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84.webp"><link rel="shortcut icon" href="/illustration/favicon.ico"><link rel="canonical" href="https://old-driver-zero.github.io/posts/f1252f66.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//hm.baidu.com"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?da75f0595ffd5e578744142f5a6a471e";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"GY5EJYJ1FS","apiKey":"c443c952672ec7062840aac45536181e","indexName":"blog","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ETH Zurich：数字设计与计算机体系结构',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-12-09 08:29:34'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="//at.alicdn.com/t/c/font_4031045_8r6cr7hwlv.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/highlight.css"><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/scrollbar.css"><link rel="stylesheet" href="/css/barber-shop.css"><link rel="stylesheet" href="/css/navigation bar.css"><link rel="stylesheet" href="/css/article title.css"><link rel="stylesheet" href="/css/card author.css"><link rel="stylesheet" href="/css/transpancy.css"><script src="/js/echarts.min.js"></script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css">
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.0.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style><link rel="alternate" href="/atom.xml" title="old-driver-zeroの小屋" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

document.addEventListener('pjax:send', () => {
  Pace.restart()
})
</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><!-- hexo injector body_end start --><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --></body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/%E5%A4%B4%E5%83%8F_%E7%81%B0%E5%A4%AA%E7%8B%BC.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">99</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">156</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fa-fw icon-shouye-01"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shouye-01"/></svg><span> 首页</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/archives/"><i class="fa-fw icon-guidang"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-guidang"/></svg><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/tags/"><i class="fa-fw icon-a-16-01-01"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-a-16-01-01"/></svg><span> 标签</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/categories/"><i class="fa-fw icon-wenjianjia"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-wenjianjia"/></svg><span> 分类</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/anime/"><i class="fa-fw icon-zhifeiji"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-zhifeiji"/></svg><span> 二次元</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/gallery/"><i class="fa-fw icon-xiangce"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xiangce"/></svg><span> 画廊</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><i class="fa-fw icon-guanyu"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-guanyu"/></svg><span> 关于</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/charts/"><i class="fa-fw icon-tongjichaxun"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tongjichaxun"/></svg><span> 统计</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/comments/"><i class="fa-fw icon-liuyan"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-liuyan"/></svg><span> 留言板</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/random/"><i class="fa-fw icon-suiji"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-suiji"/></svg><span> 随便逛逛</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/gallery/cover/ETH%20Zurich%EF%BC%9A%E6%95%B0%E5%AD%97%E8%AE%BE%E8%AE%A1%E4%B8%8E%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84.webp')"><nav id="nav"><span id="blog-info"><a href="/" title="old-driver-zeroの小屋"><span class="site-name">old-driver-zeroの小屋</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><i class="fa-fw icon-shouye-01"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shouye-01"/></svg><span> 首页</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/archives/"><i class="fa-fw icon-guidang"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-guidang"/></svg><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/tags/"><i class="fa-fw icon-a-16-01-01"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-a-16-01-01"/></svg><span> 标签</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/categories/"><i class="fa-fw icon-wenjianjia"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-wenjianjia"/></svg><span> 分类</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/anime/"><i class="fa-fw icon-zhifeiji"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-zhifeiji"/></svg><span> 二次元</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/gallery/"><i class="fa-fw icon-xiangce"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-xiangce"/></svg><span> 画廊</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><i class="fa-fw icon-guanyu"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-guanyu"/></svg><span> 关于</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/charts/"><i class="fa-fw icon-tongjichaxun"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tongjichaxun"/></svg><span> 统计</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/comments/"><i class="fa-fw icon-liuyan"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-liuyan"/></svg><span> 留言板</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/random/"><i class="fa-fw icon-suiji"></i><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-suiji"/></svg><span> 随便逛逛</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ETH Zurich：数字设计与计算机体系结构</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><svg class="meta_icon post-ui-icon" style="width:16px;height:16px;position:relative;top:3px"><use xlink:href="#icon-rili"/></svg><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-10-25T00:32:28.742Z" title="发表于 2023-10-25 08:32:28">2023-10-25</time><span class="post-meta-separator">|</span><svg class="meta_icon post-ui-icon" style="width:13px;height:13px;position:relative;top:2px"><use xlink:href="#icon-gengxin"/></svg><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-12-09T00:29:34.747Z" title="更新于 2023-12-09 08:29:34">2023-12-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><a class="faa-parent animated-hover"></a><svg class="meta_icon post-ui-icon" style="width:13px;height:13px;position:relative;top:2px"><use xlink:href="#icon-fenlei"/></svg><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><svg class="meta_icon post-ui-icon" style="width:16px;height:16px;position:relative;top:3px"><use xlink:href="#icon-word"/></svg><span class="post-meta-label">字数总计:</span><span class="word-count">1.3w</span><span class="post-meta-separator">|</span><svg class="meta_icon post-ui-icon" style="width:16px;height:16px;position:relative;top:3px"><use xlink:href="#icon-shizhong"/></svg><span class="post-meta-label">阅读时长:</span><span>40分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="引言与基础-introduction-and-basics">引言与基础 Introduction and
Basics</h1>
<p>当前的四大方向：</p>
<ul>
<li>安全</li>
<li>节省能源</li>
<li>低延时和可预测</li>
<li>AI/ML，生物，医疗，健康等的专属硬件</li>
</ul>
<p>课程高层次目标：</p>
<ul>
<li>了解基础</li>
<li>原则</li>
<li>惯例</li>
</ul>
<p>基于此：</p>
<ul>
<li>了解计算机工作</li>
<li>权衡不同的设计和思想</li>
<li>实现基于原则的硬件</li>
<li>在越来越复杂的系统中 debug</li>
<li>开发新颖的、开箱即用的设计</li>
</ul>
<p>这些 DDCA 的原则有利于：</p>
<ul>
<li>设计更好的硬件、软件、系统</li>
<li>设计中更好地取舍</li>
<li>了解计算机工作原理</li>
<li>并行、批判性思考</li>
</ul>
<p>最重要的是：</p>
<blockquote>
<p>Learning is for life, while exam study is until you pass.</p>
</blockquote>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/计算机体系结构.webp" alt="计算机体系结构">
<figcaption aria-hidden="true">计算机体系结构</figcaption>
</figure>
<p>机会在底层</p>
<p>内存中的问题：</p>
<ul>
<li>row hammer</li>
<li>meltdown and spectre</li>
<li>data movement</li>
</ul>
<h1 id="权衡指标-tradeoffs-metrics">权衡，指标 Tradeoffs, Metrics</h1>
<p>数据移动消耗了大量的能源，尤其是在机器学习中</p>
<p>新的计算范式（重新思考整个栈）：</p>
<ul>
<li>在内存中处理，在数据边处理</li>
<li>量子计算</li>
<li>安全与可靠计算机</li>
</ul>
<p>新的加速单元与系统（算法-硬件协同设计）：</p>
<ul>
<li>AI &amp; ML</li>
<li>图 &amp; 数据分析，视觉，视频</li>
<li>生物分析</li>
</ul>
<p>新的内存，存储系统，联系，设备：</p>
<ul>
<li>非易失性内存，智能内存系统，量子</li>
<li>高速连接，分离式系统</li>
</ul>
<p>两个课程的主要目标：</p>
<ul>
<li>批判性思考</li>
<li>广阔思考</li>
</ul>
<p>建筑</p>
<ul>
<li>总是从基本的建筑块和设计原则开始</li>
<li>如何使用、应用、增强的知识</li>
<li>潜在的技术可能会改变
<ul>
<li>但是利用技术的方法有相似之处</li>
<li>用于该设计的方法依赖于原则</li>
</ul></li>
</ul>
<p>一般用途和特殊用途的处理器</p>
<h1 id="组合逻辑电路-combinational-logic">组合逻辑电路 Combinational
Logic</h1>
<p>计算机用大量的<strong>晶体管 transistors</strong> 组成</p>
<p>MOS：用导体 Conductor(<strong>M</strong>etal)，绝缘体
Insulators(<strong>O</strong>xide)，和半导体
<strong>S</strong>emiconductors 组成</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/MOS.webp" alt="MOS">
<figcaption aria-hidden="true">MOS</figcaption>
</figure>
<p>有两种类型的 MOS 晶体管：n 类型和 p 类型</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/晶体管.webp" alt="两种类型的晶体管">
<figcaption aria-hidden="true">两种类型的晶体管</figcaption>
</figure>
<ul>
<li>如果 <strong>n 类型</strong>的晶体管的 gate
被施加<strong>高</strong>电压，则从 source 到 drain
的连接像导线一样。基于技术，高电压可能从 0.3V 到 3V</li>
<li>如果 <strong>n 类型</strong>的晶体管的 gate
被施加<strong>零</strong>电压，则 source 到 drain 的连接破坏了</li>
</ul>
<p>p 类型的晶体管工作和 n 类型的相反</p>
<ul>
<li><strong>p</strong> 类型：pull u<strong>p</strong></li>
<li><strong>n</strong> 类型：pull dow<strong>n</strong></li>
</ul>
<p>现代的计算机同时使用两种晶体管，即
<strong>CMOS</strong>（Complementary MOS）技术</p>
<p>最简单的门：</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/非门.webp" alt="非门">
<figcaption aria-hidden="true">非门</figcaption>
</figure>
<p>更复杂一点的门：</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/NAND门.webp" alt="NAND门">
<figcaption aria-hidden="true">NAND门</figcaption>
</figure>
<p>可以使用 NOT 和 NAND 门 组成 AND 门</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/与门.webp" alt="与门">
<figcaption aria-hidden="true">与门</figcaption>
</figure>
<p>注意 AND 门至少要用 6 个晶体管，而 NAND 反而只要 4 个晶体管，因为
CMOS 是反相的</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/CMOS门结构.webp" alt="CMOS门结构">
<figcaption aria-hidden="true">CMOS门结构</figcaption>
</figure>
<ul>
<li><p>当晶体管<strong>并联 Parallel</strong>
时，<strong>一个</strong>晶体管 ON，整个电路 ON</p></li>
<li><p>当晶体管<strong>串联 series</strong>
时，<strong>所有</strong>晶体管 ON，整个电路 ON</p></li>
<li><p>如果两个网络都 ON，则<strong>短路</strong></p></li>
<li><p>如果两个网络都 OFF，则输出<strong>浮动
floating</strong>，无法确定</p></li>
</ul>
<p>MOS 晶体管是<strong>不完美</strong>的开关</p>
<ul>
<li>pMOS 擅长传递 1 而不擅长 0</li>
<li>nMOS 擅长传递 0 而不擅长 1</li>
</ul>
<p>动态功率：<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.464ex;" xmlns="http://www.w3.org/2000/svg" width="9.346ex" height="2.351ex" role="img" focusable="false" viewbox="0 -833.9 4130.9 1038.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"/></g><g data-mml-node="mi" transform="translate(760,0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"/></g><g data-mml-node="msup" transform="translate(1538,0)"><g data-mml-node="mi"><path data-c="1D449" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"/></g><g data-mml-node="mn" transform="translate(861.3,363) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g></g><g data-mml-node="mi" transform="translate(2802.9,0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"/></g><g data-mml-node="mi" transform="translate(3580.9,0)"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"/></g></g></g></svg></mjx-container></span></p>
<ul>
<li>C = 电路电容量</li>
<li>V = 提供的电压</li>
<li>f = 电容器改变的频率</li>
</ul>
<p>静态功率：<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.667ex;" xmlns="http://www.w3.org/2000/svg" width="9.94ex" height="2.213ex" role="img" focusable="false" viewbox="0 -683 4393.6 978"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D449" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"/></g><g data-mml-node="mi" transform="translate(769,0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"/></g><g data-mml-node="msub" transform="translate(1547,0)"><g data-mml-node="mi"><path data-c="1D43C" d="M43 1Q26 1 26 10Q26 12 29 24Q34 43 39 45Q42 46 54 46H60Q120 46 136 53Q137 53 138 54Q143 56 149 77T198 273Q210 318 216 344Q286 624 286 626Q284 630 284 631Q274 637 213 637H193Q184 643 189 662Q193 677 195 680T209 683H213Q285 681 359 681Q481 681 487 683H497Q504 676 504 672T501 655T494 639Q491 637 471 637Q440 637 407 634Q393 631 388 623Q381 609 337 432Q326 385 315 341Q245 65 245 59Q245 52 255 50T307 46H339Q345 38 345 37T342 19Q338 6 332 0H316Q279 2 179 2Q143 2 113 2T65 2T43 1Z"/></g><g data-mml-node="TeXAtom" transform="translate(473,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"/></g><g data-mml-node="mi" transform="translate(298,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"/></g><g data-mml-node="mi" transform="translate(764,0)"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"/></g><g data-mml-node="mi" transform="translate(1293,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g><g data-mml-node="mi" transform="translate(1814,0)"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"/></g><g data-mml-node="mi" transform="translate(2343,0)"><path data-c="1D454" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"/></g><g data-mml-node="mi" transform="translate(2820,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"/></g></g></g></g></g></svg></mjx-container></span></p>
<p>维持摩尔定律的方法：创新</p>
<ul>
<li>制造更小的晶体管/结构</li>
<li>寻找更好性质的材料</li>
<li>更精密的制造</li>
<li>新设备技术</li>
</ul>
<p><strong>组合逻辑 Combinational Logic</strong>：</p>
<ul>
<li>无记忆</li>
<li>输出严格依赖于<strong>当前</strong>输入的组合</li>
<li>输入的函数规范</li>
</ul>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/德摩根律.webp" alt="德摩根律">
<figcaption aria-hidden="true">德摩根律</figcaption>
</figure>
<p>布尔代数的用途：</p>
<ul>
<li>表达组合逻辑块的函数</li>
<li>化简函数</li>
</ul>
<p>用真值表简单、通用的表达布尔函数的方法：</p>
<ul>
<li><strong>Sum of Products</strong> 形式：所有导致输出为
<strong>1</strong> 的<strong>极小项</strong>的和</li>
<li><strong>Product of Sums</strong> 形式：导致输出为 0
的<strong>极大项</strong>的积</li>
</ul>
<p><strong>解码器 Decoder</strong></p>
<ul>
<li>输入模式检查</li>
<li>n 输入 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="2.279ex" height="1.528ex" role="img" focusable="false" viewbox="0 -675.5 1007.3 675.5"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="mi" transform="translate(533,363) scale(0.707)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"/></g></g></g></g></svg></mjx-container></span> 输出</li>
<li>一个输出为 1，其余为 0</li>
<li>为 1 的输出对于输入匹配</li>
</ul>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/decoder.webp" alt="decoder">
<figcaption aria-hidden="true">decoder</figcaption>
</figure>
<p>decoder 对于确定如何解释一个 bit
模式很有用，如内存地址、程序指令等</p>
<p><strong>选择器 Multiplexer</strong>：选择 N
个输入之一连接到输出，基于 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.546ex;" xmlns="http://www.w3.org/2000/svg" width="6.265ex" height="2.116ex" role="img" focusable="false" viewbox="0 -694 2769.2 935.4"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"/><path data-c="6F" d="M28 214Q28 309 93 378T250 448Q340 448 405 380T471 215Q471 120 407 55T250 -10Q153 -10 91 57T28 214ZM250 30Q372 30 372 193V225V250Q372 272 371 288T364 326T348 362T317 390T268 410Q263 411 252 411Q222 411 195 399Q152 377 139 338T126 246V226Q126 130 145 91Q177 30 250 30Z" transform="translate(278,0)"/><path data-c="67" d="M329 409Q373 453 429 453Q459 453 472 434T485 396Q485 382 476 371T449 360Q416 360 412 390Q410 404 415 411Q415 412 416 414V415Q388 412 363 393Q355 388 355 386Q355 385 359 381T368 369T379 351T388 325T392 292Q392 230 343 187T222 143Q172 143 123 171Q112 153 112 133Q112 98 138 81Q147 75 155 75T227 73Q311 72 335 67Q396 58 431 26Q470 -13 470 -72Q470 -139 392 -175Q332 -206 250 -206Q167 -206 107 -175Q29 -140 29 -75Q29 -39 50 -15T92 18L103 24Q67 55 67 108Q67 155 96 193Q52 237 52 292Q52 355 102 398T223 442Q274 442 318 416L329 409ZM299 343Q294 371 273 387T221 404Q192 404 171 388T145 343Q142 326 142 292Q142 248 149 227T179 192Q196 182 222 182Q244 182 260 189T283 207T294 227T299 242Q302 258 302 292T299 343ZM403 -75Q403 -50 389 -34T348 -11T299 -2T245 0H218Q151 0 138 -6Q118 -15 107 -34T95 -74Q95 -84 101 -97T122 -127T170 -155T250 -167Q319 -167 361 -139T403 -75Z" transform="translate(778,0)"/></g><g data-mml-node="mn" transform="translate(1311,-241.4) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g></g><g data-mml-node="mo" transform="translate(1714.6,0)"><path data-c="2061" d=""/></g><g data-mml-node="mi" transform="translate(1881.2,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g></g></g></svg></mjx-container></span>
bit 的控制位</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/mux.webp" alt="mux">
<figcaption aria-hidden="true">mux</figcaption>
</figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/mux2.webp"></p>
<p>选择器可以作为实现逻辑函数的查询表</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/使用Mux实现逻辑函数1.webp"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/使用Mux实现逻辑函数2.webp"></p>
<p>decoder 可以使用或门建造逻辑函数（类似于 SOP 形式）</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/使用decoder实现逻辑函数.webp" alt="使用decoder实现逻辑函数">
<figcaption aria-hidden="true">使用decoder实现逻辑函数</figcaption>
</figure>
<p>全加器：</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/全加器.webp" alt="全加器">
<figcaption aria-hidden="true">全加器</figcaption>
</figure>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/顺序全加器.webp" alt="顺序全加器">
<figcaption aria-hidden="true">顺序全加器</figcaption>
</figure>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/多位并行全加器.webp" alt="多位并行全加器">
<figcaption aria-hidden="true">多位并行全加器</figcaption>
</figure>
<p><strong>可编程逻辑阵列 Programmable Logic Array(PLA)</strong></p>
<ul>
<li>AND 和 OR 门的阵列</li>
<li>使用 SOP 实现任何逻辑函数</li>
</ul>
<p>FPGA 就使用了其中的一部分技术</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/PLA.webp" alt="PLA">
<figcaption aria-hidden="true">PLA</figcaption>
</figure>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/等值检查器.webp" alt="等值检查器">
<figcaption aria-hidden="true">等值检查器</figcaption>
</figure>
<p>将一些算术和逻辑操作组合到一起形成 <strong>ALU</strong></p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/ALU.webp" alt="ALU">
<figcaption aria-hidden="true">ALU</figcaption>
</figure>
<p><strong>三态门 tri-state buffer</strong></p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/三态门.webp" alt="三态门">
<figcaption aria-hidden="true">三态门</figcaption>
</figure>
<p>类似于一个开关</p>
<p>可用于控制总线上的设备：</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/总线.webp" alt="总线">
<figcaption aria-hidden="true">总线</figcaption>
</figure>
<p>可以使用三态门制造 Mux：</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/三态门实现Mux.webp" alt="三态门实现Mux">
<figcaption aria-hidden="true">三态门实现Mux</figcaption>
</figure>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/三态门的晶体管实现.webp" alt="三态门的晶体管实现">
<figcaption aria-hidden="true">三态门的晶体管实现</figcaption>
</figure>
<p>化简的关键工具：<strong>联合定理 Uniting theorem</strong>：<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="19.019ex" height="2.299ex" role="img" focusable="false" viewbox="0 -934 8406.6 1016"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"/></g><g data-mml-node="mo" transform="translate(1026.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mi" transform="translate(2082.6,0)"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"/></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(2832.6,0)"><g data-mml-node="mover"><g data-mml-node="mi"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g><g data-mml-node="mo" transform="translate(462.8,244) translate(-250 0)"><path data-c="AF" d="M69 544V590H430V544H69Z"/></g></g></g><g data-mml-node="mo" transform="translate(3813.8,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"/></g><g data-mml-node="mi" transform="translate(4814,0)"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"/></g><g data-mml-node="mi" transform="translate(5564,0)"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g><g data-mml-node="mo" transform="translate(6600.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mi" transform="translate(7656.6,0)"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"/></g></g></g></svg></mjx-container></span>，即如果 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.717ex" height="1.545ex" role="img" focusable="false" viewbox="0 -683 759 683"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g></g></g></svg></mjx-container></span> 和 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="1.717ex" height="2.113ex" role="img" focusable="false" viewbox="0 -934 759 934"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="mover"><g data-mml-node="mi"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"/></g><g data-mml-node="mo" transform="translate(462.8,244) translate(-250 0)"><path data-c="AF" d="M69 544V590H430V544H69Z"/></g></g></g></g></g></svg></mjx-container></span> 同时出现，则可以消去</p>
<p>优先电路</p>
<ul>
<li>输入：有优先级的请求</li>
<li>输出：授予每个请求信号</li>
</ul>
<p><strong>卡诺图 Karnaugh
Map</strong>：是一个化简的可视化方法，然而在实际中意义不大，因为无法处理六维或更高维度的数据</p>
<h1 id="时序逻辑设计-sequential-logic-design">时序逻辑设计 Sequential
Logic Design</h1>
<p>相互耦合的反相器：有两个稳定的状态：Q = 0 和 Q = 1，但是无法设置
Q</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/相互耦合的反相器.webp" alt="相互耦合的反相器">
<figcaption aria-hidden="true">相互耦合的反相器</figcaption>
</figure>
<p>SRAM 是一种改进方式，但是两边的晶体管并不稳定</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/SRAM.webp" alt="SRAM">
<figcaption aria-hidden="true">SRAM</figcaption>
</figure>
<p>存储元素：</p>
<ul>
<li>锁存器和触发器</li>
<li>SRAM</li>
<li>DRAM</li>
<li>闪存，硬盘，磁带</li>
</ul>
<p>速度减小，成本降低，所以有了内存层次结构</p>
<p><strong>R-S 锁存器 Reset-Set Latch</strong>：</p>
<ul>
<li>稳定状态下，S 和 R 都为 1</li>
<li>S：若 S 为 0，则设 Q 为 1</li>
<li>R：若 R 为 0，则该 Q 为 0</li>
<li>S 和 R 不能同时为 0，因为破坏了不变式 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.439ex;" xmlns="http://www.w3.org/2000/svg" width="7.225ex" height="2.156ex" role="img" focusable="false" viewbox="0 -759 3193.2 953"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D444" d="M399 -80Q399 -47 400 -30T402 -11V-7L387 -11Q341 -22 303 -22Q208 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435Q740 255 592 107Q529 47 461 16L444 8V3Q444 2 449 -24T470 -66T516 -82Q551 -82 583 -60T625 -3Q631 11 638 11Q647 11 649 2Q649 -6 639 -34T611 -100T557 -165T481 -194Q399 -194 399 -87V-80ZM636 468Q636 523 621 564T580 625T530 655T477 665Q429 665 379 640Q277 591 215 464T153 216Q153 110 207 59Q231 38 236 38V46Q236 86 269 120T347 155Q372 155 390 144T417 114T429 82T435 55L448 64Q512 108 557 185T619 334T636 468ZM314 18Q362 18 404 39L403 49Q399 104 366 115Q354 117 347 117Q344 117 341 117T337 118Q317 118 296 98T274 52Q274 18 314 18Z"/></g><g data-mml-node="mo" transform="translate(1068.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mo" transform="translate(1846.8,0)"><path data-c="21" d="M78 661Q78 682 96 699T138 716T180 700T199 661Q199 654 179 432T158 206Q156 198 139 198Q121 198 119 206Q118 209 98 431T78 661ZM79 61Q79 89 97 105T141 121Q164 119 181 104T198 61Q198 31 181 16T139 1Q114 1 97 16T79 61Z"/></g><g data-mml-node="msup" transform="translate(2124.8,0)"><g data-mml-node="mi"><path data-c="1D444" d="M399 -80Q399 -47 400 -30T402 -11V-7L387 -11Q341 -22 303 -22Q208 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435Q740 255 592 107Q529 47 461 16L444 8V3Q444 2 449 -24T470 -66T516 -82Q551 -82 583 -60T625 -3Q631 11 638 11Q647 11 649 2Q649 -6 639 -34T611 -100T557 -165T481 -194Q399 -194 399 -87V-80ZM636 468Q636 523 621 564T580 625T530 655T477 665Q429 665 379 640Q277 591 215 464T153 216Q153 110 207 59Q231 38 236 38V46Q236 86 269 120T347 155Q372 155 390 144T417 114T429 82T435 55L448 64Q512 108 557 185T619 334T636 468ZM314 18Q362 18 404 39L403 49Q399 104 366 115Q354 117 347 117Q344 117 341 117T337 118Q317 118 296 98T274 52Q274 18 314 18Z"/></g><g data-mml-node="TeXAtom" transform="translate(824,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z"/></g></g></g></g></g></svg></mjx-container></span>，<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.439ex;" xmlns="http://www.w3.org/2000/svg" width="1.79ex" height="2.032ex" role="img" focusable="false" viewbox="0 -704 791 898"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D444" d="M399 -80Q399 -47 400 -30T402 -11V-7L387 -11Q341 -22 303 -22Q208 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435Q740 255 592 107Q529 47 461 16L444 8V3Q444 2 449 -24T470 -66T516 -82Q551 -82 583 -60T625 -3Q631 11 638 11Q647 11 649 2Q649 -6 639 -34T611 -100T557 -165T481 -194Q399 -194 399 -87V-80ZM636 468Q636 523 621 564T580 625T530 655T477 665Q429 665 379 640Q277 591 215 464T153 216Q153 110 207 59Q231 38 236 38V46Q236 86 269 120T347 155Q372 155 390 144T417 114T429 82T435 55L448 64Q512 108 557 185T619 334T636 468ZM314 18Q362 18 404 39L403 49Q399 104 366 115Q354 117 347 117Q344 117 341 117T337 118Q317 118 296 98T274 52Q274 18 314 18Z"/></g></g></g></svg></mjx-container></span> 和 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.439ex;" xmlns="http://www.w3.org/2000/svg" width="2.417ex" height="2.156ex" role="img" focusable="false" viewbox="0 -759 1068.5 953"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mi"><path data-c="1D444" d="M399 -80Q399 -47 400 -30T402 -11V-7L387 -11Q341 -22 303 -22Q208 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435Q740 255 592 107Q529 47 461 16L444 8V3Q444 2 449 -24T470 -66T516 -82Q551 -82 583 -60T625 -3Q631 11 638 11Q647 11 649 2Q649 -6 639 -34T611 -100T557 -165T481 -194Q399 -194 399 -87V-80ZM636 468Q636 523 621 564T580 625T530 655T477 665Q429 665 379 640Q277 591 215 464T153 216Q153 110 207 59Q231 38 236 38V46Q236 86 269 120T347 155Q372 155 390 144T417 114T429 82T435 55L448 64Q512 108 557 185T619 334T636 468ZM314 18Q362 18 404 39L403 49Q399 104 366 115Q354 117 347 117Q344 117 341 117T337 118Q317 118 296 98T274 52Q274 18 314 18Z"/></g><g data-mml-node="TeXAtom" transform="translate(824,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z"/></g></g></g></g></g></svg></mjx-container></span> 振荡，进入<strong>亚稳态
metastability</strong></li>
</ul>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/RS锁存器.webp" alt="RS锁存器">
<figcaption aria-hidden="true">RS锁存器</figcaption>
</figure>
<p>为了保证 R-S 锁存器的操作正确，使用<strong>门锁 D 锁存器 gated D
latch</strong></p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/门锁D锁存器.webp" alt="门锁D锁存器">
<figcaption aria-hidden="true">门锁D锁存器</figcaption>
</figure>
<p>当 WE 为 1 时，Q 取 D 的值。S 和 R 不会同时为 0</p>
<p><strong>寄存器 register</strong>：用多个 D latch 表示多个位</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/寄存器.webp" alt="寄存器">
<figcaption aria-hidden="true">寄存器</figcaption>
</figure>
<p><strong>内存 Memory</strong> 是地址的组合</p>
<p>对内存输出使用一个 Mux 读内存：</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/Mux读内存.webp" alt="Mux读内存">
<figcaption aria-hidden="true">Mux读内存</figcaption>
</figure>
<p>对输入内存使用一个 decoder 写内存：</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/写内存.webp" alt="写内存">
<figcaption aria-hidden="true">写内存</figcaption>
</figure>
<p>组合起来添加更多寄存器得到内存：</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/更大的内存阵列.webp" alt="更大的内存阵列">
<figcaption aria-hidden="true">更大的内存阵列</figcaption>
</figure>
<p>基于内存的查找表（可以用来实现逻辑函数）：</p>
<ul>
<li>每个地址：真值表中的行</li>
<li>每个数据位：相关的输出数据</li>
</ul>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/内存实现逻辑函数.webp" alt="内存实现逻辑函数">
<figcaption aria-hidden="true">内存实现逻辑函数</figcaption>
</figure>
<p><strong>查找表 Lookup Table(LUT)</strong> 广泛应用于 FPGA 中</p>
<p>我们已经设计了能够<strong>存储信息</strong>的电路，可以用其实现<strong>记忆过去</strong>的输入的电路</p>
<p>一个系统的<strong>状态 state</strong>
是那个时刻所有相关元素的快照</p>
<p>顺序锁是一个<strong>异步 asynchronous</strong>
的机器：当状态转移发生时就发生</p>
<p>现代计算机都是<strong>同步 synchronous</strong>
机器：在固定单位时间后状态转移才会发生</p>
<p>使用一个<strong>时钟 clock</strong> 决定何时改变状态，时钟信号交替 0
和 1</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/时钟.webp" alt="时钟">
<figcaption aria-hidden="true">时钟</figcaption>
</figure>
<p>在一个时钟周期的<strong>开始</strong>，系统状态改变</p>
<p>同步控制更容易正确，而异步控制更高效</p>
<p><strong>有限状态机 Finite State Machine(FSM)</strong></p>
<ul>
<li>一个状态系统的<strong>离散时间模型</strong></li>
<li>每个状态表示系统在一个给定时间的快照</li>
</ul>
<p>FSM 图形化：</p>
<ul>
<li>一个系统所有可能的状态</li>
<li>系统如何从一个状态转移到另一个</li>
</ul>
<p>一个有限状态机有三个部分组成：</p>
<ul>
<li>下一个状态逻辑</li>
<li>状态寄存器</li>
<li>输出逻辑</li>
</ul>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/有限状态机.webp" alt="有限状态机">
<figcaption aria-hidden="true">有限状态机</figcaption>
</figure>
<p>状态寄存器的两个性质：</p>
<ul>
<li>在每个时钟周期<strong>开始</strong>时存储数据</li>
<li>数据在<strong>整个</strong>时钟周期可用</li>
</ul>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/D触发器.webp" alt="D触发器">
<figcaption aria-hidden="true">D触发器</figcaption>
</figure>
<p><strong>上升沿</strong>触发的触发器</p>
<ul>
<li><strong>触发器 flip-flop</strong>
叫做<strong>边缘触发</strong>的状态元素</li>
<li>锁存器是<strong>电平触发</strong>的状态元素</li>
</ul>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/基于D触发器的寄存器.webp" alt="基于D触发器的寄存器">
<figcaption aria-hidden="true">基于D触发器的寄存器</figcaption>
</figure>
<p>两种有限状态机：</p>
<ul>
<li>Moore FSM：输出仅取决于当前状态</li>
<li>Mealy FSM：输出取决于当前状态和输入</li>
</ul>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/两种有限状态机.webp" alt="两种有限状态机">
<figcaption aria-hidden="true">两种有限状态机</figcaption>
</figure>
<p>状态编码：</p>
<ul>
<li><strong>二进制编码</strong>
<ul>
<li>使用 <em><span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.546ex;" xmlns="http://www.w3.org/2000/svg" width="3.879ex" height="2.116ex" role="img" focusable="false" viewbox="0 -694 1714.6 935.4"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"/><path data-c="6F" d="M28 214Q28 309 93 378T250 448Q340 448 405 380T471 215Q471 120 407 55T250 -10Q153 -10 91 57T28 214ZM250 30Q372 30 372 193V225V250Q372 272 371 288T364 326T348 362T317 390T268 410Q263 411 252 411Q222 411 195 399Q152 377 139 338T126 246V226Q126 130 145 91Q177 30 250 30Z" transform="translate(278,0)"/><path data-c="67" d="M329 409Q373 453 429 453Q459 453 472 434T485 396Q485 382 476 371T449 360Q416 360 412 390Q410 404 415 411Q415 412 416 414V415Q388 412 363 393Q355 388 355 386Q355 385 359 381T368 369T379 351T388 325T392 292Q392 230 343 187T222 143Q172 143 123 171Q112 153 112 133Q112 98 138 81Q147 75 155 75T227 73Q311 72 335 67Q396 58 431 26Q470 -13 470 -72Q470 -139 392 -175Q332 -206 250 -206Q167 -206 107 -175Q29 -140 29 -75Q29 -39 50 -15T92 18L103 24Q67 55 67 108Q67 155 96 193Q52 237 52 292Q52 355 102 398T223 442Q274 442 318 416L329 409ZM299 343Q294 371 273 387T221 404Q192 404 171 388T145 343Q142 326 142 292Q142 248 149 227T179 192Q196 182 222 182Q244 182 260 189T283 207T294 227T299 242Q302 258 302 292T299 343ZM403 -75Q403 -50 389 -34T348 -11T299 -2T245 0H218Q151 0 138 -6Q118 -15 107 -34T95 -74Q95 -84 101 -97T122 -127T170 -155T250 -167Q319 -167 361 -139T403 -75Z" transform="translate(778,0)"/></g><g data-mml-node="mn" transform="translate(1311,-241.4) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g></g></g></g></svg></mjx-container></span>状态数量</em>
位表示状态</li>
<li>最小化触发器，但并不是输出逻辑或下一个状态逻辑</li>
</ul></li>
<li><strong>one-hot 编码</strong>
<ul>
<li>使用 <em>状态数量</em> 个位表示状态</li>
<li>最小化下一个状态逻辑，但最大化触发器</li>
<li>最简单的设计过程</li>
</ul></li>
<li><strong>输出编码</strong>
<ul>
<li>输出<strong>直接</strong>在状态编码</li>
<li>最小化输出逻辑</li>
<li>只适用于 Moore 机器</li>
</ul></li>
</ul>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/识别1101序列的状态转移图.webp" alt="识别1101序列的状态转移图">
<figcaption aria-hidden="true">识别1101序列的状态转移图</figcaption>
</figure>
<p>FSM 设计过程：</p>
<ul>
<li>决定所有可能的状态</li>
<li>设计状态转移图
<ul>
<li>决定每个状态的输入和输出，还有转移</li>
</ul></li>
<li>方法
<ul>
<li>从 reset 状态开始</li>
<li>添加转移和状态</li>
<li>选择合适的状态名</li>
<li>建造一个 FSM 就<strong>像</strong>编程，但不是编程
<ul>
<li>FSM 像有条件和 goto 的程序的顺序控制流</li>
</ul></li>
</ul></li>
</ul>
<p>在硬件上，一般有很多并发的 FSM</p>
<h1 id="硬件描述语言和-verilog-hardware-desccription-languages-and-verilog">硬件描述语言和
Verilog Hardware Desccription Languages and Verilog</h1>
<p>硬件描述语言：</p>
<ul>
<li>用于<strong>描述</strong>硬件</li>
<li>可以<strong>描述</strong>复杂的设计</li>
<li>可以<strong>模拟</strong>行为</li>
<li>可以<strong>合成</strong>部分硬件</li>
</ul>
<p>两大最有名的 HDL：Verilog 和 VHDL</p>
<p>HDL 让描述硬件更轻松，无缝表达硬件的内在并行</p>
<p>设计模块的层次结构：</p>
<ul>
<li>预先定义的原始门</li>
<li>由这些门构建简单模块</li>
<li>由简单模块构建复杂模块</li>
</ul>
<p>层次结构控制了复杂性</p>
<p>自顶向下设计方法和自底向上的设计方法，通常两者都会使用</p>
<p><strong>模块 module</strong> 是 Verilog 中的主要组成，需要定义</p>
<ul>
<li>模块的名字</li>
<li>端口方向</li>
</ul>
<p>然后描述模块的功能</p>
<p>有两种风格：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> test(a, b, y);</span><br><span class="line">    <span class="keyword">input</span> a;</span><br><span class="line">    <span class="keyword">input</span> b;</span><br><span class="line">    <span class="keyword">output</span> y;</span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line"><span class="keyword">module</span> test(<span class="keyword">input</span> a, <span class="keyword">input</span> b, <span class="keyword">output</span> y);</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>对于多 bit 的输入/输出，可以使用 [结束访问:开始范围]，如
<code>input [31:0]a;</code> 表示
<code>a[31],a[30]..a[0]</code>，顺序可以交换，但是必须一致</p>
<p>操作位：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 切片</span></span><br><span class="line"><span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] longbus;</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] shortbus;</span><br><span class="line"><span class="keyword">assign</span> shortbus = longbus[<span class="number">12</span>:<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 连接</span></span><br><span class="line"><span class="keyword">assign</span> y = {a[<span class="number">2</span>], a[<span class="number">1</span>]};</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以定义重复</span></span><br><span class="line"><span class="keyword">assign</span> x = {<span class="number">4</span>{a[<span class="number">0</span>]}};</span><br></pre></td></tr></table></figure>
<p>HDL 实现的两个主要风格：</p>
<ul>
<li><strong>结构化</strong>：
<ul>
<li>侧重于描述<strong>门级别</strong>的电路</li>
<li>用门描述模块层次结构</li>
</ul></li>
<li><strong>表现化</strong>：
<ul>
<li>侧重于电路的<strong>函数描述</strong></li>
<li>包括逻辑和数学运算符</li>
<li>比门级别更高层次抽象</li>
<li>一个表现描述可能有多种门层次的实现方式</li>
</ul></li>
</ul>
<p>使用模块 <code>small(A,B,Y)</code> 的两种方法：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 要求顺序匹配</span></span><br><span class="line"><span class="keyword">small</span> i_first(A, SEL, n1);</span><br><span class="line"><span class="comment">// 或</span></span><br><span class="line"><span class="keyword">small</span> i_second (<span class="variable">.B</span>(C), <span class="variable">.Y</span>(Y), <span class="variable">.A</span>(n1));</span><br></pre></td></tr></table></figure>
<p>结构化例子：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> mux2(<span class="keyword">input</span> d0, <span class="keyword">input</span> d1, <span class="keyword">output</span> y);</span><br><span class="line">    <span class="keyword">and</span> g1 (d0, d1, y);</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>也就是和模块实例化一样，但是不需要定义</p>
<p>表现化：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> example(a, b, y);</span><br><span class="line">    <span class="keyword">input</span> a;</span><br><span class="line">    <span class="keyword">input</span> b;</span><br><span class="line">    <span class="keyword">assign</span> y = a &amp; b;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>可以按位操作，如</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> and4(<span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] a, <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] b, <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] y);</span><br><span class="line">    <span class="keyword">assign</span> y = a &amp; b;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>约简操作：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> and8(<span class="keyword">input</span> [<span class="number">7</span>:<span class="number">0</span>] a, <span class="keyword">output</span> y);</span><br><span class="line">    <span class="keyword">assign</span> y = &amp;a;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>条件赋值：<code>assign y = s ? d1 : d0;</code></p>
<p>数的表示：N’Bxx</p>
<ul>
<li>N：bit 的数量</li>
<li>B：基，可以是 b, h, d, o</li>
<li>xx：数字
<ul>
<li>用基表示的值</li>
<li>也可以是 X（无效）和 Z（浮动）</li>
<li><code>_</code> 有利于提高可读性</li>
</ul></li>
</ul>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/有Z和X的AND门真值表.webp" alt="有Z和X的AND门真值表">
<figcaption aria-hidden="true">有Z和X的AND门真值表</figcaption>
</figure>
<p>合成：</p>
<ul>
<li>将合成的 HDL 代码映射到低层次 cell 库中</li>
<li>可以实现许多优化</li>
<li>但是并不能保证是最优的，因为需要计算量太大</li>
</ul>
<p>模拟</p>
<p>模块可以有参数</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> mux2 #(<span class="keyword">parameter</span> width = <span class="number">8</span>) (<span class="keyword">input</span> [width-<span class="number">1</span>:<span class="number">0</span>]d0, d1, <span class="keyword">output</span>[width-<span class="number">1</span>:<span class="number">0</span>] y);</span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line">mux2 i_mux(d0, d1, out);</span><br><span class="line"><span class="comment">// 12 bit</span></span><br><span class="line">mux $(<span class="number">12</span>) i_mux_b(d0, d1, out);</span><br></pre></td></tr></table></figure>
<p>时间</p>
<ul>
<li><strong>只可</strong>模拟</li>
<li><strong>不可</strong>合成</li>
<li>用于电路的建模延迟</li>
</ul>
<h1 id="时间和验证-timing-and-verification">时间和验证 Timing and
Verification</h1>
<p>时序 = 组合 + 内存</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/时序逻辑结构.webp"></p>
<p><code>always</code> 块：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always</span> @ (sensitivity list)</span><br><span class="line">    statement;</span><br></pre></td></tr></table></figure>
<p>当 <code>sensitivity list</code> 中的事件发生，语句执行</p>
<p>例如 flip-flop：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> flop(<span class="keyword">input</span> clk, <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] d, <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] q);</span><br><span class="line"><span class="keyword">always</span> @ (<span class="keyword">posedge</span> clk)</span><br><span class="line">    q &lt;= d;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<ul>
<li>赋值的变量被声明为
<code>reg</code>，但并不意味着这个值是一个寄存器</li>
<li><code>always</code> 块中不能有 <code>assign</code></li>
</ul>
<p>一个<strong>异步</strong> reset 的 flip-flop：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always</span> @ (<span class="keyword">posedge</span> clk, <span class="keyword">negedge</span> reset)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset == <span class="number">0</span>) q &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> q &lt;= d;</span><br><span class="line">    <span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>对于更长的雨具，<code>begin-end</code> 对可以提高可读性</p>
<p>一个<strong>同步</strong> reset 的 flip-flop：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always</span> @ (<span class="keyword">posedge</span> clk)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset == '<span class="number">0</span>') q &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> q &lt;= d;</span><br><span class="line">    <span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>可能有多个 <code>always</code> 块，但是不能在不同的
<code>always</code> 块中给相同的信号赋值</p>
<p><code>always</code> 块可以用于定义组合逻辑，如果：</p>
<ul>
<li>所有的输出都总是更新</li>
<li>右边的信号都在感知列表中，如 <code>always @ *</code></li>
<li>左边的信号在每个可能的情况下都赋值</li>
</ul>
<p><code>case</code> 语句</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always</span> @ (*)</span><br><span class="line">    <span class="keyword">case</span> (data)</span><br><span class="line">        <span class="number">4'd0</span>: segments = <span class="number">7'b111_1110</span>;</span><br><span class="line">        <span class="number">4'd1</span>: segments = <span class="number">7'b111_1010</span>;</span><br><span class="line">        <span class="number">4'd2</span>: segments = <span class="number">7'b111_1000</span>;</span><br><span class="line">        <span class="keyword">default</span>: segments = <span class="number">7'b000_0000</span>; <span class="comment">// 为了避免遗忘某些情况，一定要有 default</span></span><br><span class="line">    <span class="keyword">endcase</span></span><br></pre></td></tr></table></figure>
<p>注意 <code>if...else</code> <strong>只能</strong>用于
<code>always</code> 块中</p>
<ul>
<li>非阻塞式 <code>&lt;=</code>：并行赋值</li>
<li>阻塞式 <code>=</code>：知道前面的赋值完成才开始进程</li>
</ul>
<p><code>parameter</code> 相当于常量，可以用于提高可读性，如
<code>parameter s0 = 2'b00;</code></p>
<p>事实上输出相对于输入有延迟，因为晶体管开关需要时间</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/组合电路延迟.webp" alt="组合电路延迟">
<figcaption aria-hidden="true">组合电路延迟</figcaption>
</figure>
<p>延迟的造成原因：</p>
<ul>
<li>电路的容抗和阻抗</li>
<li>光速有限</li>
</ul>
<p><strong>污染延迟 contamination delay</strong>：Y
<strong>开始</strong>改变之前的延迟</p>
<p><strong>传播延迟 propagation delay</strong>：Y
<strong>完成</strong>改变的延迟</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/污染延迟和传播延迟.webp" alt="污染延迟和传播延迟">
<figcaption aria-hidden="true">污染延迟和传播延迟</figcaption>
</figure>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/关键路与最短路.webp" alt="关键路与最短路">
<figcaption aria-hidden="true">关键路与最短路</figcaption>
</figure>
<p><strong>最长（关键 critical）路</strong>：<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.656ex;" xmlns="http://www.w3.org/2000/svg" width="22.817ex" height="2.163ex" role="img" focusable="false" viewbox="0 -666 10085.2 955.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g><g data-mml-node="TeXAtom" transform="translate(394,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"/></g><g data-mml-node="mi" transform="translate(503,0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"/></g></g></g><g data-mml-node="mo" transform="translate(1445.1,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mn" transform="translate(2500.9,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="msub" transform="translate(3000.9,0)"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g><g data-mml-node="TeXAtom" transform="translate(394,-152.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"/></g><g data-mml-node="mi" transform="translate(503,0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"/></g><g data-mml-node="mi" transform="translate(1023,0)"><path data-c="5F" d="M0 -62V-25H499V-62H0Z"/></g><g data-mml-node="mi" transform="translate(1523,0)"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"/></g><g data-mml-node="mi" transform="translate(2273,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mi" transform="translate(3161,0)"><path data-c="1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"/></g></g></g><g data-mml-node="mo" transform="translate(6487.8,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"/></g><g data-mml-node="msub" transform="translate(7488,0)"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g><g data-mml-node="TeXAtom" transform="translate(394,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"/></g><g data-mml-node="mi" transform="translate(503,0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"/></g><g data-mml-node="mi" transform="translate(1023,0)"><path data-c="5F" d="M0 -62V-25H499V-62H0Z"/></g><g data-mml-node="mi" transform="translate(1523,0)"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"/></g><g data-mml-node="mi" transform="translate(2286,0)"><path data-c="1D445" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"/></g></g></g></g></g></svg></mjx-container></span></p>
<p>最短路：<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.445ex;" xmlns="http://www.w3.org/2000/svg" width="12.82ex" height="1.861ex" role="img" focusable="false" viewbox="0 -626 5666.6 822.5"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g><g data-mml-node="TeXAtom" transform="translate(394,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"/></g><g data-mml-node="mi" transform="translate(433,0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"/></g></g></g><g data-mml-node="mo" transform="translate(1395.7,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="msub" transform="translate(2451.4,0)"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g><g data-mml-node="TeXAtom" transform="translate(394,-152.7) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"/></g><g data-mml-node="mi" transform="translate(433,0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"/></g><g data-mml-node="mi" transform="translate(953,0)"><path data-c="5F" d="M0 -62V-25H499V-62H0Z"/></g><g data-mml-node="mi" transform="translate(1453,0)"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"/></g><g data-mml-node="mi" transform="translate(2203,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><g data-mml-node="mi" transform="translate(3091,0)"><path data-c="1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"/></g></g></g></g></g></svg></mjx-container></span></p>
<p><strong>脉冲 glitch</strong>：一个输入转移造成多重输出转移</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/脉冲.webp" alt="脉冲">
<figcaption aria-hidden="true">脉冲</figcaption>
</figure>
<p>脉冲在卡诺图中可见，当主要隐含数之间移动时，脉冲出现：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/脉冲2.webp"></p>
<p>只需要将其连起来即可</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/脉冲3.webp"></p>
<p>D flip flop 输入时间约束</p>
<p>当<strong>采样 sample</strong> 时，D
必须是<strong>稳定</strong>的</p>
<ul>
<li><strong>设置时间 setup
time</strong>：在时钟边缘到来之<strong>前</strong>数据必须稳定的时间</li>
<li><strong>保持时间 hold
time</strong>：在时钟边沿之<strong>后</strong>数据必须保持稳定的时间</li>
<li><strong>孔径时间 aperture
time</strong>：时钟边沿<strong>周围</strong>数据必须保持的时间，<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.65ex;" xmlns="http://www.w3.org/2000/svg" width="16.442ex" height="2.066ex" role="img" focusable="false" viewbox="0 -626 7267.3 913.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g><g data-mml-node="mi" transform="translate(394,-150) scale(0.707)"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"/></g></g><g data-mml-node="mo" transform="translate(1095.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="msub" transform="translate(2151.6,0)"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g><g data-mml-node="TeXAtom" transform="translate(394,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"/></g><g data-mml-node="mi" transform="translate(469,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"/></g><g data-mml-node="mi" transform="translate(935,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g><g data-mml-node="mi" transform="translate(1296,0)"><path data-c="1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mi" transform="translate(1868,0)"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"/></g></g></g><g data-mml-node="mo" transform="translate(4494.4,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"/></g><g data-mml-node="msub" transform="translate(5494.6,0)"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g><g data-mml-node="TeXAtom" transform="translate(394,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="210E" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"/></g><g data-mml-node="mi" transform="translate(576,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"/></g><g data-mml-node="mi" transform="translate(1061,0)"><path data-c="1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"/></g><g data-mml-node="mi" transform="translate(1359,0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"/></g></g></g></g></g></svg></mjx-container></span></li>
</ul>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/D%20flip%20flop%20输入时间约束.webp" alt="D flip flop 输入时间约束">
<figcaption aria-hidden="true">D flip flop 输入时间约束</figcaption>
</figure>
<p>D flip flop 输出时间约束</p>
<ul>
<li><strong>到 q 的污染延迟 contamination delay
clock-to-q</strong>(<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.65ex;" xmlns="http://www.w3.org/2000/svg" width="3.126ex" height="2.066ex" role="img" focusable="false" viewbox="0 -626 1381.6 913.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g><g data-mml-node="TeXAtom" transform="translate(394,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"/></g><g data-mml-node="mi" transform="translate(433,0)"><path data-c="1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"/></g><g data-mml-node="mi" transform="translate(866,0)"><path data-c="1D45E" d="M33 157Q33 258 109 349T280 441Q340 441 372 389Q373 390 377 395T388 406T404 418Q438 442 450 442Q454 442 457 439T460 434Q460 425 391 149Q320 -135 320 -139Q320 -147 365 -148H390Q396 -156 396 -157T393 -175Q389 -188 383 -194H370Q339 -192 262 -192Q234 -192 211 -192T174 -192T157 -193Q143 -193 143 -185Q143 -182 145 -170Q149 -154 152 -151T172 -148Q220 -148 230 -141Q238 -136 258 -53T279 32Q279 33 272 29Q224 -10 172 -10Q117 -10 75 30T33 157ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"/></g></g></g></g></g></svg></mjx-container></span>)：在时钟边沿后 Q
<strong>开始</strong>改变的最短时间</li>
<li><strong>到 q 的传播延迟</strong>(<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.65ex;" xmlns="http://www.w3.org/2000/svg" width="3.238ex" height="2.066ex" role="img" focusable="false" viewbox="0 -626 1431.1 913.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g><g data-mml-node="TeXAtom" transform="translate(394,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"/></g><g data-mml-node="mi" transform="translate(503,0)"><path data-c="1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"/></g><g data-mml-node="mi" transform="translate(936,0)"><path data-c="1D45E" d="M33 157Q33 258 109 349T280 441Q340 441 372 389Q373 390 377 395T388 406T404 418Q438 442 450 442Q454 442 457 439T460 434Q460 425 391 149Q320 -135 320 -139Q320 -147 365 -148H390Q396 -156 396 -157T393 -175Q389 -188 383 -194H370Q339 -192 262 -192Q234 -192 211 -192T174 -192T157 -193Q143 -193 143 -185Q143 -182 145 -170Q149 -154 152 -151T172 -148Q220 -148 230 -141Q238 -136 258 -53T279 32Q279 33 272 29Q224 -10 172 -10Q117 -10 75 30T33 157ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"/></g></g></g></g></g></svg></mjx-container></span>)：在时钟边沿后 Q
<strong>停止</strong>改变的最短时间</li>
</ul>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/filp-flop输出时间.webp" alt="filp-flop输出时间">
<figcaption aria-hidden="true">filp-flop输出时间</figcaption>
</figure>
<p>对于时序电路，D2 必须稳定，即</p>
<ul>
<li>至少在时钟边沿到来前 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.65ex;" xmlns="http://www.w3.org/2000/svg" width="4.798ex" height="2.066ex" role="img" focusable="false" viewbox="0 -626 2120.6 913.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g><g data-mml-node="TeXAtom" transform="translate(394,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"/></g><g data-mml-node="mi" transform="translate(469,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"/></g><g data-mml-node="mi" transform="translate(935,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g><g data-mml-node="mi" transform="translate(1296,0)"><path data-c="1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mi" transform="translate(1868,0)"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"/></g></g></g></g></g></svg></mjx-container></span></li>
<li>至少在时钟边沿到来后 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.357ex;" xmlns="http://www.w3.org/2000/svg" width="4.011ex" height="1.773ex" role="img" focusable="false" viewbox="0 -626 1772.7 783.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g><g data-mml-node="TeXAtom" transform="translate(394,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="210E" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"/></g><g data-mml-node="mi" transform="translate(576,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"/></g><g data-mml-node="mi" transform="translate(1061,0)"><path data-c="1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"/></g><g data-mml-node="mi" transform="translate(1359,0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"/></g></g></g></g></g></svg></mjx-container></span></li>
</ul>
<p>故两个触发器之间有<strong>最大</strong>和<strong>最小</strong>延迟</p>
<ul>
<li><span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.65ex;" xmlns="http://www.w3.org/2000/svg" width="21.427ex" height="2.181ex" role="img" focusable="false" viewbox="0 -677 9470.7 964.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"/></g><g data-mml-node="mi" transform="translate(617,-150) scale(0.707)"><path data-c="1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"/></g></g><g data-mml-node="mo" transform="translate(1251,0)"><path data-c="3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"/></g><g data-mml-node="msub" transform="translate(2306.7,0)"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g><g data-mml-node="TeXAtom" transform="translate(394,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"/></g><g data-mml-node="mi" transform="translate(503,0)"><path data-c="1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"/></g><g data-mml-node="mi" transform="translate(936,0)"><path data-c="1D45E" d="M33 157Q33 258 109 349T280 441Q340 441 372 389Q373 390 377 395T388 406T404 418Q438 442 450 442Q454 442 457 439T460 434Q460 425 391 149Q320 -135 320 -139Q320 -147 365 -148H390Q396 -156 396 -157T393 -175Q389 -188 383 -194H370Q339 -192 262 -192Q234 -192 211 -192T174 -192T157 -193Q143 -193 143 -185Q143 -182 145 -170Q149 -154 152 -151T172 -148Q220 -148 230 -141Q238 -136 258 -53T279 32Q279 33 272 29Q224 -10 172 -10Q117 -10 75 30T33 157ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"/></g></g></g><g data-mml-node="mo" transform="translate(3960.1,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"/></g><g data-mml-node="msub" transform="translate(4960.3,0)"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g><g data-mml-node="TeXAtom" transform="translate(394,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"/></g><g data-mml-node="mi" transform="translate(503,0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"/></g></g></g><g data-mml-node="mo" transform="translate(6349.9,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"/></g><g data-mml-node="msub" transform="translate(7350.1,0)"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g><g data-mml-node="TeXAtom" transform="translate(394,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"/></g><g data-mml-node="mi" transform="translate(469,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"/></g><g data-mml-node="mi" transform="translate(935,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g><g data-mml-node="mi" transform="translate(1296,0)"><path data-c="1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mi" transform="translate(1868,0)"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"/></g></g></g></g></g></svg></mjx-container></span>，其中 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.65ex;" xmlns="http://www.w3.org/2000/svg" width="2.641ex" height="2.066ex" role="img" focusable="false" viewbox="0 -626 1167.4 913.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g><g data-mml-node="TeXAtom" transform="translate(394,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"/></g><g data-mml-node="mi" transform="translate(503,0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"/></g></g></g></g></g></svg></mjx-container></span>
是有效工作，由关键路延迟决定，其余部分为<strong>时序开销 sequencing
overhead</strong></li>
<li><span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.65ex;" xmlns="http://www.w3.org/2000/svg" width="15.448ex" height="2.066ex" role="img" focusable="false" viewbox="0 -626 6828.1 913.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g><g data-mml-node="TeXAtom" transform="translate(394,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"/></g><g data-mml-node="mi" transform="translate(433,0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"/></g></g></g><g data-mml-node="mo" transform="translate(1395.7,0)"><path data-c="3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"/></g><g data-mml-node="msub" transform="translate(2451.4,0)"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g><g data-mml-node="TeXAtom" transform="translate(394,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="210E" d="M137 683Q138 683 209 688T282 694Q294 694 294 685Q294 674 258 534Q220 386 220 383Q220 381 227 388Q288 442 357 442Q411 442 444 415T478 336Q478 285 440 178T402 50Q403 36 407 31T422 26Q450 26 474 56T513 138Q516 149 519 151T535 153Q555 153 555 145Q555 144 551 130Q535 71 500 33Q466 -10 419 -10H414Q367 -10 346 17T325 74Q325 90 361 192T398 345Q398 404 354 404H349Q266 404 205 306L198 293L164 158Q132 28 127 16Q114 -11 83 -11Q69 -11 59 -2T48 16Q48 30 121 320L195 616Q195 629 188 632T149 637H128Q122 643 122 645T124 664Q129 683 137 683Z"/></g><g data-mml-node="mi" transform="translate(576,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"/></g><g data-mml-node="mi" transform="translate(1061,0)"><path data-c="1D459" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"/></g><g data-mml-node="mi" transform="translate(1359,0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"/></g></g></g><g data-mml-node="mo" transform="translate(4446.3,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"/></g><g data-mml-node="msub" transform="translate(5446.5,0)"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g><g data-mml-node="TeXAtom" transform="translate(394,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"/></g><g data-mml-node="mi" transform="translate(433,0)"><path data-c="1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"/></g><g data-mml-node="mi" transform="translate(866,0)"><path data-c="1D45E" d="M33 157Q33 258 109 349T280 441Q340 441 372 389Q373 390 377 395T388 406T404 418Q438 442 450 442Q454 442 457 439T460 434Q460 425 391 149Q320 -135 320 -139Q320 -147 365 -148H390Q396 -156 396 -157T393 -175Q389 -188 383 -194H370Q339 -192 262 -192Q234 -192 211 -192T174 -192T157 -193Q143 -193 143 -185Q143 -182 145 -170Q149 -154 152 -151T172 -148Q220 -148 230 -141Q238 -136 258 -53T279 32Q279 33 272 29Q224 -10 172 -10Q117 -10 75 30T33 157ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"/></g></g></g></g></g></svg></mjx-container></span>，注意与 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.357ex;" xmlns="http://www.w3.org/2000/svg" width="2.202ex" height="1.889ex" role="img" focusable="false" viewbox="0 -677 973.2 834.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"/></g><g data-mml-node="mi" transform="translate(617,-150) scale(0.707)"><path data-c="1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"/></g></g></g></g></svg></mjx-container></span>
即时钟周期无关</li>
</ul>
<p>时钟也有延迟，不同时钟边沿的时间差为<strong>时钟歪斜 clock
skew</strong>，若考虑这一延迟，则原等式的两边都要加上 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.357ex;" xmlns="http://www.w3.org/2000/svg" width="4.479ex" height="1.773ex" role="img" focusable="false" viewbox="0 -626 1979.8 783.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g><g data-mml-node="TeXAtom" transform="translate(394,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"/></g><g data-mml-node="mi" transform="translate(469,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"/></g><g data-mml-node="mi" transform="translate(990,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"/></g><g data-mml-node="mi" transform="translate(1456,0)"><path data-c="1D464" d="M580 385Q580 406 599 424T641 443Q659 443 674 425T690 368Q690 339 671 253Q656 197 644 161T609 80T554 12T482 -11Q438 -11 404 5T355 48Q354 47 352 44Q311 -11 252 -11Q226 -11 202 -5T155 14T118 53T104 116Q104 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Q21 293 29 315T52 366T96 418T161 441Q204 441 227 416T250 358Q250 340 217 250T184 111Q184 65 205 46T258 26Q301 26 334 87L339 96V119Q339 122 339 128T340 136T341 143T342 152T345 165T348 182T354 206T362 238T373 281Q402 395 406 404Q419 431 449 431Q468 431 475 421T483 402Q483 389 454 274T422 142Q420 131 420 107V100Q420 85 423 71T442 42T487 26Q558 26 600 148Q609 171 620 213T632 273Q632 306 619 325T593 357T580 385Z"/></g></g></g></g></g></svg></mjx-container></span></p>
<p>Testbench：一个用于测试的模块，被测试的模块叫<strong>待测设备 device
under test(DUT)</strong></p>
<ul>
<li>其提供输入，有人工的，也有自动生成（顺序或随机数）</li>
<li>将 DUT 的结果和人工值或黄金设计相比较</li>
</ul>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> testbench2();</span><br><span class="line">    <span class="keyword">reg</span> a;</span><br><span class="line">    sillyfunction dut(<span class="variable">.a</span>(a), <span class="variable">.b</span>(b), <span class="variable">.c</span>(c), <span class="variable">.y</span>(y));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">initial</span> <span class="comment">// 类似 always 块，但是只在一开始运行一次</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">            a = <span class="number">0</span>; b = <span class="number">0</span>; c = <span class="number">0</span>;</span><br><span class="line">            #<span class="number">10</span>;	<span class="comment">// 等待 10 ns</span></span><br><span class="line">            <span class="keyword">if</span> (y != <span class="number">1</span>) <span class="built_in">$display</span>(<span class="string">"000 failed."</span>);	<span class="comment">// 打印信息</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<p>好的设计原则：</p>
<ul>
<li>关键路径设计：最小化最大逻辑延迟</li>
<li>平衡设计：平衡系统中不同部分的最大逻辑延迟，即不出现瓶颈</li>
<li>面包黄油设计：优化一般情况，但也要考虑到非一般情况</li>
</ul>
<h1 id="冯诺依曼结构-von-neumann-model">冯诺依曼结构 Von Neumann
Model</h1>
<p>为了用计算机完成一个任务，需要</p>
<ul>
<li>计算机程序</li>
<li>计算机</li>
</ul>
<p>程序：指令集</p>
<ul>
<li>指令：程序中最小工作单元</li>
</ul>
<p>指令集：计算机被用于设计执行的指令的集合</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/冯诺依曼结构.webp" alt="冯诺依曼结构">
<figcaption aria-hidden="true">冯诺依曼结构</figcaption>
</figure>
<p>两种内存：</p>
<ul>
<li>字长地址的内存：每个字长数据有一个独特的地址</li>
<li>字节地址的内存：每个字节数据有一个独特的地址</li>
</ul>
<p>读内存：</p>
<ol type="1">
<li>将希望读的地址装载到 MAR（内存地址寄存器）中</li>
<li>将相关位置的数据放到 MDR（内存数据寄存器）中</li>
</ol>
<p>写内存：</p>
<ol type="1">
<li>将希望读的地址装载到 MAR 中，将需要写入的数据装载到 MDR 中</li>
<li>激活写使能信号</li>
</ol>
<p>处理单元：由很多功能单元组成，如 ALU</p>
<p>为了更快的存储，临时数据存在寄存器中</p>
<p>控制单元：一步一步执行程序</p>
<ul>
<li>指令寄存器</li>
<li>PC</li>
</ul>
<p>冯诺依曼结构两个关键的性质：</p>
<ul>
<li>存储程序
<ul>
<li>指令在线性内存阵列中存储</li>
<li>内存对指令和数据一视同仁，所以对储存值的解释依赖于控制信号</li>
</ul></li>
<li>顺序指令处理
<ul>
<li>一个处理一个指令</li>
<li>PC 识别当前指令</li>
<li>PC 顺序向前，除了控制转移指令</li>
</ul></li>
</ul>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/LC-3机器.webp" alt="LC-3机器">
<figcaption aria-hidden="true">LC-3机器</figcaption>
</figure>
<h1 id="指令集架构-instruction-set-architectures">指令集架构 Instruction
Set Architectures</h1>
<p>计算机语言可以写作：</p>
<ul>
<li>机器语言：0 和 1</li>
<li>汇编语言：人类可读</li>
</ul>
<p>指令由两部分组成：<strong>指令编码 opcode</strong> 和<strong>操作数
oprand</strong></p>
<p>指令循环：</p>
<ul>
<li>取指令</li>
<li>解码指令</li>
<li>计算地址</li>
<li>获取操作数</li>
<li>执行</li>
<li>存储结果</li>
</ul>
<p>然后返回循环，注意不是所有的指令都有这六个阶段</p>
<p>ISA
是<strong>软件</strong>命令和<strong>硬件</strong>执行的<strong>接口</strong>，其规定了</p>
<ul>
<li>内存组织</li>
<li>寄存器集</li>
<li>指令集</li>
</ul>
<p>指令集的复杂和简单中是权衡：</p>
<ul>
<li>硬件复杂度 vs 软件复杂度</li>
<li>简单 vs 复杂指令的延迟</li>
</ul>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/语法沟.webp" alt="语法沟">
<figcaption aria-hidden="true">语法沟</figcaption>
</figure>
<p>有四种寻址方式：</p>
<ul>
<li>PC-相关：Memory[PC + sign-extend(PC offset 9)]</li>
<li>间接访问：Memory[Memory[PC + sign-extend(PC offset 9)]]</li>
<li>集 + 偏移：Memory[$s0 + 8]</li>
<li>立即数寻址：LEA(Load Effective Address)：PC + sign-extend(PC offset
9)</li>
</ul>
<p>计算机基本方法：如果有什么是解决不了的，那就在中间加一层：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/语法沟2.webp"></p>
<p><strong>数据流模型 Dataflow
Model</strong>：指令以<strong>数据流顺序</strong>执行，即不是
PC，而是生产者-消费者模型</p>
<p>通常使用图表示</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/顺序和数据流.webp" alt="顺序和数据流">
<figcaption aria-hidden="true">顺序和数据流</figcaption>
</figure>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/数据流结点.webp" alt="数据流结点">
<figcaption aria-hidden="true">数据流结点</figcaption>
</figure>
<p>这种架构提取出了并行</p>
<h1 id="微架构-microarchitecture">微架构 Microarchitecture</h1>
<p>ISA：规定程序员看到这些指令怎样被执行</p>
<p>微架构：执行指令的潜在实现</p>
<p>计算机体系结构定义：ISA + 实现</p>
<p>处理指令：根据 ISA 规范把状态从 AS 转化为 AS’</p>
<ul>
<li>类似于一个抽象有限状态机</li>
<li>从 ISA 视角，每条指令一个状态转移</li>
<li>从微架构视角，每条指令可以有多重状态转移</li>
</ul>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/单周期机器.webp" alt="单周期机器">
<figcaption aria-hidden="true">单周期机器</figcaption>
</figure>
<p>单周期机器：</p>
<ul>
<li>每条指令一个时钟周期</li>
<li>所有状态在指令执行结束时更新</li>
<li>缺点：可以发现时钟周期时间由关键路决定</li>
</ul>
<p>多周期机器：</p>
<ul>
<li>每条指令被分成多个周期/阶段</li>
<li>在指令执行期间更新状态</li>
<li>在指令执行结束时更新架构状态</li>
<li>相对优点：最慢的阶段决定周期时间</li>
</ul>
<p>指令处理机制由两部分组成：</p>
<ul>
<li>数据路径：有处理和转移数据信号的硬件组成
<ul>
<li>函数单元</li>
<li>硬件结构</li>
<li>存储单元</li>
</ul></li>
<li>控制逻辑：决定控制信号，即指定进入数据的数据路径中的元素</li>
</ul>
<p>效率分析：</p>
<ul>
<li>每条指令的执行时间：CPI * 时钟周期时间</li>
<li>整个程序的执行时间：（CPI _ 时钟周期时间）的总和 = 指令数 _ 评价 CPI
* 时钟周期时间</li>
</ul>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/MIPS的状态元素.webp" alt="MIPS的状态元素">
<figcaption aria-hidden="true">MIPS的状态元素</figcaption>
</figure>
<p>假设：</p>
<ul>
<li>组合读</li>
<li>同步写</li>
<li>单周期，同步内存</li>
</ul>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/R类型数据路径.webp" alt="R类型数据路径">
<figcaption aria-hidden="true">R类型数据路径</figcaption>
</figure>
<p>I
类型的寄存器编码位置不同，还有要选择是使用寄存器还是立即数，故添加两个
Mux</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/I类型数据路径.webp" alt="I类型数据路径">
<figcaption aria-hidden="true">I类型数据路径</figcaption>
</figure>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/LD数据路径.webp" alt="LD数据路径">
<figcaption aria-hidden="true">LD数据路径</figcaption>
</figure>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/SW数据路径.webp" alt="SW数据路径">
<figcaption aria-hidden="true">SW数据路径</figcaption>
</figure>
<p>和之前的组合起来，得到完整的数据路径</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/读写数据路径.webp" alt="读写数据路径">
<figcaption aria-hidden="true">读写数据路径</figcaption>
</figure>
<p>注意 PC 相关跳转中的 PC 是这条指令的下一个，所以要先 PC + 4</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/无条件跳转数据路径.webp" alt="无条件跳转数据路径">
<figcaption aria-hidden="true">无条件跳转数据路径</figcaption>
</figure>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/条件跳转数据路径.webp" alt="条件跳转数据路径">
<figcaption aria-hidden="true">条件跳转数据路径</figcaption>
</figure>
<p>把所有的放在一起，并加入控制信号：</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/单周期机器2.webp" alt="单周期机器2">
<figcaption aria-hidden="true">单周期机器2</figcaption>
</figure>
<table>
<colgroup>
<col style="width: 8%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 60%">
</colgroup>
<thead>
<tr class="header">
<th>控制信号</th>
<th>为 0 的情况</th>
<th>为 1 的情况</th>
<th>等式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>RegDest</td>
<td>选择 inst[20:16]</td>
<td>选择 inst[15:11]</td>
<td>opcode == 0</td>
</tr>
<tr class="even">
<td>ALUSrc</td>
<td>第二个寄存器</td>
<td>立即数</td>
<td>opcode != 0 &amp;&amp; opcode != BEQ &amp;&amp; opcode != BNE</td>
</tr>
<tr class="odd">
<td>MemtoReg</td>
<td>存储 ALU 结果</td>
<td>储存内存输出</td>
<td>opcode == LW</td>
</tr>
<tr class="even">
<td>RegWrite</td>
<td>禁止写寄存器</td>
<td>允许写寄存器</td>
<td>opcode != SW &amp;&amp; opcode != Bxx &amp;&amp; opcode != J
&amp;&amp; opcode != JR</td>
</tr>
<tr class="odd">
<td>MemRead</td>
<td>禁止读内存</td>
<td>允许读内存</td>
<td>opcode == LW</td>
</tr>
<tr class="even">
<td>Memwrite</td>
<td>禁止写内存</td>
<td>允许写内存</td>
<td>opcode == SW</td>
</tr>
<tr class="odd">
<td>PCSrc_1</td>
<td>根据 PCSrc_2</td>
<td>26 位立即数跳转</td>
<td>opcode == J || opcode == JAL</td>
</tr>
<tr class="even">
<td>PCSrc_2</td>
<td>PC = PC + 4</td>
<td>16 位立即数跳转</td>
<td>opcode == Bxx &amp;&amp; 条件满足</td>
</tr>
</tbody>
</table>
<p>控制盒子：</p>
<ul>
<li>组合逻辑：根据指令解码</li>
<li>时序逻辑：将控制信号与指令关联起来的内存结构</li>
</ul>
<h1 id="多周期微架构设计-multi-cycle-microarchitecture-design">多周期微架构设计
Multi-Cycle Microarchitecture Design</h1>
<p>多周期设计的缺点：需要在每个时钟周期结束都储存当前结果</p>
<ul>
<li>硬件寄存器开销大</li>
<li>寄存器设置和保持的开销</li>
</ul>
<p>实现的思想：有限状态机</p>
<ul>
<li>状态由控制信号确定</li>
<li>下一个状态的控制信号在当前状态确定</li>
</ul>
<p>除了运行效率外，多周期微架构还有节省硬件资源的优势</p>
<ul>
<li>注意到单周期微架构使用了两个内存和三个加法器</li>
<li>多周期微架构可以在不同周期复用这些资源</li>
</ul>
<p>直接根据指令执行过程划分阶段：对于 lw 指令，有</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/指令获取.webp" alt="指令获取">
<figcaption aria-hidden="true">指令获取</figcaption>
</figure>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/读寄存器.webp" alt="读寄存器">
<figcaption aria-hidden="true">读寄存器</figcaption>
</figure>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/lw地址.webp" alt="lw地址">
<figcaption aria-hidden="true">lw地址</figcaption>
</figure>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/读内存.webp" alt="读内存">
<figcaption aria-hidden="true">读内存</figcaption>
</figure>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/写寄存器.webp" alt="写寄存器">
<figcaption aria-hidden="true">写寄存器</figcaption>
</figure>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/增加PC.webp" alt="增加PC">
<figcaption aria-hidden="true">增加PC</figcaption>
</figure>
<p>其余指令同理</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/多周期处理器.webp" alt="多周期处理器">
<figcaption aria-hidden="true">多周期处理器</figcaption>
</figure>
<p>接下来是控制单元：</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/控制单元.webp" alt="控制单元">
<figcaption aria-hidden="true">控制单元</figcaption>
</figure>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/控制单元的状态机.webp" alt="控制单元的状态机">
<figcaption aria-hidden="true">控制单元的状态机</figcaption>
</figure>
<p>但这种设计的缺陷假定了内存访问 &lt;
一个周期，所以需要设计<strong>内存准备</strong>位</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/LC-3b状态机.webp" alt="LC-3b状态机">
<figcaption aria-hidden="true">LC-3b状态机</figcaption>
</figure>
<p>微编程控制术语：</p>
<ul>
<li>微指令：和当前状态相关的控制信号</li>
<li>微顺序：从一个状态转移到另一个的动作</li>
<li>控制存储：存储每个可能的控制信号</li>
<li>微顺序器：决定哪个控制信号会被用于下一个时钟周期</li>
</ul>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/微编程控制结构.webp" alt="微编程控制结构">
<figcaption aria-hidden="true">微编程控制结构</figcaption>
</figure>
<h1 id="流水线-pipelining">流水线 Pipelining</h1>
<p>观察之前的多周期设计，可以发现在指令执行的不同阶段有一些硬件资源闲着，所以可以增加并发性</p>
<p>流水线核心思想：</p>
<ul>
<li>把指令执行周期分成不同的处理阶段</li>
<li>每个阶段处理不同的指令</li>
</ul>
<p>理想流水线：</p>
<ul>
<li>相同的操作重复</li>
<li>独立的操作重复</li>
<li>均匀划分的子操作</li>
</ul>
<p>可惜我们的设计决不是理想的流水线</p>
<p>吞吐量增大，但增加了寄存器，成本增加</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/流水线寄存器.webp" alt="流水线寄存器">
<figcaption aria-hidden="true">流水线寄存器</figcaption>
</figure>
<p>每经过一个阶段一些不用的信号可以丢弃了，即后面的寄存器会越来越小，可以节省成本</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/流水线控制信号.webp" alt="流水线控制信号">
<figcaption aria-hidden="true">流水线控制信号</figcaption>
</figure>
<p>资源竞争：两个流水线阶段需要相同的资源</p>
<p>解决方案：</p>
<ul>
<li>减少竞争造成原因</li>
<li>检查资源竞争并暂缓其中一个竞争的阶段</li>
</ul>
<p>数据依赖：</p>
<p>类型：</p>
<ul>
<li>流依赖（真实的数据依赖——写后读）</li>
<li>反依赖（读后写）</li>
<li>输出依赖（写后写）</li>
</ul>
<p>三者都会导致流水线的暂缓，但是后两者是因为寄存器的数量有限导致的，也就是依赖于一个<strong>名字</strong>，而不是<strong>值</strong></p>
<p>流依赖的六种处理方法：</p>
<ul>
<li>检测并等待直到寄存器文件中的值可用</li>
<li>检测并旁路数据至独立的指令</li>
<li>检测并在软件层次减少依赖</li>
<li>检测并把它移出，给独立指令让路</li>
<li>预测需要的值，并确认</li>
<li>做其他事（细粒度的多线程）</li>
</ul>
<p><strong>互锁
interlock</strong>：流水线处理器的指令之间检查依赖以保证正确执行</p>
<p>方法：</p>
<ul>
<li>计分板：每个寄存器文件中都有一个有效位</li>
<li>组合依赖检查：检查指令在后面是否需要写</li>
</ul>
<h1 id="流水线处理器设计-pipelined-processor-design">流水线处理器设计
Pipelined Processor Design</h1>
<p>造成流水线暂停的原因：</p>
<ul>
<li>资源竞争</li>
<li>依赖</li>
<li>长延迟（多周期）的操作</li>
</ul>
<p>暂停实现方法：</p>
<ul>
<li>关闭 PC 和 IF/ID 锁</li>
<li>在暂停的指令后插入无效指令（bubbles）</li>
</ul>
<p><strong>数据转发 data forwarding</strong>：也叫 <strong>data
bypassing</strong>，即在数据可用时就将结果值转发给依赖的指令，在写回之前</p>
<p>从内存阶段而后写回阶段转发到执行阶段，如果两者都匹配目标寄存器，则优先转发内存阶段数据，因为其更新</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/数据转发.webp" alt="数据转发">
<figcaption aria-hidden="true">数据转发</figcaption>
</figure>
<p>但是，例如 lw 指令，其最后一个阶段才会获取数据，数据转发无效</p>
<p>暂停所需的硬件：</p>
<ul>
<li>获取和解码的使能</li>
<li>执行寄存器的 CLR 或每个寄存器的有效位</li>
</ul>
<p>当 lw 暂停发生</p>
<ul>
<li>保持解码和获取阶段的寄存器的值</li>
<li>清楚执行阶段寄存器的内容，插入 bubble</li>
</ul>
<p>分支预测：特殊的数据依赖——依赖 PC</p>
<p>在分支被解决之前，分支后的指令已经被获取了</p>
<p>简单的策略：总是循序执行（总是不选择），如果分支要执行，则清空未选择路径的指令</p>
<p>分支误测的惩罚：清空的指令数</p>
<p>减少的方法：早期分支解决：在更靠前的阶段测试分支</p>
<p>基于软件的指令调度——静态调度，硬件以编译器指定的顺序执行指令，问题在于编译器不知道运行时确定的值</p>
<p><strong>细粒度多线程 Fine-grained
multithreading</strong>：每个周期从一个不同的线程中获取指令，使得同时在流水线中没有两个从同以一线程中的指令</p>
<ul>
<li>硬件有多线程上下文（PC+寄存器）</li>
<li>线程完全独立</li>
<li>直到之前的指令结束，没有指令从同一线程中获取</li>
</ul>
<p>优点：</p>
<ul>
<li>多线程吞吐量增加</li>
<li>一个线程中不需要处理控制和数据依赖的逻辑</li>
</ul>
<p>缺点：</p>
<ul>
<li>单线程效率低</li>
<li>保存线程上下文的额外逻辑</li>
<li>如果线程数量不够，则吞吐量降低</li>
</ul>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/细粒度多线程.webp" alt="细粒度多线程">
<figcaption aria-hidden="true">细粒度多线程</figcaption>
</figure>
<p>现代 GPU 常用这个方法，即超多线程和超多寄存器</p>
<h1 id="精确异常-precise-exceptions">精确异常 Precise Exceptions</h1>
<p>即保持顺序的语义</p>
<p>因为在执行阶段，不同的指令所需时间不同，所以可以在之前的长延迟的指令执行结束前，让独立的指令在不同的函数单元执行</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/多周期执行异常.webp" alt="多周期执行异常">
<figcaption aria-hidden="true">多周期执行异常</figcaption>
</figure>
<p>若第一个指令出现异常，但后面的指令已经执行完了，故无法确定这个异常是谁引起的</p>
<p>程序执行过程中为计划的改变或中断</p>
<ul>
<li><strong>内部</strong>问题：<strong>异常 exception</strong></li>
<li><strong>外部</strong>事件：<strong>中断 interrupt</strong></li>
</ul>
<p>处理时间：</p>
<ul>
<li>异常：当检测到</li>
<li>中断：当方便时，除了一些高优先级的，如没电了、机器故障等</li>
</ul>
<p>当异常/中断准备好处理时，架构状态应该一致（精确）</p>
<ul>
<li>所有之前的指令都必须完全<strong>退休 retired</strong></li>
<li>之后的指令都没有退休</li>
</ul>
<p>当最老的即将退休的指令被检测到造成异常时，控制逻辑</p>
<ul>
<li>确保架构状态精确（寄存器文件，PC，内存）</li>
<li>清楚流水线中所有年轻的指令</li>
<li>保存 PC 和寄存器</li>
<li>重定向到合适的异常处理过程</li>
</ul>
<p>精确异常的优点：</p>
<ul>
<li>便于调试程序</li>
<li>容易从异常恢复</li>
<li>容易重启过程</li>
<li>进入软件</li>
</ul>
<p>单周期不需要，多周期需要</p>
<ul>
<li>在控制 FSM 添加特殊的指向异常处理器的状态</li>
<li>只在精确状态时切换到处理器</li>
</ul>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/精确异常数据路径.webp" alt="精确异常数据路径">
<figcaption aria-hidden="true">精确异常数据路径</figcaption>
</figure>
<ul>
<li>EPC 寄存器：保留造成异常的 PC</li>
<li>Cause 寄存器：保持造成异常的原因</li>
<li>异常处理器：在地址 0x80000180 开始</li>
</ul>
<p>支持精确异常的方法：</p>
<ul>
<li>重排序缓冲区</li>
<li>历史缓冲区</li>
<li>未来寄存器文件</li>
<li>检查点</li>
</ul>
<p><strong>重排序缓冲区 Reorder
Buffer(ROB)</strong>：乱序完成指令，但是在使结果对架构状态可见之前重排序</p>
<ul>
<li>当指令<strong>解码</strong>时，把下一个顺序项保留在一个特殊的叫重排序缓冲区（ROB）的缓冲区中</li>
<li>当指令<strong>完成</strong>时，把结果写回道 ROB 项中</li>
<li>当 ROB 中最老的指令无异常完成时，结果写回到寄存器文件或内存中</li>
</ul>
<p>ROB 以硬件的队列实现：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/ROB.webp"></p>
<p>ROB：保持所有被<strong>解码</strong>但没有<strong>退休</strong>的指令的硬件结构</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/ROB2.webp"></p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/ROB项.webp" alt="ROB项">
<figcaption aria-hidden="true">ROB项</figcaption>
</figure>
<p>有效位用于跟踪结果的可读性，找出指令是否完成执行</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/ROB3.webp"></p>
<p>我们可以使用内容可寻址的方法访问 ROB，即查找最新的寄存器：</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/ROB访问1.webp" alt="ROB访问1">
<figcaption aria-hidden="true">ROB访问1</figcaption>
</figure>
<p>还可以使用间接访问，即将寄存器映射到一个 ROB 项</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/ROB访问2.webp" alt="ROB访问2">
<figcaption aria-hidden="true">ROB访问2</figcaption>
</figure>
<p>可以发现，两种假的依赖已经被消除了，增加了寄存器名字空间到 ROB
大小</p>
<p>ROB 的缺点：需要访问 ROB
以得到还没有写入寄存器文件的值，延迟和复杂度都上升了</p>
<h1 id="乱序执行-out-of-order-execution">乱序执行 Out-of-Order
Execution</h1>
<p>也称动态指令调度</p>
<p><strong>分发 dispatch</strong>：把指令发送到函数单元的动作</p>
<p>注意到顺序流水线的问题是一个未准备好的指令阻塞了更年轻的指令分发到函数单元</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/阻塞发送.webp"></p>
<p>上图的第二条指令在等待第一条指令完成，但是第三条指令明明与前两条指令独立，可以先执行，却被第二条指令暂停了</p>
<p>乱序执行类似于数据流结构，但是并不暴露给 ISA</p>
<p>思想：将未准备好的指令移除出独立的指令的路</p>
<p>优点：延迟容忍：运行独立的指令在有一个长延迟的操作的情况下执行并完成</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/顺序执行vs乱序执行.webp" alt="顺序执行vs乱序执行">
<figcaption aria-hidden="true">顺序执行vs乱序执行</figcaption>
</figure>
<p>OoO 执行：</p>
<ul>
<li>将值的消费者而后生产者连接起来：寄存器重命名：每个数据值关联一个标签</li>
<li>在指令准备好执行前缓存：在重命名后插入到<strong>保留区 Reservation
stations(RS)</strong> 中</li>
<li>指令需要跟踪源值的可读性：
<ul>
<li>在值生产后<strong>广播 broadcast</strong> 标签</li>
<li>指令将它们的源标签与广播标签比较，若相同，则源值准备好了</li>
</ul></li>
<li>当一个指令的所有源值都准备好了，则发送指令到 FU 中
<ul>
<li>如果所有的源值都准备好了，则指令<strong>唤醒 wake up</strong></li>
<li>如果多重指令醒着，则需要选择为每个 FU <strong>选择</strong>一个</li>
</ul></li>
</ul>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/两个驼峰.webp" alt="两个驼峰">
<figcaption aria-hidden="true">两个驼峰</figcaption>
</figure>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/乱序执行.webp" alt="乱序执行">
<figcaption aria-hidden="true">乱序执行</figcaption>
</figure>
<p>关键路径：标签广播-&gt;值捕捉-&gt;指令唤醒</p>
<p>保存区：中心化 vs 分布式</p>
<p>精确异常：和之前一样</p>
<p>一条指令在执行完成后更新 RAT（<strong>前端寄存器文件 frontend
register
file</strong>），在退休后如果是最老的指令，则更新架构寄存器文件</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/乱序执行寄存器文件.webp" alt="乱序执行寄存器文件">
<figcaption aria-hidden="true">乱序执行寄存器文件</figcaption>
</figure>
<p>可以发现寄存器中存了很多重复的值，可以将其存一个较小的指针，指向一个大寄存器表（物理
RF）</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/重复寄存器解决方案.webp" alt="重复寄存器解决方案">
<figcaption aria-hidden="true">重复寄存器解决方案</figcaption>
</figure>
<p>乱序执行总结：</p>
<ul>
<li>链接</li>
<li>缓存</li>
<li>跟踪可读性</li>
<li>发送</li>
</ul>
<p>乱序执行实际上动态地找到了程序中的平行操作</p>
<h1 id="超标量执行-superscalar-execution">超标量执行 Superscalar
Execution</h1>
<p>思想：一个周期获取，解码，执行，退休多条指令</p>
<p>硬件实现了同时获取的指令的依赖性</p>
<p>超标量执行和乱序执行是<strong>正交</strong>的概念</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/超标量执行.webp" alt="超标量执行">
<figcaption aria-hidden="true">超标量执行</figcaption>
</figure>
<h1 id="分支预测-branch-prediction">分支预测 Branch Prediction</h1>
<p>处理控制依赖：</p>
<ul>
<li>暂停流水线直到知道下一个获取的地址</li>
<li>猜测下一个获取地址（分支预测）</li>
<li>实施延迟分支（分支延迟槽）</li>
<li>做其他事（细粒度多线程）</li>
<li>减少控制流指令（预测执行）</li>
<li>两个可能的路径都获取（多路径执行）</li>
</ul>
<p>最简单的方法：NextPC = PC + 4</p>
<p>优化方法：编译器提前预测两个分支执行的可能性，将概率高的放在顺序位置</p>
<p>摆脱控制流指令：</p>
<ul>
<li>摆脱不必要的控制流指令——组合预测并检测一次</li>
<li>把控制依赖转化为数据依赖——预测执行（也叫做 if 转换）</li>
</ul>
<p><strong>分布预测 Branch Prediction</strong></p>
<p>思想：预测下一条获取的地址</p>
<p>观察到对于一个直接条件分支，目标地址是相同的</p>
<p>思想：从之前的实例中存储目标地址，并用 PC 访问</p>
<p>叫做<strong>分支目标缓存 Branch Target Buffer(BTB)</strong></p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/分支目标缓存.webp" alt="分支目标缓存">
<figcaption aria-hidden="true">分支目标缓存</figcaption>
</figure>
<p>静态分支预测：</p>
<ul>
<li>总是不选择：编译器排列好了代码</li>
<li>总是选择：对于循环来说非常有优势</li>
<li>这两者的优点可以兼顾，即<strong>后向选择，前向不选择（BTFN）</strong>，即循环总是选择，条件分支总是不选择</li>
</ul>
<p><strong>基于剖析
profile-based</strong>：编译器使用剖析运行决定每个分支的可能的方向</p>
<p>缺点：</p>
<ul>
<li>需要在分支指令格式上有提示位</li>
<li>准确性依赖于动态分支表现</li>
<li>准确性依赖于剖析输入数据的代表性</li>
</ul>
<h1 id="进阶分支预测-advanced-branch-prediction">进阶分支预测 Advanced
Branch Prediction</h1>
<p><strong>基于程序
program-based</strong>：使用基于程序分析的启发式决定静态预测方向，例如预测循环总是选择，异常处理总是不选择</p>
<p>缺点：</p>
<ul>
<li>启发式可能不具有代表性</li>
<li>需要编译器分析和 ISA 支持</li>
</ul>
<p><strong>基于程序员
programmer-based</strong>：程序员提供静态预测方向，通过在编程语言中使用
<strong>pragmas</strong> 实现</p>
<p>缺点：需要程序员、编程语言、编译器、ISA 支持</p>
<p>pragmas：使程序员能够向低层次表达提示的关键词，如
<code>if(likely(x))</code>,<code>#pragma omp parallel</code></p>
<p>这三种静态技术的缺点都是无法适应<strong>动态</strong>改变</p>
<p><strong>上次预测 last time
predictor</strong>：猜测分支和其上次一样，需要在 BTB 中存储一个位</p>
<p>优点在于对于较大的 K 的循环，准确率非常高</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/上次预测1.webp"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/上次预测2.webp"></p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/上次预测状态机.webp" alt="上次预测状态机">
<figcaption aria-hidden="true">上次预测状态机</figcaption>
</figure>
<p>可以观察到这种方法改变地太快了，只看到一次改变就改变了自己的看法</p>
<p><strong>基于两位计时器的预测 tow-bit counter based
prediction</strong>：每个分支和两位计时器关联，即提供了滞后</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/两位计时器滞后.webp" alt="两位计时器滞后">
<figcaption aria-hidden="true">两位计时器滞后</figcaption>
</figure>
<p><strong>两级预测 two-level
Prediction</strong>：前两者都探索了<strong>上次</strong>预测，还可以从其他维度观察：</p>
<ul>
<li>一个分支的结果可能而后其他分支的结果有关——全局分支关联</li>
<li>一个分支的结果可能和相同分支的过去结果有关（注意不是<strong>上次</strong>）——局部分支关联</li>
</ul>
<p><strong>全局分支关联 global branch
correlation</strong>将分支结果和<strong>所有分支的全局历史</strong>关联，基于上次相同全局分支历史出现的分支结果预测分支</p>
<p>实现：</p>
<ul>
<li>所有分支的全局历史——全局历史寄存器（GHR）</li>
<li>使用 GHR 索引记录结果的表</li>
</ul>
<p>两级历史——GHR + GHR 处的历史</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/两级全局分支预测.webp" alt="两级全局分支预测">
<figcaption aria-hidden="true">两级全局分支预测</figcaption>
</figure>
<p>改进：向全局预测器添加正在选择的分支的上下文</p>
<p>Gshare 预测器：用分支 PC 哈希 GHR</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/Gshare预测器.webp" alt="Gshare预测器">
<figcaption aria-hidden="true">Gshare预测器</figcaption>
</figure>
<p><strong>局部分支关联 local Branch
correlation</strong>：有每个分支历史寄存器，基于上次相同局部分支历史出现的分支结果预测分支</p>
<p>两级历史——每个分支历史寄存器 + 历史寄存器值处的历史</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/两级局部分支预测.webp" alt="两级局部分支预测">
<figcaption aria-hidden="true">两级局部分支预测</figcaption>
</figure>
<p>两级预测器分类：</p>
<ul>
<li>BHR 可以是全局的，每个分支集的，每个分支的</li>
<li>PHT 可以是全局的，每个分支集的，每个分支的</li>
</ul>
<p>这些方法各有适用的分支类型，无法对所有分支都适用</p>
<p><strong>混合分支预测器 hybrid branch
predictors</strong>：使用不止一个预测器，选择最佳的预测</p>
<ul>
<li>有偏向分支：许多分支都偏向于一个方向</li>
<li>这些分支污染了分支预测结构</li>
<li>检测这些有偏向的分支，使用更简单的预测器预测他们</li>
</ul>
<p>其他分支预测器类型：</p>
<ul>
<li>循环分支检测器和预测器：计数循环迭代次数</li>
<li>感知机分支预测器：使用简单的机器学习算法赋权值</li>
<li>基于混合历史长度的预测器：使用不同历史长度的不同表</li>
</ul>
<p><strong>感知机 perceptron</strong>
是一个简化的神经元模型，也叫做二项分类器</p>
<ul>
<li>输入向量 X，X 为历史寄存器的每个位</li>
<li>感知机学习向量的每个元素如何影响输出，并存储在内部的加权向量中</li>
<li>输出 Weight @ X + Bias &gt; 0，即当前分支的预测结果</li>
</ul>
<p><strong>使用多重历史长度的预测器</strong>：有多个用不同的历史长度的
GHR 索引的 PHT</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/使用多重历史长度的预测器.webp" alt="使用多重历史长度的预测器">
<figcaption aria-hidden="true">使用多重历史长度的预测器</figcaption>
</figure>
<p><strong>分支自信度估计 branch confidence
estimation</strong>：估计预测正确的可能性</p>
<p>实现：</p>
<ul>
<li>记录过去 N 个分支的实例的正确/错误结果</li>
<li>基于这些匹配，猜测当前预测是否正确</li>
</ul>
<p><strong>延迟分支 delayed branch</strong>：延迟分支执行，在分支后的 N
条指令不管分支方向，总是执行</p>
<ul>
<li>份额只必须和延迟槽指令独立</li>
</ul>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/延迟分支.webp" alt="延迟分支">
<figcaption aria-hidden="true">延迟分支</figcaption>
</figure>
<p><strong>带压扁的延迟分支 delayed branch with squashing</strong>：在
ISA 中的语法：如果分支未选择，则延迟槽中的指令不执行</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/带压扁的延迟分支.webp" alt="带压扁的延迟分支">
<figcaption aria-hidden="true">带压扁的延迟分支</figcaption>
</figure>
<p>缺点：延迟槽难以填满</p>
<h1 id="vliw-结构脉动阵列结构解耦合访问-执行-vliw-systolic-array-architectures-decoupled-access-execute">VLIW
结构，脉动阵列结构，解耦合访问-执行 VLIW, Systolic Array Architectures,
Decoupled Access-Execute</h1>
<p><strong>VLIW（Very Long Instruction
Word）</strong>：编译器把独立的指令打包到一起，硬件同时获取和执行这些指令</p>
<p>不需要硬件上的依赖性检查</p>
<p>Lock-step 执行：如果有一个 VLIW
指令中的任何操作暂停，则所有同时的操作暂停</p>
<p>所以 VLIW 的问题在于操作延迟可能是可变的</p>
<p>可以发现 VLIW 在嵌入式，DSP，一些 GPU
中比较成功，其原因是容易找到平行操作</p>
<p><strong>超级块
superblock</strong>：将频繁执行的基础块组合，形成一个<strong>单入口多出口</strong>的大块，就像直线的代码一样</p>
<p>缺点：</p>
<ul>
<li>增加代码大小</li>
<li>需要重新编译</li>
<li>依赖剖析</li>
</ul>
<p>其可用于编译器优化：</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/超级块代码优化.webp" alt="超级块代码优化">
<figcaption aria-hidden="true">超级块代码优化</figcaption>
</figure>
<p><strong>Systolic Array Architectures
脉动阵列结构</strong>：特定目的的加速器，现在常用于机器学习加速器</p>
<p>思想：用 PE 的阵列替代一个执行单元（PE）并小心地协调 PE
间的数据流</p>
<p>这种做法的好处：最大化在一个从内存中出来的数据上的计算</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/脉冲计算卷积.webp" alt="脉冲计算卷积">
<figcaption aria-hidden="true">脉冲计算卷积</figcaption>
</figure>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/2D脉冲阵列计算.webp" alt="2D脉冲阵列计算">
<figcaption aria-hidden="true">2D脉冲阵列计算</figcaption>
</figure>
<p>优点：I/O 带宽大</p>
<p>也可以使用流水线，把计算划分成多个阶段：</p>
<p><strong>解耦合访问执行 decoupled
access-execute(DAE)</strong>：通过两个分离的指令流，其通过 ISA
可见的队列通信，以解耦合访问和执行的操作</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/DAE.webp" alt="DAE">
<figcaption aria-hidden="true">DAE</figcaption>
</figure>
<p>指令示例：</p>
<table>
<thead>
<tr class="header">
<th>访问</th>
<th>执行</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>AEQ+z+10, A2</td>
<td>x4+x2*f AEQ</td>
</tr>
<tr class="even">
<td>x, A2 +EAQ</td>
<td>EAQ+AEQ*f X6</td>
</tr>
</tbody>
</table>
<p>这种方法的优点在于两个操作可以不用等待另一个操作</p>
<p>缺点：</p>
<ul>
<li>编译器需要划分程序和管理队列</li>
<li>分支指令需要同步</li>
</ul>
<h1 id="simd-处理器-simd-processors">SIMD 处理器 SIMD Processors</h1>
<p>四种划分：</p>
<ul>
<li>SISD：单指令操作单数据元素</li>
<li>SIMD：单指令操作多数据元素
<ul>
<li>阵列处理器，向量处理器</li>
</ul></li>
<li>MISD：多指令操作单数据元素
<ul>
<li>脉动阵列结构</li>
</ul></li>
<li>MIMD：多指令操作多数据元素
<ul>
<li>多处理器</li>
<li>多线程处理器</li>
</ul></li>
</ul>
<p>SIMD
的并发出现在对<strong>不同</strong>部分数据执行<strong>相同</strong>的操作，即采用了对不同数据的操作级别的平行</p>
<p><strong>多处理元素（PE）</strong></p>
<p>时间-空间对偶</p>
<ul>
<li>阵列处理器 Array
processor：<strong>同时</strong>使用<strong>不同空间</strong>操作多重数据</li>
<li>向量处理器 Vector
processor：在<strong>相同空间</strong>以<strong>连续时间</strong>步数操作多重数据</li>
</ul>
<p>存储多重数据元素：向量寄存器</p>
<p>每个<strong>向量数据寄存器 vector data register</strong> 保持 N 个 M
bit 的值</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/向量寄存器.webp" alt="向量寄存器">
<figcaption aria-hidden="true">向量寄存器</figcaption>
</figure>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/阵列处理器vs向量处理器.webp" alt="阵列处理器vs向量处理器">
<figcaption aria-hidden="true">阵列处理器vs向量处理器</figcaption>
</figure>
<p>向量处理器：</p>
<ul>
<li>向量寄存器</li>
<li>向量长度寄存器 VLEN</li>
<li>向量步长寄存器 VSTR</li>
</ul>
<p>向量指令允许更深的流水线：</p>
<ul>
<li>没有内部向量依赖</li>
<li>向量内部没有控制流</li>
<li>已知步长允许对所有向量元素的简单的地址计算
<ul>
<li>允许简单或更早的加载</li>
</ul></li>
</ul>
<p>Amdahl’s Law：</p>
<p><span class="math display"><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -2.915ex;" xmlns="http://www.w3.org/2000/svg" width="18.861ex" height="5.951ex" role="img" focusable="false" viewbox="0 -1342 8336.4 2630.5"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">加</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">速</text></g><g data-mml-node="mo" transform="translate(2277.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mfrac" transform="translate(3333.6,0)"><g data-mml-node="mn" transform="translate(2251.4,676)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mrow" transform="translate(220,-943.5)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g><g data-mml-node="mo" transform="translate(722.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"/></g><g data-mml-node="mi" transform="translate(1722.4,0)"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"/></g><g data-mml-node="mo" transform="translate(2494.7,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"/></g><g data-mml-node="mfrac" transform="translate(3494.9,0)"><g data-mml-node="mi" transform="translate(339.5,485) scale(0.707)"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"/></g><g data-mml-node="mi" transform="translate(220,-345) scale(0.707)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"/></g><rect width="827.9" height="60" x="120" y="220"/></g></g><rect width="4762.8" height="60" x="120" y="220"/></g></g></g></svg></mjx-container></span></p>
<p>向量寄存器：</p>
<ul>
<li><strong>向量数据寄存器</strong>保存值</li>
<li><strong>向量控制寄存器</strong>：VLEN，VSTR，VMASK
<ul>
<li>VMASK 指示要操作哪个元素，如
<code>VMASK[i] = (V[i] == 0)</code></li>
</ul></li>
</ul>
<p>向量函数单元：使用深的流水线执行元素操作</p>
<p>如果我们能每个周期开始加载一个元素，则元素可以连续周期被加载，方法就是<strong>堆积
bank</strong> 内存，通过 bank 交错元素</p>
<p>内存被划分到可以独立访问共享地址和数据总线的 bank 中</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/内存bank.webp" alt="内存bank">
<figcaption aria-hidden="true">内存bank</figcaption>
</figure>
<p>如果步长 == 1 &amp;&amp; 连续的元素交错在 bank &amp;&amp; bank 的数量
&gt;= bank 的延迟，则可以维持 1 元素/周期的吞吐量</p>
<p><strong>向量链</strong>：数据从一个向量函数单元转发到另一个</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/向量链.webp" alt="向量链">
<figcaption aria-hidden="true">向量链</figcaption>
</figure>
<p>还可以增加多个 bank 的端口</p>
<p>如果向量数据不在内存中以固定步长模式存储，则可以使用<strong>间接索引</strong>将其组合到向量寄存器中，这也对稀疏向量有益</p>
<p><strong>gather/scatter
操作</strong>：向量使用索引向量加上基寄存器来产生加载和存储的地址</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/scatter操作.webp" alt="scatter操作">
<figcaption aria-hidden="true">scatter操作</figcaption>
</figure>
<p>循环中的条件操作使用 Masked 操作</p>
<p>如果是双分支，则可以 Masked 计算 A 后取 Masked 的互补计算 B</p>
<p>Masked 有两种实现，简单实现和稠密时间实现</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/简单实现vs稠密时间实现.webp" alt="简单实现vs稠密时间实现">
<figcaption aria-hidden="true">简单实现vs稠密时间实现</figcaption>
</figure>
<p>步长和 bank 要互质</p>
<p>减小 bank 冲突：</p>
<ul>
<li>更多 bank</li>
<li>每个 bank 更多端口</li>
<li>更好的数据布局</li>
<li>更好的地址向 bank 的映射</li>
</ul>
<h1 id="图形处理单元-graphic-processing-units">图形处理单元 Graphic
Processing Units</h1>
<p>GPU 指令流水线像 <strong>SIMD</strong>
流水线一样运行，但是编程使用<strong>线程</strong>完成，即 GPU 是一个
<strong>SIMT</strong> 机器</p>
<p>执行相同指令的线程集合被硬件动态地分组到一个 warp 中</p>
<p>这个编程模型叫 <strong>SPMD</strong></p>
<p>SIMT 的优点：</p>
<ul>
<li>分别处理每个线程</li>
<li>灵活地分组线程到 warp 中</li>
</ul>
<p>warp 可以在相同流水线上交错，即 <strong>warp
的细粒度多线程</strong>，通过这个容忍了延迟</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/warp执行.webp" alt="warp执行">
<figcaption aria-hidden="true">warp执行</figcaption>
</figure>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/SIMD执行单元结构.webp" alt="SIMD执行单元结构">
<figcaption aria-hidden="true">SIMD执行单元结构</figcaption>
</figure>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/warp指令级别并行.webp" alt="warp指令级别并行">
<figcaption aria-hidden="true">warp指令级别并行</figcaption>
</figure>
<p><strong>分支发散 branch divergence</strong>：warp
内部的线程分支到不同执行路径</p>
<p>可以找到相同 PC 的线程，动态地将它们分组到一个 warp 中</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/动态warp合并.webp" alt="动态warp合并">
<figcaption aria-hidden="true">动态warp合并</figcaption>
</figure>
<p><strong>以两级调度</strong>来处理长延迟的操作</p>
<h1 id="内存概览组织与技术-memory-overview-organization-technology">内存概览，组织与技术
Memory Overview, Organization &amp; Technology</h1>
<p>内存的阵列组织：M bit 的值可以在每个独特的 N bit 的地址读写</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/内存的阵列组织.webp" alt="内存的阵列组织">
<figcaption aria-hidden="true">内存的阵列组织</figcaption>
</figure>
<p>访问晶体管连接 bit 存储到 bitline，由 wordline 控制访问</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/访问控制.webp" alt="访问控制">
<figcaption aria-hidden="true">访问控制</figcaption>
</figure>
<p>随着内存越来越大，速度也越来越慢，所以需要<strong>将内存划分成更小的阵列</strong></p>
<p>DRAM 的层次结构：Channel -&gt; rank -&gt; bank -&gt; subarrays -&gt;
Mats</p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/Channel.webp" alt="Channel">
<figcaption aria-hidden="true">Channel</figcaption>
</figure>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/module.webp" alt="module">
<figcaption aria-hidden="true">module</figcaption>
</figure>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/rank.webp" alt="rank">
<figcaption aria-hidden="true">rank</figcaption>
</figure>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/bank.webp" alt="bank">
<figcaption aria-hidden="true">bank</figcaption>
</figure>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/chip.webp" alt="chip">
<figcaption aria-hidden="true">chip</figcaption>
</figure>
<p><strong>动态随机访问内存 dynamic random access
memory(DRAM)</strong>：</p>
<ul>
<li>电容充电状态储存值</li>
<li>电容通过 RC 电路泄漏，故需要 refresh</li>
</ul>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/SRAM读.webp" alt="SRAM读">
<figcaption aria-hidden="true">SRAM读</figcaption>
</figure>
<p><strong>相变内存 phase change memory</strong>：非易失内存</p>
<h1 id="内存层次结构与缓存-memory-hierachy-and-caches">内存层次结构与缓存
Memory Hierachy and Caches</h1>
<p>由于速度、成本、容量等的权衡，就有了内存的层次结构</p>
<p>手动管理缓存（GPU，ML 加速器） vs 自动管理缓存</p>
<p>递归延迟等式：</p>
<p><span class="math display"><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.471ex;" xmlns="http://www.w3.org/2000/svg" width="17.866ex" height="2.002ex" role="img" focusable="false" viewbox="0 -677 7896.9 885"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"/></g><g data-mml-node="mi" transform="translate(617,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g></g><g data-mml-node="mo" transform="translate(1188.7,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="msub" transform="translate(2244.5,0)"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g><g data-mml-node="mi" transform="translate(394,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g></g><g data-mml-node="mo" transform="translate(3154.7,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"/></g><g data-mml-node="msub" transform="translate(4154.9,0)"><g data-mml-node="mi"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mi" transform="translate(911,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g></g><g data-mml-node="mo" transform="translate(5582.1,0)"><path data-c="22C5" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190T96 207T78 250Z"/></g><g data-mml-node="msub" transform="translate(6082.3,0)"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"/></g><g data-mml-node="TeXAtom" transform="translate(617,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mo" transform="translate(345,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"/></g><g data-mml-node="mn" transform="translate(1123,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g></g></g></g></g></svg></mjx-container></span></p>
<p>其中 <span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.357ex;" xmlns="http://www.w3.org/2000/svg" width="2.726ex" height="1.357ex" role="img" focusable="false" viewbox="0 -442 1205 599.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g><g data-mml-node="mi" transform="translate(911,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g></g></g></g></svg></mjx-container></span> 表示 miss 的概率，<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.357ex;" xmlns="http://www.w3.org/2000/svg" width="1.556ex" height="1.773ex" role="img" focusable="false" viewbox="0 -626 688 783.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"/></g><g data-mml-node="mi" transform="translate(394,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g></g></g></g></svg></mjx-container></span> 表示访问的时间，<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.357ex;" xmlns="http://www.w3.org/2000/svg" width="2.061ex" height="1.889ex" role="img" focusable="false" viewbox="0 -677 911 834.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"/></g><g data-mml-node="mi" transform="translate(617,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g></g></g></g></svg></mjx-container></span> 表示实际访问时间</p>
<p>三种映射方法：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/内存映射关联.webp"></p>
<p>更高的关联度：</p>
<ul>
<li>更高的命中率</li>
<li>更慢的缓存访问时间</li>
<li>更贵的硬件</li>
</ul>
<h1 id="进阶缓存-advanced-caches">进阶缓存 Advanced Caches</h1>
<p>驱逐方法：</p>
<p><strong>最小最近访问的块 LRU</strong>：问题在于跟踪块的访问顺序</p>
<p>所以通常使用近似的 LRU，如</p>
<ul>
<li>Not MRU（非最近使用）</li>
<li>层次结构 LRU：划分到 M 个组，跟踪 MRU 组和每个组中的 MRU</li>
<li>受害者-下一个受害者替换</li>
</ul>
<p><strong>集合痛打 set
thrashing</strong>：一个程序工作集合大于集合关联性</p>
<ul>
<li>当 thrashing 出现时，随机取代更好</li>
</ul>
<p>在实践中，表现依赖于负载，LRU
和随机的平均命中率差不多，一般两者混合使用，通过<strong>集合采样</strong>选择</p>
<p><strong>Balady's OPT</strong>：取代未来被引用最远的块</p>
<ul>
<li>最优化 miss 比率，但是没有最优化执行时间，因为没有考虑 miss
的延迟</li>
</ul>
<p>处理写：</p>
<p>是否写到下一级？</p>
<ul>
<li>write-back：
<ul>
<li>在驱逐之前将多重写组合到一个块中</li>
<li>但需要 tag 中 dirty bit</li>
</ul></li>
<li>write-through：
<ul>
<li>设计简单</li>
<li>缓存一致</li>
<li>但是带宽受限</li>
</ul></li>
</ul>
<p>写 miss 的时候是否分配缓存块？</p>
<ul>
<li>分配：
<ul>
<li>组合写</li>
<li>写和读一样，处理更简单</li>
<li>但是需要整个缓存块的转移</li>
</ul></li>
<li>不分配：
<ul>
<li>如果写的局部性差，则节约缓存空间</li>
</ul></li>
</ul>
<p>如果每次只写块的一部分，则可以使用<strong>子块 subblock</strong>
缓存</p>
<ul>
<li>每个子块都有独立的有效和脏位</li>
<li>一次请求只分配一个子块</li>
</ul>
<p>优点：</p>
<ul>
<li>无需转移整个缓存块</li>
<li>转移更自由</li>
</ul>
<p>缺点：</p>
<ul>
<li>设计复杂</li>
<li>没有完全利用空间局部性</li>
</ul>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/子块缓存.webp" alt="子块缓存">
<figcaption aria-hidden="true">子块缓存</figcaption>
</figure>
<p>指令和数据缓存：</p>
<p>统一：</p>
<ul>
<li>动态共享缓存空间</li>
<li>但是指令和数据会互相驱逐，即不保证都有空间</li>
<li>指令和数据在流水线的不同阶段访问，统一缓存的位置不易确定</li>
</ul>
<p>故通常：</p>
<ul>
<li>一级缓存分离——流水线约束</li>
<li>更高级缓存统一</li>
</ul>
<p>流水线设计中的多级缓存：</p>
<ul>
<li>一级缓存
<ul>
<li>受时钟周期影响</li>
<li>小，更低的关联；延迟很重要</li>
<li>tag 和 data 储存<strong>并行</strong>访问</li>
</ul></li>
<li>二级缓存
<ul>
<li>平衡 hit 比率和访问延迟</li>
<li>大而高的关联度；延迟没那么重要</li>
<li>tag 和 data 储存<strong>顺序</strong>访问</li>
</ul></li>
</ul>
<p>顺序 serial：</p>
<ul>
<li>只有一级缓存 miss 了，二级缓存才会访问</li>
</ul>
<p><strong>缓存性能：</strong></p>
<p><strong>缓存大小</strong></p>
<ul>
<li>过大：速度慢</li>
<li>过小：时间局部性利用率差，经常要替换数据</li>
</ul>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/缓存大小.webp" alt="缓存大小">
<figcaption aria-hidden="true">缓存大小</figcaption>
</figure>
<p><strong>块大小</strong></p>
<ul>
<li>过大：
<ul>
<li>时间局部性利用差</li>
<li>tag 开销大</li>
</ul></li>
<li>过小：
<ul>
<li>空间局部性利用差</li>
<li>浪费带宽</li>
</ul></li>
</ul>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/块大小.webp" alt="块大小">
<figcaption aria-hidden="true">块大小</figcaption>
</figure>
<p>更大的块：</p>
<p>填入时间长：关键字</p>
<ul>
<li>先用关键字填充缓存块</li>
<li>立刻向处理器提供关键数据</li>
</ul>
<p>浪费带宽：划分为子块</p>
<ul>
<li>每个块有有效位和脏位</li>
</ul>
<p><strong>关联性：</strong></p>
<ul>
<li>大：miss 率低，延迟和花费大</li>
<li>小：花费小，延迟低</li>
</ul>
<p>缓存 miss 的分类：</p>
<ul>
<li>义务 miss：第一次引用地址会 miss
<ul>
<li>预获取</li>
</ul></li>
<li>容量 miss：缓存太小，不能保存所有东西
<ul>
<li>更好地利用缓存空间</li>
</ul></li>
<li>冲突 miss：不是前两者的 miss
<ul>
<li>更多关联</li>
</ul></li>
</ul>
<p>重建数据访问模式：</p>
<ul>
<li>循环交换</li>
<li>分块</li>
<li>分离数据结构常用的域并把它们包装到一个分开的数据结构中</li>
</ul>
<p><strong>内存级别并行 Memory Level Parallelism(MLP)</strong></p>
<figure>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/ETH%20Zurich：数字设计与计算机体系结构/内存级别并行.webp" alt="内存级别并行">
<figcaption aria-hidden="true">内存级别并行</figcaption>
</figure>
<p>所以从这个角度看，miss 的花费是不一样的，孤立 miss 比并行 miss
更重要</p>
<p>多核系统中的缓存：</p>
<p>共享缓存：多个上下文使用一个硬件资源</p>
<p>优点：</p>
<ul>
<li>提高容量利用率</li>
<li>动态划分可用缓存空间</li>
<li>维持一致性更简单</li>
</ul>
<p>缺点：</p>
<ul>
<li>资源争夺</li>
<li>访问慢</li>
</ul>
<p>缓存一致性的解决方法：所有缓存<strong>窥探 snoop</strong>
互相的读写操作，如果一个处理器写到了一个块中，所有其他的缓存使块无效</p>
<h1 id="预读-prefetching">预读 Prefetching</h1>
<p><strong>预读 prefetching</strong>：在数据被程序需要前读取它</p>
<ul>
<li>可以减少延迟</li>
<li>减少义务 miss</li>
<li>不会有较大的错误预期的惩罚</li>
</ul>
<p>带宽消耗</p>
<p>增加 window 的大小以忍受内存延迟</p>
<p><strong>超前执行 runahead
execution</strong>：从大的指令窗口中受益，可以维护内存级别的并行</p>
<ul>
<li>目的是生成预读取</li>
</ul>
<p>优点：</p>
<ul>
<li>精确预读取</li>
<li>实现简单——绝大多数硬件已经有了</li>
<li>没有上下文的浪费</li>
<li>无需创建预执行线程</li>
</ul>
<p>缺点：</p>
<ul>
<li>额外执行指令</li>
<li>效率受可用的内存级别并行的限制</li>
<li>预读取距离受内存延迟限制</li>
</ul>
<h1 id="虚拟内存-virtual-memory">虚拟内存 Virtual Memory</h1>
<p>页表过大——<strong>多级页表</strong></p>
<p>指令获取或读写都需要至少两次内存访问——<strong>翻译查找缓冲
TLB</strong></p>
<p>虚拟内存需要哦软件和硬件的支持，硬件组件叫 MMU</p>
<p>时钟页替代算法：</p>
<ul>
<li>在内存中保持物理栈帧的循环列表</li>
<li>保持指针为最后检查的栈帧</li>
<li>当页被访问时，设置 PTE 中的 R 位</li>
<li>当一个栈帧需要被替代时，替代第一个 R
位没有设置的栈帧，顺时针清除遍历的 R bit</li>
</ul>
<p>Row Hammer：</p>
<ul>
<li>把物理内存填充满 PTE，其指向相同的物理文件</li>
<li>如果 PTE 中的一个 bit
翻转，则对应的虚拟内存地址指向错误的物理页，且有 RW 权限</li>
<li>攻击者可以读写页表，映射到任意拥有读写权限的内存</li>
</ul>
<p>如果 TLB miss，则需要 <strong>walk</strong> 页表</p>
<p>缓存是虚拟地址还是物理地址？</p>
<ul>
<li>虚拟
<ul>
<li>相同的 VA 映射到不同的 PA</li>
<li>不同的 VA 映射到相同的 PA</li>
</ul></li>
<li>物理：延迟大</li>
</ul>
<p>所以对于一级缓存，通常两者都使用；对于更高级的缓存，则延迟不是那么重要</p>
<p>L2 TLB 中的 4KB/2MB 结构有 2 步：</p>
<ul>
<li>假设页表大小为 4 KB，访问，如果失败，进行下一步</li>
<li>假设页表大小为 2 MB，访问，如果失败，miss</li>
<li>即时间上的关联性</li>
</ul>
<p>虚拟环境的虚拟内存原理相似，只是由软件实现</p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/">体系结构</a><a class="post-meta__tags" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/">计算机科学</a><a class="post-meta__tags" href="/tags/ETH-Zurich/">ETH Zurich</a></div><div class="post_share"><div class="social-share" data-image="/gallery/cover/ETH%20Zurich%EF%BC%9A%E6%95%B0%E5%AD%97%E8%AE%BE%E8%AE%A1%E4%B8%8E%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/12e06b11.html" title="她善写月亮，却并不圆满"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/%E5%82%B2%E6%85%A2%E4%B8%8E%E5%81%8F%E8%A7%81.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">她善写月亮，却并不圆满</div></div></a></div><div class="next-post pull-right"><a href="/posts/518e2799.html" title="UCB CS61C：计算机架构的伟大思想"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/UCB%20CS61C%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%9E%B6%E6%9E%84%E7%9A%84%E4%BC%9F%E5%A4%A7%E6%80%9D%E6%83%B3.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">UCB CS61C：计算机架构的伟大思想</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="iconfont icon-tuijian"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/518e2799.html" title="UCB CS61C：计算机架构的伟大思想"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/UCB%20CS61C%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E6%9E%B6%E6%9E%84%E7%9A%84%E4%BC%9F%E5%A4%A7%E6%80%9D%E6%83%B3.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-24</div><div class="title">UCB CS61C：计算机架构的伟大思想</div></div></a></div><div><a href="/posts/fb3794ef.html" title="Coursera Nand2Tetris：依据基本原理构建现代计算机：从与非门到俄罗斯方块"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/Coursera%20Nand2Tetris%EF%BC%9A%E4%BE%9D%E6%8D%AE%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86%E6%9E%84%E5%BB%BA%E7%8E%B0%E4%BB%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%EF%BC%9A%E4%BB%8E%E4%B8%8E%E9%9D%9E%E9%97%A8%E5%88%B0%E4%BF%84%E7%BD%97%E6%96%AF%E6%96%B9%E5%9D%97.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-28</div><div class="title">Coursera Nand2Tetris：依据基本原理构建现代计算机：从与非门到俄罗斯方块</div></div></a></div><div><a href="/posts/e7a99a5e.html" title="UCB CS61A：计算机程序的构造与解释"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/UCB%20CS61A%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%9E%84%E9%80%A0%E4%B8%8E%E8%A7%A3%E9%87%8A.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-14</div><div class="title">UCB CS61A：计算机程序的构造与解释</div></div></a></div><div><a href="/posts/7ea0cbe4.html" title="UCB CS61B：数据结构与算法"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/UCB%20CS61B%EF%BC%9A%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-30</div><div class="title">UCB CS61B：数据结构与算法</div></div></a></div><div><a href="/posts/dcdf88c8.html" title="计算机科学速成课"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E9%80%9F%E6%88%90%E8%AF%BE.webp" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-19</div><div class="title">计算机科学速成课</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/%E5%A4%B4%E5%83%8F_%E7%81%B0%E5%A4%AA%E7%8B%BC.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info__name">old_driver_zero</div><div class="author-info__description">我一定会回来的</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">99</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">156</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="/atom.xml" target="_blank" title="RSS"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-RSS_flat"/></svg></a><a class="social-icon faa-parent animated-hover" href="https://github.com/old-driver-zero" target="_blank" title="GitHub" rel="external nofollow noopener noreferrer"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-github"/></svg></a><a class="social-icon faa-parent animated-hover" href="mailto:2771503468@qq.com" target="_blank" title="QQ邮箱" rel="external nofollow noopener noreferrer"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-youxiang"/></svg></a><a class="social-icon faa-parent animated-hover" href="https://steamcommunity.com/id/old_driver_zero" target="_blank" title="Steam" rel="external nofollow noopener noreferrer"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-steam"/></svg></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><a class="faa-parent animated-hover"><svg class="faa-tada icon" style="height:25px;width:25px;fill:currentColor;position:relative;top:5px" aria-hidden="true"><use xlink:href="#icon-mulu"/></svg></a><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%95%E8%A8%80%E4%B8%8E%E5%9F%BA%E7%A1%80-introduction-and-basics"><span class="toc-number">1.</span> <span class="toc-text">引言与基础 Introduction and
Basics</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9D%83%E8%A1%A1%E6%8C%87%E6%A0%87-tradeoffs-metrics"><span class="toc-number">2.</span> <span class="toc-text">权衡，指标 Tradeoffs, Metrics</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E9%80%BB%E8%BE%91%E7%94%B5%E8%B7%AF-combinational-logic"><span class="toc-number">3.</span> <span class="toc-text">组合逻辑电路 Combinational
Logic</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%B6%E5%BA%8F%E9%80%BB%E8%BE%91%E8%AE%BE%E8%AE%A1-sequential-logic-design"><span class="toc-number">4.</span> <span class="toc-text">时序逻辑设计 Sequential
Logic Design</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E6%8F%8F%E8%BF%B0%E8%AF%AD%E8%A8%80%E5%92%8C-verilog-hardware-desccription-languages-and-verilog"><span class="toc-number">5.</span> <span class="toc-text">硬件描述语言和
Verilog Hardware Desccription Languages and Verilog</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%92%8C%E9%AA%8C%E8%AF%81-timing-and-verification"><span class="toc-number">6.</span> <span class="toc-text">时间和验证 Timing and
Verification</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%AF%E8%AF%BA%E4%BE%9D%E6%9B%BC%E7%BB%93%E6%9E%84-von-neumann-model"><span class="toc-number">7.</span> <span class="toc-text">冯诺依曼结构 Von Neumann
Model</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8C%87%E4%BB%A4%E9%9B%86%E6%9E%B6%E6%9E%84-instruction-set-architectures"><span class="toc-number">8.</span> <span class="toc-text">指令集架构 Instruction
Set Architectures</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BE%AE%E6%9E%B6%E6%9E%84-microarchitecture"><span class="toc-number">9.</span> <span class="toc-text">微架构 Microarchitecture</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%9A%E5%91%A8%E6%9C%9F%E5%BE%AE%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1-multi-cycle-microarchitecture-design"><span class="toc-number">10.</span> <span class="toc-text">多周期微架构设计
Multi-Cycle Microarchitecture Design</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B5%81%E6%B0%B4%E7%BA%BF-pipelining"><span class="toc-number">11.</span> <span class="toc-text">流水线 Pipelining</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%A4%84%E7%90%86%E5%99%A8%E8%AE%BE%E8%AE%A1-pipelined-processor-design"><span class="toc-number">12.</span> <span class="toc-text">流水线处理器设计
Pipelined Processor Design</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B2%BE%E7%A1%AE%E5%BC%82%E5%B8%B8-precise-exceptions"><span class="toc-number">13.</span> <span class="toc-text">精确异常 Precise Exceptions</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B9%B1%E5%BA%8F%E6%89%A7%E8%A1%8C-out-of-order-execution"><span class="toc-number">14.</span> <span class="toc-text">乱序执行 Out-of-Order
Execution</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B6%85%E6%A0%87%E9%87%8F%E6%89%A7%E8%A1%8C-superscalar-execution"><span class="toc-number">15.</span> <span class="toc-text">超标量执行 Superscalar
Execution</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%86%E6%94%AF%E9%A2%84%E6%B5%8B-branch-prediction"><span class="toc-number">16.</span> <span class="toc-text">分支预测 Branch Prediction</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%9B%E9%98%B6%E5%88%86%E6%94%AF%E9%A2%84%E6%B5%8B-advanced-branch-prediction"><span class="toc-number">17.</span> <span class="toc-text">进阶分支预测 Advanced
Branch Prediction</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#vliw-%E7%BB%93%E6%9E%84%E8%84%89%E5%8A%A8%E9%98%B5%E5%88%97%E7%BB%93%E6%9E%84%E8%A7%A3%E8%80%A6%E5%90%88%E8%AE%BF%E9%97%AE-%E6%89%A7%E8%A1%8C-vliw-systolic-array-architectures-decoupled-access-execute"><span class="toc-number">18.</span> <span class="toc-text">VLIW
结构，脉动阵列结构，解耦合访问-执行 VLIW, Systolic Array Architectures,
Decoupled Access-Execute</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#simd-%E5%A4%84%E7%90%86%E5%99%A8-simd-processors"><span class="toc-number">19.</span> <span class="toc-text">SIMD 处理器 SIMD Processors</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%BE%E5%BD%A2%E5%A4%84%E7%90%86%E5%8D%95%E5%85%83-graphic-processing-units"><span class="toc-number">20.</span> <span class="toc-text">图形处理单元 Graphic
Processing Units</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E6%A6%82%E8%A7%88%E7%BB%84%E7%BB%87%E4%B8%8E%E6%8A%80%E6%9C%AF-memory-overview-organization-technology"><span class="toc-number">21.</span> <span class="toc-text">内存概览，组织与技术
Memory Overview, Organization &amp; Technology</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84%E4%B8%8E%E7%BC%93%E5%AD%98-memory-hierachy-and-caches"><span class="toc-number">22.</span> <span class="toc-text">内存层次结构与缓存
Memory Hierachy and Caches</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%9B%E9%98%B6%E7%BC%93%E5%AD%98-advanced-caches"><span class="toc-number">23.</span> <span class="toc-text">进阶缓存 Advanced Caches</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%A2%84%E8%AF%BB-prefetching"><span class="toc-number">24.</span> <span class="toc-text">预读 Prefetching</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98-virtual-memory"><span class="toc-number">25.</span> <span class="toc-text">虚拟内存 Virtual Memory</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="ft"><div class="ft-item-1"><div class="t-top"><div class="t-t-l"><p class="ft-t t-l-t">格言🧬</p><div class="bg-ad"><div>不必要做的事不做，必须做的一律从简</div></div></div><div class="t-t-r"><p class="ft-t t-l-t">猜你想看💡</p><ul class="ft-links"><li><a href="/comments/">留点什么</a><a href="/random/">随便逛逛</a></li><li><a href="/about/">关于</a><a href="/archives/">文章归档</a></li><li><a href="/categories/">文章分类</a><a href="/tags/">文章标签</a></li><li><a href="/gallery/">我的画廊</a><a href="/charts/">网站统计</a></li></ul></div></div></div></div><div class="copyright"><span><b>&copy;2022 - 2023</b></span><span><b>&nbsp;&nbsp;By old_driver_zero</b></span></div><div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" title="博客框架为Hexo_v6.4.0" rel="external nofollow noopener noreferrer"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Frame-Hexo-blue.svg" alt></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" title="主题版本Butterfly_v4.8.1" rel="external nofollow noopener noreferrer"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Theme-Butterfly-6513df.svg" alt></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" title="本站采用多线部署，主线路托管于Vercel" rel="external nofollow noopener noreferrer"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Hosted-Vercel-brightgreen.svg" alt></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" title="本网站源码由Github提供存储仓库" rel="external nofollow noopener noreferrer"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=" https://sourcebucket.s3.ladydaily.com/badge/Source-Github-d021d6.svg" alt></a></p></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://my-twikoo-puce.vercel.app/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://my-twikoo-puce.vercel.app/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script async src="//at.alicdn.com/t/c/font_4031045_8r6cr7hwlv.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#web_bg",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script></div></div></html>