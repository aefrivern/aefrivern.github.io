<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>全栈公开课（第二部分） | Aefrivern的小屋</title><meta name="author" content="Aefrivern"><meta name="copyright" content="Aefrivern"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="React router、自定义 hook，利用 CSS 和 webpack 给 app 添加样式 React-router 使用 React Router 库生成导航栏： import &#123; BrowserRouter as Router, Routes, Route, Link &#125; from &#x27;react-router-dom&#x27;;const App &#x3D; (">
<meta property="og:type" content="article">
<meta property="og:title" content="全栈公开课（第二部分）">
<meta property="og:url" content="https://aefrivern.github.io/posts/e5d89884.html">
<meta property="og:site_name" content="Aefrivern的小屋">
<meta property="og:description" content="React router、自定义 hook，利用 CSS 和 webpack 给 app 添加样式 React-router 使用 React Router 库生成导航栏： import &#123; BrowserRouter as Router, Routes, Route, Link &#125; from &#x27;react-router-dom&#x27;;const App &#x3D; (">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://aefrivern.github.io/gallery/cover/%E5%85%A8%E6%A0%88%E5%85%AC%E5%BC%80%E8%AF%BE%EF%BC%88%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%EF%BC%89.webp">
<meta property="article:published_time" content="2024-01-03T00:17:22.000Z">
<meta property="article:modified_time" content="2024-11-23T06:15:40.000Z">
<meta property="article:author" content="Aefrivern">
<meta property="article:tag" content="赫尔辛基大学">
<meta property="article:tag" content="web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://aefrivern.github.io/gallery/cover/%E5%85%A8%E6%A0%88%E5%85%AC%E5%BC%80%E8%AF%BE%EF%BC%88%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%EF%BC%89.webp"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "全栈公开课（第二部分）",
  "url": "https://aefrivern.github.io/posts/e5d89884.html",
  "image": "https://aefrivern.github.io/gallery/cover/%E5%85%A8%E6%A0%88%E5%85%AC%E5%BC%80%E8%AF%BE%EF%BC%88%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%EF%BC%89.webp",
  "datePublished": "2024-01-03T00:17:22.000Z",
  "dateModified": "2024-11-23T06:15:40.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Aefrivern",
      "url": "https://aefrivern.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/illustration/favicon.ico"><link rel="canonical" href="https://aefrivern.github.io/posts/e5d89884.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"GY5EJYJ1FS","apiKey":"c443c952672ec7062840aac45536181e","indexName":"blog","hitsPerPage":6,"languages":{"input_placeholder":"搜索文章","hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，耗时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '全栈公开课（第二部分）',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="//at.alicdn.com/t/c/font_4031045_1yiosqv4vch.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/highlight.css"><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/hexo-butterfly-article-double-row.css"><script src="/js/echarts.min.js"></script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(/gallery/wallpaper/wallpaper.webp);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/%E5%A4%B4%E5%83%8F_%E7%81%B0%E5%A4%AA%E7%8B%BC.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">180</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">235</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-shouye-01"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw iconfont icon-guidang"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw iconfont icon-a-16-01-01"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw iconfont icon-wenjianjia"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/anime/"><i class="fa-fw iconfont icon-zhifeiji"></i><span> 二次元</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw iconfont icon-xiangce"></i><span> 画廊</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-guanyu"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/charts/"><i class="fa-fw iconfont icon-tongjichaxun"></i><span> 统计</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw iconfont icon-liuyan"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/random/"><i class="fa-fw iconfont icon-suiji"></i><span> 随便逛逛</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/gallery/cover/全栈公开课（第二部分）.webp);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Aefrivern的小屋</span></a><a class="nav-page-title" href="/"><span class="site-name">全栈公开课（第二部分）</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><svg class="meta_icon post-ui-icon" style="width:16px;height:16px;position:relative;top:3px"><use xlink:href="#icon-sousuo1"></use></svg><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-shouye-01"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw iconfont icon-guidang"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw iconfont icon-a-16-01-01"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw iconfont icon-wenjianjia"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/anime/"><i class="fa-fw iconfont icon-zhifeiji"></i><span> 二次元</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw iconfont icon-xiangce"></i><span> 画廊</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-guanyu"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/charts/"><i class="fa-fw iconfont icon-tongjichaxun"></i><span> 统计</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw iconfont icon-liuyan"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/random/"><i class="fa-fw iconfont icon-suiji"></i><span> 随便逛逛</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">全栈公开课（第二部分）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><svg class="meta_icon post-ui-icon" style="width:16px;height:16px;position:relative;top:3px"><use xlink:href="#icon-rili"></use></svg><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-01-03T00:17:22.000Z" title="发表于 2024-01-03 08:17:22">2024-01-03</time><span class="post-meta-separator">|</span><svg class="meta_icon post-ui-icon" style="width:13px;height:13px;position:relative;top:2px"><use xlink:href="#icon-gengxin"></use></svg><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-11-23T06:15:40.000Z" title="更新于 2024-11-23 14:15:40">2024-11-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><a class="faa-parent animated-hover"></a><svg class="meta_icon post-ui-icon" style="width:13px;height:13px;position:relative;top:2px"><use xlink:href="#icon-fenlei"></use></svg><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><svg class="meta_icon post-ui-icon" style="width:16px;height:16px;position:relative;top:3px"><use xlink:href="#icon-word"></use></svg><span class="post-meta-label">总字数:</span><span class="word-count">7308</span><span class="post-meta-separator">|</span><svg class="meta_icon post-ui-icon" style="width:16px;height:16px;position:relative;top:3px"><use xlink:href="#icon-shizhong"></use></svg><span class="post-meta-label">阅读时长:</span><span>35分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="React-router、自定义-hook，利用-CSS-和-webpack-给-app-添加样式">React router、自定义 hook，利用 CSS 和 webpack 给 app 添加样式</h2>
<h3 id="React-router">React-router</h3>
<p>使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://reactrouter.com/">React Router</a> 库生成导航栏：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">BrowserRouter</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Router</span>, <span class="hljs-title class_">Routes</span>, <span class="hljs-title class_">Route</span>, <span class="hljs-title class_">Link</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-dom&#x27;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> padding = &#123;<br>    <span class="hljs-attr">padding</span>: <span class="hljs-number">5</span>,<br>  &#125;;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Router</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;padding&#125;</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&#x27;/&#x27;</span>&gt;</span></span><br><span class="language-xml">          home</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;padding&#125;</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&#x27;/notes&#x27;</span>&gt;</span></span><br><span class="language-xml">          notes</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;padding&#125;</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&#x27;/users&#x27;</span>&gt;</span></span><br><span class="language-xml">          users</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&#x27;/notes&#x27;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">Notes</span> /&gt;</span>&#125; /&gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&#x27;/users&#x27;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">Users</span> /&gt;</span>&#125; /&gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&#x27;/&#x27;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">Home</span> /&gt;</span>&#125; /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">i</span>&gt;</span>Note app, Department of Computer Science 2022<span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span></span><br>  );<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>可以添加参数路由：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx">&lt;<span class="hljs-title class_">Route</span> path=<span class="hljs-string">&#x27;/notes/:id&#x27;</span> element=&#123;<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Note</span> <span class="hljs-attr">notes</span>=<span class="hljs-string">&#123;notes&#125;</span> /&gt;</span></span>&#125; /&gt;<br></code></pre></td></tr></table></figure>
<p>使用 <code>useNavigate()</code> 和 <code>navigate('/')</code> 可以手动导航</p>
<p>如果一个用户没有登录，则会被重定向到登录页面：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx">&lt;<span class="hljs-title class_">Route</span><br>  path=<span class="hljs-string">&#x27;/users&#x27;</span><br>  element=&#123;user ? <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Users</span> /&gt;</span></span> : <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Navigate</span> <span class="hljs-attr">replace</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&#x27;/login&#x27;</span> /&gt;</span></span>&#125;<br>/&gt;<br></code></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://reactrouter.com/en/main/hooks/use-match">useMatch</a> 钩子可以计算出所需 id：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> match = <span class="hljs-title function_">useMatch</span>(<span class="hljs-string">&#x27;/notes/:id&#x27;</span>);<br><span class="hljs-keyword">const</span> note = match<br>  ? notes.<span class="hljs-title function_">find</span>(<span class="hljs-function">(<span class="hljs-params">note</span>) =&gt;</span> note.<span class="hljs-property">id</span> === <span class="hljs-title class_">Number</span>(match.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>))<br>  : <span class="hljs-literal">null</span>;<br></code></pre></td></tr></table></figure>
<h3 id="自定义-hooks">自定义 hooks</h3>
<p>我们也可以自定义钩子：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">useField</span> = (<span class="hljs-params">type</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> [value, setValue] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onChange</span> = (<span class="hljs-params">event</span>) =&gt; &#123;<br>    <span class="hljs-title function_">setValue</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>);<br>  &#125;;<br>  <span class="hljs-keyword">return</span> &#123; type, value, onChange &#125;;<br>&#125;;<br></code></pre></td></tr></table></figure>
<h3 id="样式进阶">样式进阶</h3>
<p>先介绍 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://getbootstrap.com/">Bootstrap</a>，使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://react-bootstrap.github.io/">react-bootstrap</a> 软件包，并在 <code>index.html</code> 的 <code>head</code> 中加载 CSS：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">link</span></span><br><span class="hljs-tag">    <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">integrity</span>=<span class="hljs-string">&quot;sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">crossorigin</span>=<span class="hljs-string">&quot;anonymous&quot;</span></span><br><span class="hljs-tag">  /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>应用的所有内容在容器中渲染，给应用的根 div 元素加上 container 类属性</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&#x27;container&#x27;</span>&gt;</span>// ...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>有<a target="_blank" rel="noopener external nofollow noreferrer" href="https://react-bootstrap.github.io/docs/components/table/">表格</a>，<a target="_blank" rel="noopener external nofollow noreferrer" href="https://getbootstrap.com/docs/4.1/components/forms/">表单</a>，<a target="_blank" rel="noopener external nofollow noreferrer" href="https://getbootstrap.com/docs/4.1/components/alerts/">通知</a>，<a target="_blank" rel="noopener external nofollow noreferrer" href="https://getbootstrap.com/docs/4.1/components/navbar/">导航栏</a>等</p>
<p>接下来是 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://mui.com/">MaterialUI</a> React 库，要安装：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">npm install @mui/material @emotion/react @emotion/styled<br></code></pre></td></tr></table></figure>
<p><code>index.html</code> 中添加：</p>
<figure class="highlight html"><figcaption><span>index.html</span></figcaption><table><tr><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">link</span></span><br><span class="hljs-tag">    <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&amp;display=swap&quot;</span></span><br><span class="hljs-tag">  /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br></code></pre></td></tr></table></figure>
<p>渲染方式是：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Container</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@mui/material&#x27;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Container</span>&gt;</span>// ...<span class="hljs-tag">&lt;/<span class="hljs-name">Container</span>&gt;</span></span>;<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>同样有<a target="_blank" rel="noopener external nofollow noreferrer" href="https://mui.com/material-ui/react-table/#simple-table">表格</a>，<a target="_blank" rel="noopener external nofollow noreferrer" href="https://mui.com/material-ui/react-text-field/">文本框</a>，<a target="_blank" rel="noopener external nofollow noreferrer" href="https://mui.com/material-ui/api/button/">按钮</a>，<a target="_blank" rel="noopener external nofollow noreferrer" href="https://mui.com/material-ui/react-alert/">Alert</a>，<a target="_blank" rel="noopener external nofollow noreferrer" href="https://mui.com/material-ui/react-app-bar/">AppBar</a></p>
<p>还可以使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.styled-components.com/">styled components</a> 库提供的方式定义样式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> styled <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;styled-components&#x27;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">Input</span> = styled.<span class="hljs-property">input</span><span class="hljs-string">`</span><br><span class="hljs-string">  margin: 0.25em;</span><br><span class="hljs-string">`</span>;<br></code></pre></td></tr></table></figure>
<p>然后正常使用即可</p>
<h3 id="Webpack">Webpack</h3>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://webpack.js.org/">webpack</a> 可用于创建 app</p>
<p>一个 <code>webpack.config.js</code> 文件的例子：</p>
<figure class="highlight js"><figcaption><span>webpack.config.js</span></figcaption><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;path&#x27;</span>);<br><br><span class="hljs-keyword">const</span> config = &#123;<br>  <span class="hljs-attr">entry</span>: <span class="hljs-string">&#x27;./src/index.js&#x27;</span>,<br>  <span class="hljs-attr">output</span>: &#123;<br>    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">&#x27;build&#x27;</span>),<br>    <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;main.js&#x27;</span>,<br>  &#125;,<br>&#125;;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = config;<br></code></pre></td></tr></table></figure>
<p>可以使用 loaders 来通知 webpack 在捆绑前需要处理的文件，例如将 <code>.jsx</code> 文件转化为普通的 <code>.js</code> 文件：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-attr">module</span>: &#123;<br>    <span class="hljs-attr">rules</span>: [<br>      &#123;<br>        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.js$/</span>,<br>        <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;babel-loader&#x27;</span>,<br>        <span class="hljs-attr">options</span>: &#123;<br>            <span class="hljs-attr">presets</span>: [<span class="hljs-string">&#x27;@babel/preset-react&#x27;</span>],<br>        &#125;,<br>      &#125;,<br>    ],<br>&#125;,<br></code></pre></td></tr></table></figure>
<p>还需要安装并引入 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.npmjs.com/package/core-js">core-js</a> 和 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.npmjs.com/package/regenerator-runtime">regenerator-runtime</a></p>
<p>当使用 CSS 时，我们必须使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://webpack.js.org/loaders/css-loader/">css</a> 和 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://webpack.js.org/loaders/style-loader/">style</a> 加载器。</p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://webpack.js.org/configuration/devtool/">source map</a> 有助于我们看到源代码</p>
<h3 id="各种各样的-Class-components">各种各样的 Class components</h3>
<p>React 元素构成了一个虚拟 DOM</p>
<p><code>npm-check-updates</code> 可以用来检查依赖的更新</p>
<h2 id="GraphQL">GraphQL</h2>
<h3 id="GraphQL-服务器">GraphQL 服务器</h3>
<p>REST 是基于资源的，对资源的所有操作通过对其 URL 的 HTTP 请求完成。</p>
<p>但是 GraphQL 的所有查询都被发送到一个地址，类型是 POST</p>
<p>一个定义的模式的例子：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js">type <span class="hljs-title class_">Person</span> &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>!<br>  <span class="hljs-attr">phone</span>: <span class="hljs-title class_">String</span><br>  <span class="hljs-attr">street</span>: <span class="hljs-title class_">String</span>!<br>  <span class="hljs-attr">city</span>: <span class="hljs-title class_">String</span>!<br>  <span class="hljs-attr">id</span>: <span class="hljs-variable constant_">ID</span>!<br>&#125;<br><br>type <span class="hljs-title class_">Query</span> &#123;<br>  <span class="hljs-attr">personCount</span>: <span class="hljs-title class_">Int</span>!<br>  <span class="hljs-attr">allPersons</span>: [<span class="hljs-title class_">Person</span>!]!<br>  <span class="hljs-title function_">findPerson</span>(<span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>!): <span class="hljs-title class_">Person</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>查询：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js">query &#123;<br>  allPersons &#123;<br>    name<br>    phone<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>返回值：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;data&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;allPersons&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Arto Hellas&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;phone&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;040-123543&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Matti Luukkainen&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;phone&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;040-432342&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Venla Ruuska&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;phone&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
<p>也可以带有参数</p>
<p>实现服务器使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.apollographql.com/docs/apollo-server/">Apollo Server</a></p>
<p>定义模式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> &#123; <span class="hljs-title class_">ApolloServer</span>, gql &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;apollo-server&#x27;</span>);<br><br><span class="hljs-keyword">const</span> typeDefs = gql`<span class="language-graphql"></span><br><span class="language-graphql">  <span class="hljs-keyword">type</span> Person <span class="hljs-punctuation">&#123;</span></span><br><span class="language-graphql">    <span class="hljs-symbol">name</span><span class="hljs-punctuation">:</span> String<span class="hljs-punctuation">!</span></span><br><span class="language-graphql">    <span class="hljs-symbol">phone</span><span class="hljs-punctuation">:</span> String</span><br><span class="language-graphql">    <span class="hljs-symbol">street</span><span class="hljs-punctuation">:</span> String<span class="hljs-punctuation">!</span></span><br><span class="language-graphql">    <span class="hljs-symbol">city</span><span class="hljs-punctuation">:</span> String<span class="hljs-punctuation">!</span></span><br><span class="language-graphql">    <span class="hljs-symbol">id</span><span class="hljs-punctuation">:</span> ID<span class="hljs-punctuation">!</span></span><br><span class="language-graphql">  <span class="hljs-punctuation">&#125;</span></span><br><span class="language-graphql"></span><br><span class="language-graphql">  <span class="hljs-keyword">type</span> <span class="hljs-keyword">Query</span> <span class="hljs-punctuation">&#123;</span></span><br><span class="language-graphql">    <span class="hljs-symbol">personCount</span><span class="hljs-punctuation">:</span> Int<span class="hljs-punctuation">!</span></span><br><span class="language-graphql">    <span class="hljs-symbol">allPersons</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>Person<span class="hljs-punctuation">!</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">!</span></span><br><span class="language-graphql">    findPerson<span class="hljs-punctuation">(</span><span class="hljs-symbol">name</span><span class="hljs-punctuation">:</span> String<span class="hljs-punctuation">!</span><span class="hljs-punctuation">)</span><span class="hljs-punctuation">:</span> Person</span><br><span class="language-graphql">  <span class="hljs-punctuation">&#125;</span></span><br><span class="language-graphql">`</span>;<br><br><span class="hljs-keyword">const</span> resolvers = &#123;<br>  <span class="hljs-title class_">Query</span>: &#123;<br>    <span class="hljs-attr">personCount</span>: <span class="hljs-function">() =&gt;</span> persons.<span class="hljs-property">length</span>,<br>    <span class="hljs-attr">allPersons</span>: <span class="hljs-function">() =&gt;</span> persons,<br>    <span class="hljs-attr">findPerson</span>: <span class="hljs-function">(<span class="hljs-params">root, args</span>) =&gt;</span> persons.<span class="hljs-title function_">find</span>(<span class="hljs-function">(<span class="hljs-params">p</span>) =&gt;</span> p.<span class="hljs-property">name</span> === args.<span class="hljs-property">name</span>),<br>  &#125;,<br>&#125;;<br><br><span class="hljs-keyword">const</span> server = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApolloServer</span>(&#123;<br>  typeDefs,<br>  resolvers,<br>&#125;);<br><br>server.<span class="hljs-title function_">listen</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">&#123; url &#125;</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Server ready at <span class="hljs-subst">$&#123;url&#125;</span>`</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>
<p>对象之间也可以组合，如模式为：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js">type <span class="hljs-title class_">Address</span> &#123;<br>  <span class="hljs-attr">street</span>: <span class="hljs-title class_">String</span>!<br>  <span class="hljs-attr">city</span>: <span class="hljs-title class_">String</span>!<br>&#125;<br><br>type <span class="hljs-title class_">Person</span> &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>!<br>  <span class="hljs-attr">address</span>: <span class="hljs-title class_">Address</span>!<br>  <span class="hljs-attr">id</span>: <span class="hljs-variable constant_">ID</span>!<br>&#125;<br></code></pre></td></tr></table></figure>
<p>所有引起变化的操作通过 mutation 完成，如添加一个新人：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js">type <span class="hljs-title class_">Mutation</span> &#123;<br>  <span class="hljs-title function_">addPerson</span>(<br>    <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>!<br>    <span class="hljs-attr">phone</span>: <span class="hljs-title class_">String</span><br>    <span class="hljs-attr">street</span>: <span class="hljs-title class_">String</span>!<br>    <span class="hljs-attr">city</span>: <span class="hljs-title class_">String</span>!<br>  ): <span class="hljs-title class_">Person</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>可以使用 Apollo 的错误处理机制，如抛出 <code>throw new UserInputError('Name must be unique', &#123;invalidArgs: args.name, &#125;)</code></p>
<p>GraphQL 支持枚举类型：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js">enum <span class="hljs-title class_">YesNo</span> &#123;<br>  <span class="hljs-variable constant_">YES</span><br>  <span class="hljs-variable constant_">NO</span><br>&#125;<br><br>type <span class="hljs-title class_">Query</span> &#123;<br>  <span class="hljs-attr">personCount</span>: <span class="hljs-title class_">Int</span>!<br><br>  <span class="hljs-title function_">allPersons</span>(<span class="hljs-attr">phone</span>: <span class="hljs-title class_">YesNo</span>): [<span class="hljs-title class_">Person</span>!]!<br>  <span class="hljs-title function_">findPerson</span>(<span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>!): <span class="hljs-title class_">Person</span><br>&#125;<br></code></pre></td></tr></table></figure>
<h3 id="React-与-GraphQL">React 与 GraphQL</h3>
<p>客户端使用 <code>ApolloProvider</code> 包装 APP 组件：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-dom&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./App&#x27;</span>;<br><br><span class="hljs-keyword">import</span> &#123;<br>  <span class="hljs-title class_">ApolloClient</span>,<br>  <span class="hljs-title class_">ApolloProvider</span>,<br>  <span class="hljs-title class_">HttpLink</span>,<br>  <span class="hljs-title class_">InMemoryCache</span>,<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@apollo/client&#x27;</span>;<br><br><span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApolloClient</span>(&#123;<br>  <span class="hljs-attr">cache</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryCache</span>(),<br>  <span class="hljs-attr">link</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpLink</span>(&#123;<br>    <span class="hljs-attr">uri</span>: <span class="hljs-string">&#x27;http://localhost:4000&#x27;</span>,<br>  &#125;),<br>&#125;);<br><br><span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">render</span>(<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">ApolloProvider</span> <span class="hljs-attr">client</span>=<span class="hljs-string">&#123;client&#125;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">ApolloProvider</span>&gt;</span></span>,<br>  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;root&#x27;</span>)<br>);<br></code></pre></td></tr></table></figure>
<p>查询可以使用 <code>useQuery</code>：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; gql, useQuery &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@apollo/client&#x27;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">ALL_PERSONS</span> = gql`<span class="language-graphql"></span><br><span class="language-graphql">  <span class="hljs-keyword">query</span> <span class="hljs-punctuation">&#123;</span></span><br><span class="language-graphql">    allPersons <span class="hljs-punctuation">&#123;</span></span><br><span class="language-graphql">      name</span><br><span class="language-graphql">      phone</span><br><span class="language-graphql">      id</span><br><span class="language-graphql">    <span class="hljs-punctuation">&#125;</span></span><br><span class="language-graphql">  <span class="hljs-punctuation">&#125;</span></span><br><span class="language-graphql">`</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">useQuery</span>(<span class="hljs-variable constant_">ALL_PERSONS</span>);<br><br>  <span class="hljs-keyword">if</span> (result.<span class="hljs-property">loading</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;result.data.allPersons.map((p) =&gt; p.name).join(&#x27;, &#x27;)&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>如果是一个带参数的查询，可以：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">FIND_PERSON</span> = gql`<span class="language-graphql"></span><br><span class="language-graphql">  <span class="hljs-keyword">query</span> findPersonByName<span class="hljs-punctuation">(</span><span class="hljs-variable">$nameToSearch</span>: String<span class="hljs-punctuation">!</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">&#123;</span></span><br><span class="language-graphql">    findPerson<span class="hljs-punctuation">(</span><span class="hljs-symbol">name</span><span class="hljs-punctuation">:</span> <span class="hljs-variable">$nameToSearch</span>) <span class="hljs-punctuation">&#123;</span></span><br><span class="language-graphql">      name</span><br><span class="language-graphql">      phone</span><br><span class="language-graphql">      id</span><br><span class="language-graphql">      address <span class="hljs-punctuation">&#123;</span></span><br><span class="language-graphql">        street</span><br><span class="language-graphql">        city</span><br><span class="language-graphql">      <span class="hljs-punctuation">&#125;</span></span><br><span class="language-graphql">    <span class="hljs-punctuation">&#125;</span></span><br><span class="language-graphql">  <span class="hljs-punctuation">&#125;</span></span><br><span class="language-graphql">`</span>;<br><br><span class="hljs-keyword">const</span> [nameToSearch, setNameToSearch] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);<br><span class="hljs-keyword">const</span> result = <span class="hljs-title function_">useQuery</span>(<span class="hljs-variable constant_">FIND_PERSON</span>, &#123;<br>  <span class="hljs-attr">variables</span>: &#123; nameToSearch &#125;,<br>  <span class="hljs-attr">skip</span>: !nameToSearch,<br>&#125;);<br><br><span class="hljs-keyword">if</span> (nameToSearch &amp;&amp; result.<span class="hljs-property">data</span>) &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Person</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">person</span>=<span class="hljs-string">&#123;result.data.findPerson&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">onClose</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> setNameToSearch(null)&#125;</span><br><span class="language-xml">    /&gt;</span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>
<p>更新缓存有几种方法，第一种是 poll 服务器：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> result = <span class="hljs-title function_">useQuery</span>(<span class="hljs-variable constant_">ALL_PERSONS</span>, &#123; <span class="hljs-attr">pollInterval</span>: <span class="hljs-number">2000</span> &#125;);<br></code></pre></td></tr></table></figure>
<p>缺点在于无意义的网络流量</p>
<p>第二种是使用 <code>refetchQueries</code> 定义，每当创建一个新的人，就重新进行获取所有人员的查询：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> [ createPerson ] = <span class="hljs-title function_">useMutation</span>(<span class="hljs-variable constant_">CREATE_PERSON</span>, &#123;<br>    <span class="hljs-attr">refetchQueries</span>: [ &#123; <span class="hljs-attr">query</span>: <span class="hljs-variable constant_">ALL_PERSONS</span> &#125;, &#123; <span class="hljs-attr">query</span>: <span class="hljs-variable constant_">OTHER_QUERY</span> &#125;, &#123; <span class="hljs-attr">query</span>: ... &#125; ]<br>&#125;)<br></code></pre></td></tr></table></figure>
<p>缺点在于另一个用户更新的数据不会立刻反应给其他用户</p>
<p>可以定义错误处理函数：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">PersonForm</span> = (<span class="hljs-params">&#123; setError &#125;</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> [createPerson] = <span class="hljs-title function_">useMutation</span>(<span class="hljs-variable constant_">CREATE_PERSON</span>, &#123;<br>    <span class="hljs-attr">refetchQueries</span>: [&#123; <span class="hljs-attr">query</span>: <span class="hljs-variable constant_">ALL_PERSONS</span> &#125;],<br>    <span class="hljs-attr">onError</span>: <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> &#123;<br>      <span class="hljs-title function_">setError</span>(error.<span class="hljs-property">graphQLErrors</span>[<span class="hljs-number">0</span>].<span class="hljs-property">message</span>);<br>    &#125;,<br>  &#125;);<br>&#125;;<br></code></pre></td></tr></table></figure>
<h3 id="数据库与用户管理">数据库与用户管理</h3>
<p>用户管理的模式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js">type <span class="hljs-title class_">User</span> &#123;<br>  <span class="hljs-attr">username</span>: <span class="hljs-title class_">String</span>!<br>  <span class="hljs-attr">friends</span>: [<span class="hljs-title class_">Person</span>!]!<br>  <span class="hljs-attr">id</span>: <span class="hljs-variable constant_">ID</span>!<br>&#125;<br><br>type <span class="hljs-title class_">Token</span> &#123;<br>  <span class="hljs-attr">value</span>: <span class="hljs-title class_">String</span>!<br>&#125;<br><br>type <span class="hljs-title class_">Query</span> &#123;<br>  <span class="hljs-attr">me</span>: <span class="hljs-title class_">User</span><br>&#125;<br><br>type <span class="hljs-title class_">Mutation</span> &#123;<br>  <span class="hljs-title function_">createUser</span>(<br>    <span class="hljs-attr">username</span>: <span class="hljs-title class_">String</span>!<br>  ): <span class="hljs-title class_">User</span><br>  <span class="hljs-title function_">login</span>(<br>    <span class="hljs-attr">username</span>: <span class="hljs-title class_">String</span>!<br>    <span class="hljs-attr">password</span>: <span class="hljs-title class_">String</span>!<br>  ): <span class="hljs-title class_">Token</span><br>&#125;<br></code></pre></td></tr></table></figure>
<p>实现：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;jsonwebtoken&#x27;</span>)<br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">JWT_SECRET</span> = <span class="hljs-string">&#x27;NEED_HERE_A_SECRET_KEY&#x27;</span><br><br><span class="hljs-title class_">Mutation</span>: &#123;<br>  <span class="hljs-attr">createUser</span>: <span class="hljs-keyword">async</span> (root, args) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(&#123; <span class="hljs-attr">username</span>: args.<span class="hljs-property">username</span> &#125;)<br><br>    <span class="hljs-keyword">return</span> user.<span class="hljs-title function_">save</span>()<br>      .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserInputError</span>(error.<span class="hljs-property">message</span>, &#123;<br>          <span class="hljs-attr">invalidArgs</span>: args,<br>        &#125;)<br>      &#125;)<br>  &#125;,<br>  <span class="hljs-attr">login</span>: <span class="hljs-keyword">async</span> (root, args) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title class_">User</span>.<span class="hljs-title function_">findOne</span>(&#123; <span class="hljs-attr">username</span>: args.<span class="hljs-property">username</span> &#125;)<br><br>    <span class="hljs-keyword">if</span> ( !user || args.<span class="hljs-property">password</span> !== <span class="hljs-string">&#x27;secret&#x27;</span> ) &#123; <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserInputError</span>(<span class="hljs-string">&quot;wrong credentials&quot;</span>) &#125;<br><br>    <span class="hljs-keyword">const</span> userForToken = &#123;<br>      <span class="hljs-attr">username</span>: user.<span class="hljs-property">username</span>,<br>      <span class="hljs-attr">id</span>: user.<span class="hljs-property">_id</span>,<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">value</span>: jwt.<span class="hljs-title function_">sign</span>(userForToken, <span class="hljs-variable constant_">JWT_SECRET</span>) &#125;<br>  &#125;,<br>&#125;,<br></code></pre></td></tr></table></figure>
<p>在构造函数调用中添加第三个参数 <code>context</code> 来扩展 <code>server</code> 对象的定义。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> server = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApolloServer</span>(&#123;<br>  typeDefs,<br>  resolvers,<br><br>  <span class="hljs-attr">context</span>: <span class="hljs-keyword">async</span> (&#123; req &#125;) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> auth = req ? req.<span class="hljs-property">headers</span>.<span class="hljs-property">authorization</span> : <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">if</span> (auth &amp;&amp; auth.<span class="hljs-title function_">toLowerCase</span>().<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&#x27;bearer &#x27;</span>)) &#123;<br>      <span class="hljs-keyword">const</span> decodedToken = jwt.<span class="hljs-title function_">verify</span>(auth.<span class="hljs-title function_">substring</span>(<span class="hljs-number">7</span>), <span class="hljs-variable constant_">JWT_SECRET</span>);<br>      <span class="hljs-keyword">const</span> currentUser = <span class="hljs-keyword">await</span> <span class="hljs-title class_">User</span>.<span class="hljs-title function_">findById</span>(decodedToken.<span class="hljs-property">id</span>).<span class="hljs-title function_">populate</span>(<br>        <span class="hljs-string">&#x27;friends&#x27;</span><br>      );<br>      <span class="hljs-keyword">return</span> &#123; currentUser &#125;;<br>    &#125;<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>
<h3 id="登录与更新缓存">登录与更新缓存</h3>
<p>向 header 中添加令牌：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; setContext &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@apollo/client/link/context&#x27;</span>;<br><br><span class="hljs-keyword">const</span> authLink = <span class="hljs-title function_">setContext</span>(<span class="hljs-function">(<span class="hljs-params">_, &#123; headers &#125;</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> token = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;phonenumbers-user-token&#x27;</span>);<br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">headers</span>: &#123;<br>      ...headers,<br>      <span class="hljs-attr">authorization</span>: token ? <span class="hljs-string">`bearer <span class="hljs-subst">$&#123;token&#125;</span>`</span> : <span class="hljs-literal">null</span>,<br>    &#125;,<br>  &#125;;<br>&#125;);<br><br><span class="hljs-keyword">const</span> httpLink = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpLink</span>(&#123; <span class="hljs-attr">uri</span>: <span class="hljs-string">&#x27;http://localhost:4000&#x27;</span> &#125;);<br><br><span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApolloClient</span>(&#123;<br>  <span class="hljs-attr">cache</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryCache</span>(),<br>  <span class="hljs-attr">link</span>: authLink.<span class="hljs-title function_">concat</span>(httpLink),<br>&#125;);<br></code></pre></td></tr></table></figure>
<p>还有一种手动更新缓存的方式：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> [createPerson] = <span class="hljs-title function_">useMutation</span>(<span class="hljs-variable constant_">CREATE_PERSON</span>, &#123;<br>  <span class="hljs-attr">update</span>: <span class="hljs-function">(<span class="hljs-params">cache, response</span>) =&gt;</span> &#123;<br>    cache.<span class="hljs-title function_">updateQuery</span>(&#123; <span class="hljs-attr">query</span>: <span class="hljs-variable constant_">ALL_PERSONS</span> &#125;, <span class="hljs-function">(<span class="hljs-params">&#123; allPersons &#125;</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-attr">allPersons</span>: allPersons.<span class="hljs-title function_">concat</span>(response.<span class="hljs-property">data</span>.<span class="hljs-property">addPerson</span>),<br>      &#125;;<br>    &#125;);<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>
<h3 id="Fragments-与-subscriptions">Fragments 与 subscriptions</h3>
<p>两个查询必须定义完全相同的字段时，可以通过 fragment 来简化，如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PERSON_DETAILS</span> = gql`<span class="language-graphql"></span><br><span class="language-graphql">  <span class="hljs-keyword">fragment</span> PersonDetails <span class="hljs-keyword">on</span> Person <span class="hljs-punctuation">&#123;</span></span><br><span class="language-graphql">    id</span><br><span class="language-graphql">    name</span><br><span class="language-graphql">    phone</span><br><span class="language-graphql">    address <span class="hljs-punctuation">&#123;</span></span><br><span class="language-graphql">      street</span><br><span class="language-graphql">      city</span><br><span class="language-graphql">    <span class="hljs-punctuation">&#125;</span></span><br><span class="language-graphql">  <span class="hljs-punctuation">&#125;</span></span><br><span class="language-graphql">`</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">FIND_PERSON</span> = gql`<span class="language-graphql"></span><br><span class="language-graphql">  <span class="hljs-keyword">query</span> findPersonByName<span class="hljs-punctuation">(</span><span class="hljs-variable">$nameToSearch</span>: String<span class="hljs-punctuation">!</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">&#123;</span></span><br><span class="language-graphql">    findPerson<span class="hljs-punctuation">(</span><span class="hljs-symbol">name</span><span class="hljs-punctuation">:</span> <span class="hljs-variable">$nameToSearch</span>) <span class="hljs-punctuation">&#123;</span></span><br><span class="language-graphql">      <span class="hljs-punctuation">...</span>PersonDetails</span><br><span class="language-graphql">    <span class="hljs-punctuation">&#125;</span></span><br><span class="language-graphql">  <span class="hljs-punctuation">&#125;</span></span><br><span class="language-graphql">  </span><span class="hljs-subst">$&#123;PERSON_DETAILS&#125;</span><span class="language-graphql"></span><br><span class="language-graphql">`</span>;<br></code></pre></td></tr></table></figure>
<p>Apollo 使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API">WebSockets</a> 进行服务器用户的通信</p>
<p>用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.apollographql.com/docs/apollo-server/integrations/middleware/#apollo-server-express">Apollo Server Express</a> 替换 Apollo 服务器</p>
<h2 id="TypeScript">TypeScript</h2>
<h3 id="背景与介绍">背景与介绍</h3>
<p>TypeScript 可以被编译为 JavaScript，是它的一个超集，由语言、编译器、语言服务三部分组成</p>
<p>一个例子：</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> birthdayGreeter = (<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">`Happy birthday <span class="hljs-subst">$&#123;name&#125;</span>, you are now <span class="hljs-subst">$&#123;age&#125;</span> years old!`</span>;<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>其中函数的返回值可以不写，能够自动推断出来</p>
<p>支持 callback：</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><code class="hljs typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">CallsFunction</span> = <span class="hljs-function">(<span class="hljs-params">callback: (result: <span class="hljs-built_in">string</span>) =&gt; <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-attr">func</span>: <span class="hljs-title class_">CallsFunction</span> = <span class="hljs-function">(<span class="hljs-params">cb</span>) =&gt;</span> &#123;<br>  <span class="hljs-title function_">cb</span>(<span class="hljs-string">&#x27;done&#x27;</span>);<br>  <span class="hljs-title function_">cb</span>(<span class="hljs-number">1</span>);<br>&#125;;<br><br><span class="hljs-title function_">func</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> result;<br>&#125;);<br></code></pre></td></tr></table></figure>
<h3 id="TypeScript-的一小步">TypeScript 的一小步</h3>
<p>需要安装的包：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">npm install --save-dev ts-node typescript<br></code></pre></td></tr></table></figure>
<p>可以自定义类型：</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Operation</span> = <span class="hljs-string">&#x27;multiply&#x27;</span> | <span class="hljs-string">&#x27;add&#x27;</span> | <span class="hljs-string">&#x27;divide&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p>也可以通过定义接口来定义类型：</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">MultiplyValues</span> &#123;<br>  <span class="hljs-attr">value1</span>: <span class="hljs-built_in">number</span>;<br>  <span class="hljs-attr">value2</span>: <span class="hljs-built_in">number</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>npm 包通常有对应的 typescript 版本，名称为 <code>@types/&#123;npm_package&#125;</code>，且总是应该安装在 <code>devDependencies</code> 中，并仍需要安装相应的 JavaScript 版本</p>
<p><code>tsconfig.json</code> 文件中包含了 TypeScript 的核心配置</p>
<h3 id="TypeScript-版的-express-应用">TypeScript 版的 express 应用</h3>
<p>使用 <code>tsc</code> 生成 <code>tsconfig.json</code> 文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">npm run tsc -- --init<br></code></pre></td></tr></table></figure>
<p><code>nodemon</code> 的 TypeScript 替代品为 <code>ts-node-dev</code></p>
<p>关键字 <code>as</code> 断言变量类型</p>
<p>可以通过在类型声明中添加 <code>?</code>，将字段的类型设置为 optional</p>
<p>注意节点模块的加载顺序：<code>[&quot;js&quot;, &quot;json&quot;, &quot;node&quot;, &quot;ts&quot;, &quot;tsx&quot;]</code>，最好的方法是避免重名</p>
<p><code>Pick</code> 实用类型允许选择想使用的现有类型的哪些字段：</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> getNonSensitiveEntries = (): <span class="hljs-title class_">Pick</span>&lt;<br>  <span class="hljs-title class_">DiaryEntry</span>,<br>  <span class="hljs-string">&#x27;id&#x27;</span> | <span class="hljs-string">&#x27;date&#x27;</span> | <span class="hljs-string">&#x27;weather&#x27;</span> | <span class="hljs-string">&#x27;visibility&#x27;</span><br>&gt;[] =&gt; &#123;&#125;;<br></code></pre></td></tr></table></figure>
<p><code>Omit</code> 可以用来声明要排除哪些字段：</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">NonSensitiveDiaryEntry</span> = <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">DiaryEntry</span>, <span class="hljs-string">&#x27;comment&#x27;</span>&gt;;<br></code></pre></td></tr></table></figure>
<p>注意这只是禁止访问而已，并不是不返回那些被排除的字段而已，所以需要手动排除这些字段：</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> getNonSensitiveEntries = (): <span class="hljs-title class_">NonSensitiveDiaryEntry</span>[] =&gt; &#123;<br>  <span class="hljs-keyword">return</span> diaries.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">&#123; id, date &#125;</span>) =&gt;</span> (&#123; id, date &#125;));<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>使用 <code>unknown</code> 可以先验证类型，然后确认预期类型，如：</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> parseComment = (<span class="hljs-attr">comment</span>: <span class="hljs-built_in">unknown</span>): <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">if</span> (!comment || !<span class="hljs-title function_">isString</span>(comment)) &#123;<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Incorrect or missing comment&#x27;</span>);<br>  &#125;<br>  <span class="hljs-keyword">return</span> comment;<br>&#125;;<br></code></pre></td></tr></table></figure>
<h3 id="利用-TypeScript-编写-React-应用">利用 TypeScript 编写 React 应用</h3>
<p>创建一个 TypeScript 应用：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">npx create-react-app my-app --template typescript<br></code></pre></td></tr></table></figure>
<p>组件：</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> <span class="hljs-title function_">Welcome</span> = (<span class="hljs-params">&#123; name &#125;: &#123; name: <span class="hljs-built_in">string</span> &#125;</span>) =&gt; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello, &#123;name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;<br></code></pre></td></tr></table></figure>
<p>接口可以继承，这样就可以不同类型共享相同的域，然后通过 <code>switch</code> 等语句区分不同的具体类型：</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">CoursePartBase</span> &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;<br>  <span class="hljs-attr">exerciseCount</span>: <span class="hljs-built_in">number</span>;<br>&#125;<br><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">CoursePartOne</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CoursePartBase</span> &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Fundamentals&#x27;</span>;<br>  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>;<br>&#125;<br><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">CoursePartTwo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CoursePartBase</span> &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Using props to pass data&#x27;</span>;<br>  <span class="hljs-attr">groupProjectCount</span>: <span class="hljs-built_in">number</span>;<br>&#125;<br><br><span class="hljs-keyword">type</span> <span class="hljs-title class_">CoursePart</span> = <span class="hljs-title class_">CoursePartOne</span> | <span class="hljs-title class_">CoursePartTwo</span>;<br></code></pre></td></tr></table></figure>
<h2 id="React-Native">React Native</h2>
<h3 id="React-Native-介绍">React Native 介绍</h3>
<p>对于跨平台方案，<a target="_blank" rel="noopener external nofollow noreferrer" href="https://cordova.apache.org/">Cordova</a> 使用标准的网络技术--HTML5、CSS3 和 JavaScript 来开发多平台应用，在嵌入式浏览器窗口中运行，故不能达到使用实际本地用户界面组件的本地应用的性能或外观和感觉的</p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://reactnative.dev/">React Native</a> 将 React 的大量功能带入本地开发，在幕后利用平台的本地组件</p>
<p>使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.expo.io/versions/latest/">Expo</a> 初始化：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">npx create-expo-app rate-repository-app --template expo-template-blank@sdk-50<br></code></pre></td></tr></table></figure>
<p>可以使用安卓模拟器或 Expo Go 移动应用查看</p>
<p>安装 eslint：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">npm install --save-dev eslint @babel/eslint-parser eslint-plugin-react eslint-plugin-react-native<br></code></pre></td></tr></table></figure>
<h3 id="React-Native-入门">React Native 入门</h3>
<p>React Native 中有很多预先定义好的<a target="_blank" rel="noopener external nofollow noreferrer" href="https://reactnative.dev/docs/intro-react-native-components">核心组件</a>，例如文本：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Text</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native&#x27;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">HelloWorld</span> = (<span class="hljs-params">props</span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>Hello world!<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span></span>;<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>类似的还有 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://reactnative.dev/docs/view">View</a>，<a target="_blank" rel="noopener external nofollow noreferrer" href="https://reactnative.dev/docs/textinput">TextInput</a>，<a target="_blank" rel="noopener external nofollow noreferrer" href="https://reactnative.dev/docs/pressable">Pressable</a> 等组件</p>
<p>注意 react native 中所有样式属性都是无单位的，可用样式属性详见 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/vhpoet/react-native-styling-cheat-sheet">React Native Styling Cheat Sheet</a>，其用法为：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Text</span>, <span class="hljs-title class_">View</span>, <span class="hljs-title class_">StyleSheet</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native&#x27;</span>;<br><br><span class="hljs-keyword">const</span> styles = <span class="hljs-title class_">StyleSheet</span>.<span class="hljs-title function_">create</span>(&#123;<br>  <span class="hljs-attr">container</span>: &#123;<br>    <span class="hljs-attr">padding</span>: <span class="hljs-number">20</span>,<br>  &#125;,<br>  <span class="hljs-attr">text</span>: &#123;<br>    <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;blue&#x27;</span>,<br>    <span class="hljs-attr">fontSize</span>: <span class="hljs-number">24</span>,<br>    <span class="hljs-attr">fontWeight</span>: <span class="hljs-string">&#x27;700&#x27;</span>,<br>  &#125;,<br>&#125;);<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">BigBlueText</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> (<br>    &lt;View style=&#123;styles.container&#125;&gt;<br>      &lt;Text style=&#123;styles.text&#125;&gt;<br>        Big blue text<br>      &lt;Text&gt;<br>    &lt;/View&gt;<br>  );<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>使用 flexbox 布局：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">View</span>, <span class="hljs-title class_">Text</span>, <span class="hljs-title class_">StyleSheet</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native&#x27;</span>;<br><br><span class="hljs-keyword">const</span> styles = <span class="hljs-title class_">StyleSheet</span>.<span class="hljs-title function_">create</span>(&#123;<br>  <span class="hljs-attr">flexContainer</span>: &#123;<br>    <span class="hljs-attr">display</span>: <span class="hljs-string">&#x27;flex&#x27;</span>,<br>  &#125;,<br>  <span class="hljs-attr">flexItemA</span>: &#123;<br>    <span class="hljs-attr">flexGrow</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">&#x27;green&#x27;</span>,<br>  &#125;,<br>  <span class="hljs-attr">flexItemB</span>: &#123;<br>    <span class="hljs-attr">flexGrow</span>: <span class="hljs-number">1</span>,<br>    <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">&#x27;blue&#x27;</span>,<br>  &#125;,<br>&#125;);<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">FlexboxExample</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;styles.flexContainer&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;styles.flexItemA&#125;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>Flex item A<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;styles.flexItemB&#125;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>Flex item B<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br>  );<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.npmjs.com/package/react-router-native">react-router-native</a> 来实现路由，添加到组件：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">StatusBar</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;expo-status-bar&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">NativeRouter</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-router-native&#x27;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">NativeRouter</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Main</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">NativeRouter</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">StatusBar</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#x27;auto&#x27;</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  );<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>添加一个路由：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> <span class="hljs-title function_">Main</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">AppBar</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&#x27;/&#x27;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">RepositoryList</span> /&gt;</span>&#125; exact /&gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&#x27;*&#x27;</span> <span class="hljs-attr">element</span>=<span class="hljs-string">&#123;</span>&lt;<span class="hljs-attr">Navigate</span> <span class="hljs-attr">to</span>=<span class="hljs-string">&#x27;/&#x27;</span> <span class="hljs-attr">replace</span> /&gt;</span>&#125; /&gt;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br>  );<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://jaredpalmer.com/formik/">Formik</a> 来管理表单：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useFormik &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;formik&#x27;</span>;<br><br><span class="hljs-keyword">const</span> initialValues = &#123;<br>  <span class="hljs-attr">mass</span>: <span class="hljs-string">&#x27;&#x27;</span>,<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">BodyMassIndexForm</span> = (<span class="hljs-params">&#123; onSubmit &#125;</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> formik = <span class="hljs-title function_">useFormik</span>(&#123;<br>    initialValues,<br>    onSubmit,<br>  &#125;);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">TextInput</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;Weight (kg)&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;formik.values.mass&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChangeText</span>=<span class="hljs-string">&#123;formik.handleChange(</span>&#x27;<span class="hljs-attr">mass</span>&#x27;)&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">      /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Pressable</span> <span class="hljs-attr">onPress</span>=<span class="hljs-string">&#123;formik.handleSubmit&#125;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>Calculate<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Pressable</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">BodyMassIndexCalculator</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onSubmit</span> = values =&gt; &#123;...&#125;;<br><br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">BodyMassIndexForm</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">&#123;onSubmit&#125;</span> /&gt;</span></span>;<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">BodyMassIndexCalculator</span>;<br></code></pre></td></tr></table></figure>
<p>使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jquense/yup">Yup</a> 验证：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> yup <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;yup&#x27;</span>;<br><br><span class="hljs-keyword">const</span> validationSchema = yup.<span class="hljs-title function_">object</span>().<span class="hljs-title function_">shape</span>(&#123;<br>  <span class="hljs-attr">mass</span>: yup<br>    .<span class="hljs-title function_">number</span>()<br>    .<span class="hljs-title function_">min</span>(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;Weight must be greater or equal to 1&#x27;</span>)<br>    .required(<span class="hljs-string">&#x27;Weight is required&#x27;</span>),<br>&#125;);<br><br><span class="hljs-keyword">const</span> formik = <span class="hljs-title function_">useFormik</span>(&#123;<br>  initialValues,<br>  validationSchema,<br>  onSubmit,<br>&#125;);<br></code></pre></td></tr></table></figure>
<p>条件渲染错误提示：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx">&#123;<br>  formik.<span class="hljs-property">touched</span>.<span class="hljs-property">mass</span> &amp;&amp; formik.<span class="hljs-property">errors</span>.<span class="hljs-property">mass</span> &amp;&amp; (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">color:</span> &#x27;<span class="hljs-attr">red</span>&#x27; &#125;&#125;&gt;</span>&#123;formik.errors.mass&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span></span><br>  );<br>&#125;<br></code></pre></td></tr></table></figure>
<p>可以通过 <code>Platform.OS</code> 常量来访问用户的平台：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Platform</span>.<span class="hljs-property">OS</span> === <span class="hljs-string">&#x27;android&#x27;</span> ? <span class="hljs-string">&#x27;green&#x27;</span> : <span class="hljs-string">&#x27;blue&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p><code>Platform.select</code> 方法：给定一个对象，其键值为 <code>ios</code>、<code>android</code>、<code>native</code> 和 <code>default</code> 之一：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> styles = <span class="hljs-title class_">StyleSheet</span>.<span class="hljs-title function_">create</span>(&#123;<br>  <span class="hljs-attr">text</span>: &#123;<br>    <span class="hljs-attr">color</span>: <span class="hljs-title class_">Platform</span>.<span class="hljs-title function_">select</span>(&#123;<br>      <span class="hljs-attr">android</span>: <span class="hljs-string">&#x27;green&#x27;</span>,<br>      <span class="hljs-attr">ios</span>: <span class="hljs-string">&#x27;blue&#x27;</span>,<br>      <span class="hljs-attr">default</span>: <span class="hljs-string">&#x27;black&#x27;</span>,<br>    &#125;),<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>
<h3 id="与服务端通信">与服务端通信</h3>
<p>React Native 提供了 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">Fetch API</a>，如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;https://my-api.com/post-end-point&#x27;</span>, &#123;<br>  <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>  <span class="hljs-attr">headers</span>: &#123;<br>    <span class="hljs-title class_">Accept</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>,<br>    <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>,<br>  &#125;,<br>  <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123;<br>    <span class="hljs-attr">firstParam</span>: <span class="hljs-string">&#x27;firstValue&#x27;</span>,<br>    <span class="hljs-attr">secondParam</span>: <span class="hljs-string">&#x27;secondValue&#x27;</span>,<br>  &#125;),<br>&#125;);<br></code></pre></td></tr></table></figure>
<p>也可以通过 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequest API</a> 使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/axios/axios">Axios</a> 等第三方库</p>
<p>这里作为 GraphQL 和 Apollo client，需要安装：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">npm install @apollo/client graphql @expo/metro-config<br></code></pre></td></tr></table></figure>
<p>在根目录下的 <code>metro.config.js</code> 添加：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> &#123; getDefaultConfig &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@expo/metro-config&#x27;</span>);<br><span class="hljs-keyword">const</span> defaultConfig = <span class="hljs-title function_">getDefaultConfig</span>(__dirname);<br>defaultConfig.<span class="hljs-property">resolver</span>.<span class="hljs-property">sourceExts</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;cjs&#x27;</span>);<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = defaultConfig;<br></code></pre></td></tr></table></figure>
<p>创建一个 <code>apolloClient.js</code> 文件，配置连接到 Apollo 服务器的客户端：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ApolloClient</span>, <span class="hljs-title class_">InMemoryCache</span>, createHttpLink &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@apollo/client&#x27;</span>;<br><br><span class="hljs-keyword">const</span> httpLink = <span class="hljs-title function_">createHttpLink</span>(&#123; <span class="hljs-attr">uri</span>: <span class="hljs-string">&#x27;http://192.168.100.16:4000/graphql&#x27;</span> &#125;);<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">createApolloClient</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApolloClient</span>(&#123;<br>    <span class="hljs-attr">link</span>: httpLink,<br>    <span class="hljs-attr">cache</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryCache</span>(),<br>  &#125;);<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> createApolloClient;<br></code></pre></td></tr></table></figure>
<p>添加到组件：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ApolloProvider</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@apollo/client&#x27;</span>;<br><span class="hljs-keyword">const</span> apolloClient = <span class="hljs-title function_">createApolloClient</span>();<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">NativeRouter</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">ApolloProvider</span> <span class="hljs-attr">client</span>=<span class="hljs-string">&#123;apolloClient&#125;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Main</span> /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">ApolloProvider</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">NativeRouter</span>&gt;</span></span><br>  );<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>在组织代码时，可以在 graphql 目录下创建 <code>queries.js</code>，每个查询都存储在一个变量中，并一个个导出。改变则储存在 mutations.js，同时善于使用 fragments.js 来精简代码</p>
<p>我们有组件<em>A</em>，它渲染了组件 B 和 C，则目录可以为：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs dir">components/<br>  A/<br>    B.jsx<br>    C.jsx<br>    index.jsx<br></code></pre></td></tr></table></figure>
<p>而不需要改动引入组件 A 的代码，其自动匹配到 <code>A/index.jsx</code></p>
<p>React Native 没有对环境变量的直接支持，但可以通过改变 <code>app.json</code> 文件中定义的 Expo 配置来实现：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;dotenv/config&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;rate-repository-app&#x27;</span>,<br>  <span class="hljs-attr">extra</span>: &#123;<br>    <span class="hljs-attr">env</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">ENV</span>,<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>并配合熟悉的 <code>dotenv</code></p>
<p>持久化本地存储 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://react-native-async-storage.github.io/async-storage/docs/usage/">AsyncStorage</a>：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">expo install @react-native-async-storage/async-storage<br></code></pre></td></tr></table></figure>
<p>和 <code>localStorage</code> 类似，但顾名思义，其操作是<strong>异步</strong>的，因为是在全局命名空间操作，故最好添加一个命名空间</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">AsyncStorage</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@react-native-async-storage/async-storage&#x27;</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ShoppingCartStorage</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">namespace = <span class="hljs-string">&#x27;shoppingCart&#x27;</span></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">namespace</span> = namespace;<br>  &#125;<br><br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getProducts</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> rawProducts = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AsyncStorage</span>.<span class="hljs-title function_">getItem</span>(<br>      <span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.namespace&#125;</span>:products`</span><br>    );<br>    <span class="hljs-keyword">return</span> rawProducts ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(rawProducts) : [];<br>  &#125;<br><br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">addProduct</span>(<span class="hljs-params">productId</span>) &#123;<br>    <span class="hljs-keyword">const</span> currentProducts = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getProducts</span>();<br>    <span class="hljs-keyword">const</span> newProducts = [...currentProducts, productId];<br>    <span class="hljs-keyword">await</span> <span class="hljs-title class_">AsyncStorage</span>.<span class="hljs-title function_">setItem</span>(<br>      <span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.namespace&#125;</span>:products`</span>,<br>      <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(newProducts)<br>    );<br>  &#125;<br><br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">clearProducts</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">await</span> <span class="hljs-title class_">AsyncStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.namespace&#125;</span>:products`</span>);<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">doShopping</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> shoppingCartA = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShoppingCartStorage</span>(<span class="hljs-string">&#x27;shoppingCartA&#x27;</span>);<br>  <span class="hljs-keyword">await</span> shoppingCartA.<span class="hljs-title function_">addProduct</span>(<span class="hljs-string">&#x27;chips&#x27;</span>);<br>  <span class="hljs-keyword">const</span> productsA = <span class="hljs-keyword">await</span> shoppingCartA.<span class="hljs-title function_">getProducts</span>();<br>  <span class="hljs-keyword">await</span> shoppingCartA.<span class="hljs-title function_">clearProducts</span>();<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>将访问令牌发送给 Apollo 服务器：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ApolloClient</span>, <span class="hljs-title class_">InMemoryCache</span>, createHttpLink &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@apollo/client&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Constants</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;expo-constants&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; setContext &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@apollo/client/link/context&#x27;</span>;<br><br><span class="hljs-keyword">const</span> &#123; apolloUri &#125; = <span class="hljs-title class_">Constants</span>.<span class="hljs-property">manifest</span>.<span class="hljs-property">extra</span>;<br><span class="hljs-keyword">const</span> httpLink = <span class="hljs-title function_">createHttpLink</span>(&#123; <span class="hljs-attr">uri</span>: apolloUri &#125;);<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">createApolloClient</span> = (<span class="hljs-params">authStorage</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> authLink = <span class="hljs-title function_">setContext</span>(<span class="hljs-keyword">async</span> (_, &#123; headers &#125;) =&gt; &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-keyword">const</span> accessToken = <span class="hljs-keyword">await</span> authStorage.<span class="hljs-title function_">getAccessToken</span>();<br>      <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-attr">headers</span>: &#123;<br>          ...headers,<br>          <span class="hljs-attr">authorization</span>: accessToken ? <span class="hljs-string">`Bearer <span class="hljs-subst">$&#123;accessToken&#125;</span>`</span> : <span class="hljs-string">&#x27;&#x27;</span>,<br>        &#125;,<br>      &#125;;<br>    &#125; <span class="hljs-keyword">catch</span> (e) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e);<br>      <span class="hljs-keyword">return</span> &#123;<br>        headers,<br>      &#125;;<br>    &#125;<br>  &#125;);<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ApolloClient</span>(&#123;<br>    <span class="hljs-attr">link</span>: authLink.<span class="hljs-title function_">concat</span>(httpLink),<br>    <span class="hljs-attr">cache</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">InMemoryCache</span>(),<br>  &#125;);<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> createApolloClient;<br></code></pre></td></tr></table></figure>
<p>使用 React Context 来使挂钩访问到 token：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">AuthStorageContext</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createContext</span>();<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">AuthStorageContext</span>;<br></code></pre></td></tr></table></figure>
<p>在 <code>app.js</code> 中：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">AuthStorageContext</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./src/contexts/AuthStorageContext&#x27;</span>;<br><br><span class="hljs-keyword">const</span> authStorage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AuthStorage</span>();<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">AuthStorageContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;authStorage&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Main</span> /&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">AuthStorageContext.Provider</span>&gt;</span></span><br>  );<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>使用 <code>useContext</code> 钩访问：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; useContext &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">AuthStorageContext</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../contexts/AuthStorageContext&#x27;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">useAuthStorage</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">AuthStorageContext</span>);<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> useAuthStorage;<br></code></pre></td></tr></table></figure>
<h3 id="测试与扩展我们的应用">测试与扩展我们的应用</h3>
<p>安装 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://jestjs.io/">Jest</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">npm install --save-dev jest jest-expo eslint-plugin-jest<br></code></pre></td></tr></table></figure>
<p>在 package.json 文件中加入 Jest 配置：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;test&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;jest&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br><br>  <span class="hljs-attr">&quot;jest&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;preset&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;jest-expo&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;transform&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;^.+\\.jsx?$&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;babel-jest&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;transformIgnorePatterns&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>      <span class="hljs-string">&quot;node_modules/(?!((jest-)?react-native|@react-native(-community)?)|expo(nent)?|@expo(nent)?/.*|@expo-google-fonts/.*|react-navigation|@react-navigation/.*|@unimodules/.*|unimodules|sentry-expo|native-base|react-native-svg|react-router-native)&quot;</span><br>    <span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
<p>把 eslint-plugin-jest 包含在 <code>.eslintrc</code> 文件的插件和扩展数组中：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;extends&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;eslint:recommended&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;plugin:react/recommended&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;plugin:jest/recommended&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br></code></pre></td></tr></table></figure>
<p>存放 test 文件有两种方式，第一种是把测试文件放在其相应的子目录中，就像代码本身一样，如：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs file">src/<br>  __tests__/<br>    components/<br>      AppBar.js<br>      RepositoryList.js<br>    utils/<br>      authStorage.js<br></code></pre></td></tr></table></figure>
<p>另一种方法是在实现附近组织测试，即在同一目录下（注意添加 <code>.test</code> 后缀）：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs dir">src/<br>  components/<br>    AppBar/<br>      AppBar.test.jsx<br>      index.jsx<br></code></pre></td></tr></table></figure>
<p>测试组件安装：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">npm install --save-dev react-test-renderer@17.0.1 @testing-library/react-native @testing-library/jest-native<br></code></pre></td></tr></table></figure>
<p>一个测试的例子：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Text</span>, <span class="hljs-title class_">View</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; render &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@testing-library/react-native&#x27;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Greeting</span> = (<span class="hljs-params">&#123; name &#125;</span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>Hello &#123;name&#125;!<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-title function_">describe</span>(<span class="hljs-string">&#x27;Greeting&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">it</span>(<span class="hljs-string">&#x27;renders a greeting message based on the name prop&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> &#123; debug, getByText &#125; = <span class="hljs-title function_">render</span>(<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Greeting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;Kalle&#x27;</span> /&gt;</span></span>);<br>    <span class="hljs-title function_">debug</span>();<br>    <span class="hljs-title function_">expect</span>(<span class="hljs-title function_">getByText</span>(<span class="hljs-string">&#x27;Hello Kalle!&#x27;</span>)).<span class="hljs-title function_">toBeDefined</span>();<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure>
<p>对于一些非纯函数，如需要与服务器通信，可以将非纯的部分提取出来，单独测试纯函数部分：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">RepositoryListContainer</span> = (<span class="hljs-params">&#123; repositories &#125;</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> repositoryNodes = repositories<br>    ? repositories.<span class="hljs-property">edges</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">edge</span>) =&gt;</span> edge.<span class="hljs-property">node</span>)<br>    : [];<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">FlatList</span> <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;repositoryNodes&#125;</span> /&gt;</span></span>;<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">RepositoryList</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> &#123; repositories &#125; = <span class="hljs-title function_">useRepositories</span>();<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">RepositoryListContainer</span> <span class="hljs-attr">repositories</span>=<span class="hljs-string">&#123;repositories&#125;</span> /&gt;</span></span>;<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">RepositoryList</span>;<br></code></pre></td></tr></table></figure>
<p>当 API 从某个集合中返回一个有序的项目列表时，它通常会返回整个项目集的一个子集，以减少所需的带宽，并降低客户端应用的内存使用。客户端就可以请求例如列表中某个索引后的前 20 个项目。这种技术通常被称为<strong>分页</strong></p>
<p>当项目可以在由<strong>游标</strong>定义的某个项目之后被请求时，我们谈论的就是<strong>基于游标的分页</strong>。</p>
<p>这是一个查询：</p>
<figure class="highlight graphql"><table><tr><td class="code"><pre><code class="hljs graphql"><span class="hljs-punctuation">&#123;</span><br>  repositories<span class="hljs-punctuation">(</span><span class="hljs-symbol">first</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">&#123;</span><br>    edges <span class="hljs-punctuation">&#123;</span><br>      node <span class="hljs-punctuation">&#123;</span><br>        fullName<br>      <span class="hljs-punctuation">&#125;</span><br>      cursor<br>    <span class="hljs-punctuation">&#125;</span><br>    pageInfo <span class="hljs-punctuation">&#123;</span><br>      endCursor<br>      startCursor<br>      hasNextPage<br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
<p>然后使用返回的 <code>endCursor</code> 进行下一步查询</p>
<p><strong>无限滚动</strong>的实现方法：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">RepositoryListContainer</span> = (<span class="hljs-params">&#123; repositories, onEndReach &#125;</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> repositoryNodes = repositories<br>    ? repositories.<span class="hljs-property">edges</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">edge</span>) =&gt;</span> edge.<span class="hljs-property">node</span>)<br>    : [];<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">FlatList</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">data</span>=<span class="hljs-string">&#123;repositoryNodes&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">onEndReached</span>=<span class="hljs-string">&#123;onEndReach&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">onEndReachedThreshold</span>=<span class="hljs-string">&#123;0.5&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    /&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">RepositoryList</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> &#123; repositories &#125; = <span class="hljs-title function_">useRepositories</span>(<span class="hljs-comment">/* ... */</span>);<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onEndReach</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-title function_">fetchMore</span>();<br>  &#125;;<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">RepositoryListContainer</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">repositories</span>=<span class="hljs-string">&#123;repositories&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">onEndReach</span>=<span class="hljs-string">&#123;onEndReach&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    /&gt;</span></span><br>  );<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">RepositoryList</span>;<br></code></pre></td></tr></table></figure>
<p>并定义相关的 <code>fetchMore</code> 函数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">useRepositories</span> = (<span class="hljs-params">variables</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> &#123; data, loading, fetchMore, ...result &#125; = <span class="hljs-title function_">useQuery</span>(<span class="hljs-variable constant_">GET_REPOSITORIES</span>, &#123;<br>    variables,<br>  &#125;);<br><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleFetchMore</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> canFetchMore = !loading &amp;&amp; data?.<span class="hljs-property">repositories</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-property">hasNextPage</span>;<br><br>    <span class="hljs-keyword">if</span> (!canFetchMore) &#123;<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-title function_">fetchMore</span>(&#123;<br>      <span class="hljs-attr">variables</span>: &#123;<br>        <span class="hljs-attr">after</span>: data.<span class="hljs-property">repositories</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-property">endCursor</span>,<br>        ...variables,<br>      &#125;,<br>    &#125;);<br>  &#125;;<br><br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">repositories</span>: data?.<span class="hljs-property">repositories</span>,<br>    <span class="hljs-attr">fetchMore</span>: handleFetchMore,<br>    loading,<br>    ...result,<br>  &#125;;<br>&#125;;<br></code></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jondot/awesome-react-native">Awesome React Native</a> 中有丰富的 React Native 资源，如 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://callstack.github.io/react-native-paper/">React Native Paper</a>，<a target="_blank" rel="noopener external nofollow noreferrer" href="https://styled-components.com/">Styled-components</a>，<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.react-spring.io/">React-spring</a>，<a target="_blank" rel="noopener external nofollow noreferrer" href="https://reactnavigation.org/">React Navigation</a> 等</p>
<h2 id="CI-CD">CI/CD</h2>
<h3 id="CI-CD-简介">CI/CD 简介</h3>
<p><strong>CI 持续集成</strong>：经常性地将开发人员的修改合并到主分支上，通常有以下的步骤：</p>
<ul>
<li>提示：保持我们的代码清洁和可维护</li>
<li>构建：将我们所有的代码整合成软件</li>
<li>测试：以确保我们不会破坏现有的功能</li>
<li>打包：把它全部放在一个容易移动的批次中</li>
<li>上传/部署：将它提供给全世界</li>
</ul>
<p><strong>CD 主分支始终保持可部署</strong>，两者并没有清晰的界限</p>
<p>CI 有两种选择：托管我们自己的服务器（<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.jenkins.io/">Jenkins</a>）或使用云服务（<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/features/actions">GitHub Actions</a>）</p>
<h3 id="开始认识-GitHub-Actions-吧">开始认识 GitHub Actions 吧</h3>
<p>GitHub Action 的基础是工作流，执行过程为：</p>
<ol>
<li>触发事件发生</li>
<li>带有该触发器的工作流被执行</li>
<li>清理</li>
</ol>
<p>每个工作流必须指定至少一个 job，其中包含一组 step 来执行单个任务。jobs <strong>并行</strong>执行，每个 job 中的 steps 会<strong>顺序</strong>执行</p>
<p>工作流存储在 ``.github/workflows<code>中，格式为</code>YAML`</p>
<p><s>工作流也有 hello world：</s></p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Hello</span> <span class="hljs-string">World!</span><br><br><span class="hljs-attr">on:</span><br>  <span class="hljs-attr">push:</span><br>    <span class="hljs-attr">branches:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">master</span><br><br><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">hello_world_job:</span><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-20.04</span><br>    <span class="hljs-attr">steps:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Say</span> <span class="hljs-string">hello</span><br>        <span class="hljs-attr">run:</span> <span class="hljs-string">echo</span> <span class="hljs-string">&quot;Hello World!&quot;</span><br></code></pre></td></tr></table></figure>
<p>使用 <code>usess</code> 执行定义好的动作，如：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">simple_deployment_pipeline:</span><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-20.04</span><br>    <span class="hljs-attr">steps:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v4</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v2</span><br>        <span class="hljs-attr">with:</span><br>          <span class="hljs-attr">node-version:</span> <span class="hljs-string">&#x27;20&#x27;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span><br>        <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">lint</span><br>        <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">run</span> <span class="hljs-string">eslint</span><br></code></pre></td></tr></table></figure>
<h3 id="部署">部署</h3>
<p>任何事情都有可能出错</p>
<h3 id="保持健康状态">保持健康状态</h3>
<p>为了保持主分支的绿色，通常避免将任何修改直接提交到主分支，而是在一个基于主分支的最新版本的分支上提交代码，然后创建 PR 合并到主分支</p>
<p>向工作流中加入 PR 时自动检查代码的功能：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">on:</span><br>  <span class="hljs-attr">push:</span><br>    <span class="hljs-attr">branches:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">master</span><br><br>  <span class="hljs-attr">pull_request:</span><br>    <span class="hljs-attr">branches:</span> [<span class="hljs-string">master</span>]<br>    <span class="hljs-attr">types:</span> [<span class="hljs-string">opened</span>, <span class="hljs-string">synchronize</span>]<br></code></pre></td></tr></table></figure>
<p>版本管理：</p>
<ul>
<li>语义版本管理：易读，通常用于发布</li>
<li>哈希版本控制：保证唯一，通常用于开发</li>
</ul>
<p>github 可以设置受保护的分支</p>
<h3 id="再扩展一下">再扩展一下</h3>
<p>在构建失败时发送通知</p>
<p>随着项目越来越复杂，其构建时间也越来越长，要权衡取舍</p>
<h2 id="容器">容器</h2>
<h3 id="容器介绍">容器介绍</h3>
<p>使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.docker.com/">Docker</a></p>
<p>容器也有 <code>hello world</code>：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">docker container run hello-world<br></code></pre></td></tr></table></figure>
<p><code>docker container ls -a</code> 列出所有的容器</p>
<p><code>docker start 容器名或 ID</code> 启动容器</p>
<p><code>docker container run -it ubuntu bash</code> 在 <code>bash</code> 命令行下，以交互式启动 <code>ubuntu</code> image</p>
<p><code>docker kill 容器名或 ID</code> 停止某个容器</p>
<p><code>docker commit 容器 镜像</code> 从容器中创建一个新的镜像</p>
<p><code>docker image ls</code> 列出所有镜像</p>
<p><code>docker container rm 容器名或 ID</code> 删除某个容器</p>
<h3 id="构建配置环境">构建配置环境</h3>
<p>在 <code>Dockerfile</code> 文件中配置，如：</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> node:<span class="hljs-number">16</span><br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /usr/src/app</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> ./index.js ./index.js</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> node index.js</span><br></code></pre></td></tr></table></figure>
<p>使用 <code>docker build</code> 来构建一个基于 Docker 文件的镜像，<code>-t</code> 用于命名</p>
<p><code>.dockerignore</code> 文件可以防止我们不小心将不需要的文件复制到镜像中</p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.docker.com/compose/">Docker-compose</a> 可以帮助我们管理容器</p>
<p>这里将之前的命令转化为一个 <code>yaml</code> 文件：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3.8&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">app:</span> <span class="hljs-comment"># 服务的名字</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">express-server</span> <span class="hljs-comment"># 声明使用的镜像</span><br>    <span class="hljs-attr">build:</span> <span class="hljs-string">.</span> <span class="hljs-comment"># 如果镜像没找到，则在哪里 build 一个镜像</span><br>    <span class="hljs-attr">ports:</span> <span class="hljs-comment"># 声明发布的端口</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">3000</span><span class="hljs-string">:3000</span><br></code></pre></td></tr></table></figure>
<p><code>docker-compose up</code> 可以构建应用并运行应用，<code>-d</code> 参数表示在后台运行，<code>docker-compose down</code> 关闭</p>
<p>绑定挂载是将主机上的文件与容器中的文件绑定的行为，在 Docker Compose 中的 volumes 键下声明：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">mongo:</span><br>  <span class="hljs-attr">image:</span> <span class="hljs-string">mongo</span><br>  <span class="hljs-attr">ports:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-number">3456</span><span class="hljs-string">:27017</span><br>  <span class="hljs-attr">environment:</span><br>    <span class="hljs-attr">MONGO_INITDB_ROOT_USERNAME:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">MONGO_INITDB_ROOT_PASSWORD:</span> <span class="hljs-string">example</span><br>    <span class="hljs-attr">MONGO_INITDB_DATABASE:</span> <span class="hljs-string">the_database</span><br>  <span class="hljs-attr">volumes:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">./mongo/mongo-init.js:/docker-entrypoint-initdb.d/mongo-init.js</span><br></code></pre></td></tr></table></figure>
<p>Docker 的 <code>exec</code> 命令可以在一个容器运行时直接跳入它，如 <code>docker exec -it wonderful_ramanujan bash</code></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://redis.io/">Redis</a> 是一个非关系型数据库，默认情况下在内存中工作，故可以用作缓存。除此之外也可以实现“发布-订阅”模式，即作为多个应用之间的消息代理工作</p>
<h3 id="编排基础">编排基础</h3>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;serve&quot;</span>, <span class="hljs-string">&quot;build&quot;</span>]</span><br></code></pre></td></tr></table></figure>
<p>是 CMD 的 <code>exec</code> 形式</p>
<p>多阶段构建：将构建过程分成许多独立的阶段，可以限制镜像文件的大小：</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-comment">## 第一个 FROM 是 build-stage 阶段</span><br><span class="hljs-keyword">FROM</span> node:<span class="hljs-number">16</span> AS build-stage<br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> /usr/src/app</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> . .</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> npm ci</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> npm run build</span><br><span class="hljs-comment">## 新的阶段，之前的都完成了，除了我们想要 COPY 的文件</span><br><span class="hljs-keyword">FROM</span> nginx:<span class="hljs-number">1.20</span>-alpine<br><span class="hljs-comment">## 从 build-stage 中构建的目录复制到 /usr/share/nginx/html</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> --from=build-stage /usr/src/app/build /usr/share/nginx/html</span><br></code></pre></td></tr></table></figure>
<p>也可以设置为直接在容器中开发程序：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">app:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">hello-front-dev</span><br>    <span class="hljs-attr">build:</span><br>      <span class="hljs-attr">context:</span> <span class="hljs-string">.</span> <span class="hljs-comment"># The context will pick this directory as the &quot;build context&quot;</span><br>      <span class="hljs-attr">dockerfile:</span> <span class="hljs-string">dev.Dockerfile</span> <span class="hljs-comment"># This will simply tell which dockerfile to read</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./:/usr/src/app</span> <span class="hljs-comment"># The path can be relative, so ./ is enough to say &quot;the same location as the docker-compose.yml&quot;</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">3000</span><span class="hljs-string">:3000</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">hello-front-dev</span> <span class="hljs-comment"># This will name the container hello-front-dev</span><br></code></pre></td></tr></table></figure>
<p>不过安装新的依赖比较麻烦，最好是在容器中安装，如 <code>docker exec hello-front-dev npm install axios</code> 并重新 <code>docker build</code></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.busybox.net/">Busybox</a> 可以帮助我们调试我们的配置，加入</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">debug-helper:</span><br>  <span class="hljs-attr">image:</span> <span class="hljs-string">busybox</span><br></code></pre></td></tr></table></figure>
<p>如发送一个请求：<code>docker-compose run debug-helper wget -O - http://app:3000</code></p>
<p>注意到 docker 的容器间有一个 DNS，<code>app</code> 域名被解析为某容器中的网络了</p>
<h2 id="使用关系型数据库">使用关系型数据库</h2>
<h3 id="用-Sequelize-使用关系型数据库">用 Sequelize 使用关系型数据库</h3>
<p>之前使用的 MongoDB 是<strong>无模式</strong>的，这里介绍一个关系型数据库——<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.postgresql.org/">PostgreSQL</a></p>
<p>安装完成后，有图形用户界面，如 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.pgadmin.org/">pgAdmin</a>，这里使用命令行 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.postgresql.org/docs/current/app-psql.html">psql</a></p>
<p><code>\d</code> 命令可以告诉数据库的内容</p>
<p>一个创建表的例子：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> notes (<br>    id SERIAL <span class="hljs-keyword">PRIMARY</span> KEY,<br>    content text <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    important <span class="hljs-type">boolean</span>,<br>    <span class="hljs-type">date</span> <span class="hljs-type">time</span><br>);<br></code></pre></td></tr></table></figure>
<p><code>\d notes</code> 查看表格 notes</p>
<p>添加内容：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> notes (content, important) <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;Relational databases rule the world&#x27;</span>, <span class="hljs-literal">true</span>);<br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> notes (content, important) <span class="hljs-keyword">values</span> (<span class="hljs-string">&#x27;MongoDB is webscale&#x27;</span>, <span class="hljs-literal">false</span>);<br></code></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://sequelize.org/master/">sequelize</a> 库可以在不使用 SQL 语言的情况下存储 JavaScript 对象</p>
<p>与数据库建立连接的方法：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;dotenv&#x27;</span>).<span class="hljs-title function_">config</span>();<br><span class="hljs-keyword">const</span> &#123; <span class="hljs-title class_">Sequelize</span> &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;sequelize&#x27;</span>);<br><br><span class="hljs-keyword">const</span> sequelize = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sequelize</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">DATABASE_URL</span>, &#123;<br>  <span class="hljs-attr">dialectOptions</span>: &#123;<br>    <span class="hljs-attr">ssl</span>: &#123;<br>      <span class="hljs-attr">require</span>: <span class="hljs-literal">true</span>,<br>      <span class="hljs-attr">rejectUnauthorized</span>: <span class="hljs-literal">false</span>,<br>    &#125;,<br>  &#125;,<br>&#125;);<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">main</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">await</span> sequelize.<span class="hljs-title function_">authenticate</span>();<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Connection has been established successfully.&#x27;</span>);<br>    sequelize.<span class="hljs-title function_">close</span>();<br>  &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&#x27;Unable to connect to the database:&#x27;</span>, error);<br>  &#125;<br>&#125;;<br><br><span class="hljs-title function_">main</span>();<br></code></pre></td></tr></table></figure>
<p>建立代码中的模型：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Note</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Model</span> &#123;&#125;<br><span class="hljs-title class_">Note</span>.<span class="hljs-title function_">init</span>(<br>  &#123;<br>    <span class="hljs-attr">id</span>: &#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-title class_">DataTypes</span>.<span class="hljs-property">INTEGER</span>,<br>      <span class="hljs-attr">primaryKey</span>: <span class="hljs-literal">true</span>,<br>      <span class="hljs-attr">autoIncrement</span>: <span class="hljs-literal">true</span>,<br>    &#125;,<br>    <span class="hljs-attr">content</span>: &#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-title class_">DataTypes</span>.<span class="hljs-property">TEXT</span>,<br>      <span class="hljs-attr">allowNull</span>: <span class="hljs-literal">false</span>,<br>    &#125;,<br>    <span class="hljs-attr">important</span>: &#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-title class_">DataTypes</span>.<span class="hljs-property">BOOLEAN</span>,<br>    &#125;,<br>    <span class="hljs-attr">date</span>: &#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-title class_">DataTypes</span>.<span class="hljs-property">DATE</span>,<br>    &#125;,<br>  &#125;,<br>  &#123;<br>    sequelize,<br>    <span class="hljs-attr">underscored</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">timestamps</span>: <span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">modelName</span>: <span class="hljs-string">&#x27;note&#x27;</span>,<br>  &#125;<br>);<br></code></pre></td></tr></table></figure>
<p>查找全部：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/notes&#x27;</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> notes = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Note</span>.<span class="hljs-title function_">findAll</span>();<br>  res.<span class="hljs-title function_">json</span>(notes);<br>&#125;);<br></code></pre></td></tr></table></figure>
<p>创建新的对象：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> note = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Note</span>.<span class="hljs-title function_">create</span>(req.<span class="hljs-property">body</span>);<br></code></pre></td></tr></table></figure>
<p>也可以分为两步：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> note = <span class="hljs-title class_">Note</span>.<span class="hljs-title function_">build</span>(req.<span class="hljs-property">body</span>);<br>note.<span class="hljs-property">important</span> = <span class="hljs-literal">true</span>;<br><span class="hljs-keyword">await</span> note.<span class="hljs-title function_">save</span>();<br></code></pre></td></tr></table></figure>
<p>根据 id 查找：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> note = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Note</span>.<span class="hljs-title function_">findByPk</span>(req.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>);<br></code></pre></td></tr></table></figure>
<h3 id="加入表与查询">加入表与查询</h3>
<p>项目的文件结构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs file">index.js<br>util<br>  config.js<br>  db.js<br>models<br>  index.js<br>  note.js<br>controllers<br>  notes.js<br></code></pre></td></tr></table></figure>
<p>两个表之间建立一对多的关系：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-title class_">User</span>.<span class="hljs-title function_">hasMany</span>(<span class="hljs-title class_">Note</span>);<br><span class="hljs-title class_">Note</span>.<span class="hljs-title function_">belongsTo</span>(<span class="hljs-title class_">User</span>);<br><span class="hljs-title class_">Note</span>.<span class="hljs-title function_">sync</span>(&#123; <span class="hljs-attr">alter</span>: <span class="hljs-literal">true</span> &#125;);<br><span class="hljs-title class_">User</span>.<span class="hljs-title function_">sync</span>(&#123; <span class="hljs-attr">alter</span>: <span class="hljs-literal">true</span> &#125;);<br></code></pre></td></tr></table></figure>
<p>查询时包括的内容也一并返回：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> users = <span class="hljs-keyword">await</span> <span class="hljs-title class_">User</span>.<span class="hljs-title function_">findAll</span>(&#123;<br>  <span class="hljs-attr">include</span>: &#123; <span class="hljs-attr">model</span>: <span class="hljs-title class_">Note</span> &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>
<p>还可以进一步限制想要的字段的值：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> notes = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Note</span>.<span class="hljs-title function_">findAll</span>(&#123;<br>  <span class="hljs-attr">attributes</span>: &#123; <span class="hljs-attr">exclude</span>: [<span class="hljs-string">&#x27;userId&#x27;</span>] &#125;,<br>  <span class="hljs-attr">include</span>: &#123;<br>    <span class="hljs-attr">model</span>: <span class="hljs-title class_">User</span>,<br>    <span class="hljs-attr">attributes</span>: [<span class="hljs-string">&#x27;name&#x27;</span>],<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>
<p>我们可以实现一个带参数的查询，如 <code>http://localhost:3001/api/notes?search=database&amp;important=true</code>：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> where = &#123;&#125;;<br><span class="hljs-keyword">if</span> (req.<span class="hljs-property">query</span>.<span class="hljs-property">important</span>) &#123;<br>  where.<span class="hljs-property">important</span> = req.<span class="hljs-property">query</span>.<span class="hljs-property">important</span> === <span class="hljs-string">&#x27;true&#x27;</span>;<br>&#125;<br><span class="hljs-keyword">if</span> (req.<span class="hljs-property">query</span>.<span class="hljs-property">search</span>) &#123;<br>  where.<span class="hljs-property">content</span> = &#123; [<span class="hljs-title class_">Op</span>.<span class="hljs-property">substring</span>]: req.<span class="hljs-property">query</span>.<span class="hljs-property">search</span> &#125;;<br>&#125;<br><span class="hljs-keyword">const</span> notes = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Note</span>.<span class="hljs-title function_">findAll</span>(&#123;<br>  <span class="hljs-attr">attributes</span>: &#123; <span class="hljs-attr">exclude</span>: [<span class="hljs-string">&#x27;userId&#x27;</span>] &#125;,<br>  <span class="hljs-attr">include</span>: &#123;<br>    <span class="hljs-attr">model</span>: user,<br>    <span class="hljs-attr">attributes</span>: [<span class="hljs-string">&#x27;name&#x27;</span>],<br>  &#125;,<br>  where,<br>&#125;);<br></code></pre></td></tr></table></figure>
<h3 id="迁移，多对多关系">迁移，多对多关系</h3>
<p><strong>迁移 migrantion</strong> 是一个单一的 JavaScript 文件，描述了对数据库的一些修改，迁移引起的变化同步到数据库模式中，最终实现了修改可控</p>
<p>这是一个迁移的例子：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">up</span>: <span class="hljs-keyword">async</span> (&#123; <span class="hljs-attr">context</span>: queryInterface &#125;) =&gt; &#123;<br>    <span class="hljs-keyword">await</span> queryInterface.<span class="hljs-title function_">createTable</span>(<span class="hljs-string">&#x27;notes&#x27;</span>, &#123;<br>      <span class="hljs-attr">id</span>: &#123;<br>        <span class="hljs-attr">type</span>: <span class="hljs-title class_">DataTypes</span>.<span class="hljs-property">INTEGER</span>,<br>        <span class="hljs-attr">primaryKey</span>: <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">autoIncrement</span>: <span class="hljs-literal">true</span>,<br>      &#125;,<br>      <span class="hljs-attr">content</span>: &#123;<br>        <span class="hljs-attr">type</span>: <span class="hljs-title class_">DataTypes</span>.<span class="hljs-property">TEXT</span>,<br>        <span class="hljs-attr">allowNull</span>: <span class="hljs-literal">false</span>,<br>      &#125;,<br>    &#125;);<br>    <span class="hljs-keyword">await</span> queryInterface.<span class="hljs-title function_">createTable</span>(<span class="hljs-string">&#x27;users&#x27;</span>, &#123;<br>      <span class="hljs-attr">id</span>: &#123;<br>        <span class="hljs-attr">type</span>: <span class="hljs-title class_">DataTypes</span>.<span class="hljs-property">INTEGER</span>,<br>        <span class="hljs-attr">primaryKey</span>: <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">autoIncrement</span>: <span class="hljs-literal">true</span>,<br>      &#125;,<br>      <span class="hljs-attr">username</span>: &#123;<br>        <span class="hljs-attr">type</span>: <span class="hljs-title class_">DataTypes</span>.<span class="hljs-property">STRING</span>,<br>        <span class="hljs-attr">unique</span>: <span class="hljs-literal">true</span>,<br>        <span class="hljs-attr">allowNull</span>: <span class="hljs-literal">false</span>,<br>      &#125;,<br>    &#125;);<br>    <span class="hljs-keyword">await</span> queryInterface.<span class="hljs-title function_">addColumn</span>(<span class="hljs-string">&#x27;notes&#x27;</span>, <span class="hljs-string">&#x27;user_id&#x27;</span>, &#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-title class_">DataTypes</span>.<span class="hljs-property">INTEGER</span>,<br>      <span class="hljs-attr">allowNull</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-attr">references</span>: &#123; <span class="hljs-attr">model</span>: <span class="hljs-string">&#x27;users&#x27;</span>, <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;id&#x27;</span> &#125;,<br>    &#125;);<br>  &#125;,<br>  <span class="hljs-attr">down</span>: <span class="hljs-keyword">async</span> (&#123; <span class="hljs-attr">context</span>: queryInterface &#125;) =&gt; &#123;<br>    <span class="hljs-keyword">await</span> queryInterface.<span class="hljs-title function_">dropTable</span>(<span class="hljs-string">&#x27;notes&#x27;</span>);<br>    <span class="hljs-keyword">await</span> queryInterface.<span class="hljs-title function_">dropTable</span>(<span class="hljs-string">&#x27;users&#x27;</span>);<br>  &#125;,<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>函数 <code>up</code> 是定义了在执行迁移时应该如何修改数据库，而 <code>down</code> 定义如何撤销迁移</p>
<p>迁移文件命名总是以日期和序号开始，如 <code>migrations/20211209_00_initialize_notes_and_users.js</code></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/sequelize/umzug">Umzug</a> 库可以从程序中手动执行迁移：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> &#123; <span class="hljs-title class_">Umzug</span>, <span class="hljs-title class_">SequelizeStorage</span> &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;umzug&#x27;</span>);<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">runMigrations</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> migrator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Umzug</span>(&#123;<br>    <span class="hljs-attr">migrations</span>: &#123;<br>      <span class="hljs-attr">glob</span>: <span class="hljs-string">&#x27;migrations/*.js&#x27;</span>,<br>    &#125;,<br>    <span class="hljs-attr">storage</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">SequelizeStorage</span>(&#123; sequelize, <span class="hljs-attr">tableName</span>: <span class="hljs-string">&#x27;migrations&#x27;</span> &#125;),<br>    <span class="hljs-attr">context</span>: sequelize.<span class="hljs-title function_">getQueryInterface</span>(),<br>    <span class="hljs-attr">logger</span>: <span class="hljs-variable language_">console</span>,<br>  &#125;);<br>  <span class="hljs-keyword">const</span> migrations = <span class="hljs-keyword">await</span> migrator.<span class="hljs-title function_">up</span>();<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Migrations up to date&#x27;</span>, &#123;<br>    <span class="hljs-attr">files</span>: migrations.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">mig</span>) =&gt;</span> mig.<span class="hljs-property">name</span>),<br>  &#125;);<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">connectToDatabase</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">await</span> sequelize.<span class="hljs-title function_">authenticate</span>();<br>  <span class="hljs-keyword">await</span> <span class="hljs-title function_">runMigrations</span>();<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>对于<strong>多对多</strong>模型，需要用到连接模型：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Membership</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Model</span> &#123;&#125;<br><span class="hljs-title class_">Membership</span>.<span class="hljs-title function_">init</span>(<br>  &#123;<br>    <span class="hljs-attr">id</span>: &#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-title class_">DataTypes</span>.<span class="hljs-property">INTEGER</span>,<br>      <span class="hljs-attr">primaryKey</span>: <span class="hljs-literal">true</span>,<br>      <span class="hljs-attr">autoIncrement</span>: <span class="hljs-literal">true</span>,<br>    &#125;,<br>    <span class="hljs-attr">user_id</span>: &#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-title class_">DataTypes</span>.<span class="hljs-property">INTEGER</span>,<br>      <span class="hljs-attr">allowNull</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-attr">references</span>: &#123; <span class="hljs-attr">model</span>: <span class="hljs-string">&#x27;users&#x27;</span>, <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;id&#x27;</span> &#125;,<br>    &#125;,<br>    <span class="hljs-attr">team_id</span>: &#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-title class_">DataTypes</span>.<span class="hljs-property">INTEGER</span>,<br>      <span class="hljs-attr">allowNull</span>: <span class="hljs-literal">false</span>,<br>      <span class="hljs-attr">references</span>: &#123; <span class="hljs-attr">model</span>: <span class="hljs-string">&#x27;teams&#x27;</span>, <span class="hljs-attr">key</span>: <span class="hljs-string">&#x27;id&#x27;</span> &#125;,<br>    &#125;,<br>  &#125;,<br>  &#123;<br>    sequelize,<br>    <span class="hljs-attr">underscored</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">timestamps</span>: <span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">modelName</span>: <span class="hljs-string">&#x27;membership&#x27;</span>,<br>  &#125;<br>);<br></code></pre></td></tr></table></figure>
<p>然后连接：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">User</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./user&#x27;</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">Team</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./team&#x27;</span>);<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">Membership</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./membership&#x27;</span>);<br><br><span class="hljs-title class_">User</span>.<span class="hljs-title function_">belongsToMany</span>(<span class="hljs-title class_">Team</span>, &#123; <span class="hljs-attr">through</span>: <span class="hljs-title class_">Membership</span> &#125;);<br><span class="hljs-title class_">Team</span>.<span class="hljs-title function_">belongsToMany</span>(<span class="hljs-title class_">User</span>, &#123; <span class="hljs-attr">through</span>: <span class="hljs-title class_">Membership</span> &#125;);<br></code></pre></td></tr></table></figure>
<p>注意到模型和迁移的代码很多部分是重复的，但是代码可能会随着时间改变，而迁移则充当了“记录”的功能，故不可复用数据，只能手动复制</p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%B5%AB%E5%B0%94%E8%BE%9B%E5%9F%BA%E5%A4%A7%E5%AD%A6/">赫尔辛基大学</a><a class="post-meta__tags" href="/tags/web/">web</a></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/13aafbc3.html" title="包管理器"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">包管理器</div></div><div class="info-2"><div class="info-item-1">Python 包管理器——uv uv 是一个用于管理 Python 虚拟环境的工具，特点在于速度快 换源问题，中国人永远的痛；中科大源，中国人永远的神： 在 ~/.config/uv/uv.toml（Linux）或 %APPDATA%\uv\uv.toml（Windows）中添加如下内容： [[index]]    url=&quot;https://mirrors.ustc.edu.cn/pypi/simple&quot; project 管理：  创建新的项目：uv init &lt;project_name&gt; 向项目中添加新的包：uv add &lt;package_name&gt; 移除：uv remove &lt;package_name&gt; 运行某个脚本：uv run path/to/script.py 运行一条命令：uv run &quot;command&quot;  Python 版本管理：  安装指定版本：uv install python 3.8.5 查看可用的版本：uv list python 将当前 project 设置为指定版本：uv...</div></div></div></a><a class="pagination-related" href="/posts/df2849ec.html" title="Java"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/Java.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Java</div></div><div class="info-2"><div class="info-item-1">基于 Bruce Eckel 的 On Java 8 编写 什么是对象 What is an Object? 面向对象编程的特点：  任何东西都是对象 程序是一堆通过发消息告诉彼此的对象（调用对象的方法） 每个对象有由其它对象组成的内存 每个对象都有一个类型（类是一个实例） 一个特定的类型的所有对象可以收到相同的信息  也可以说：对象有声明（内部数据）、表现（方法）和身份（唯一的内存地址） 对象有接口 对象通过方法提供服务 隐藏的实现——封装 重复利用实现——继承 是和像的关系 对象的生命周期——有垃圾收集器 到处都是对象 Objects Everywhere 使用引用操作对象 原始类型，特别的，有“类包装”，如 Character 有方便的数组 注释常见每一行开头有一个 *，尽管是不必要的 有作用域，无需手动销毁对象 创建新的数据类型：class 域中的原始成员数据默认值为 0，但局部变量随机 Java 中防止名称重复的方法是反向使用域名，如域名为 MindviewInc.com 中的 foibles utility 则包名称为...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="iconfont icon-tuijian"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/320cf12b.html" title="全栈公开课（第一部分）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/%E5%85%A8%E6%A0%88%E5%85%AC%E5%BC%80%E8%AF%BE%EF%BC%88%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%89.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-27</div><div class="info-item-2">全栈公开课（第一部分）</div></div><div class="info-2"><div class="info-item-1">Web app 基础 web 开发第一原则：始终打开控制台 可以在控制台查看网络信息 传统 web 应用：获取 html，获取 css，获取 JavaScript html 是树状的结构（DOM） 可以从控制台操作 DOM 接下来是 AJAX Asynchronous JavaScript and XML 时代 React 入门 React 简介 先安装 Node.js 创建应用：npm create vite@latest part1 -- --template react const App = () =&gt; (  &lt;div&gt;    &lt;p&gt;Hello world&lt;/p&gt;  &lt;/div&gt;); .jsx 文件看起来返回的是 HTML 标记，实际上底层转化为了 JavaScript 注意 JSX 的每个标签都必须关闭，即写成 &lt;br /&gt; 使用 props 向组件传递数据 React 组件名称必须大写 React 组件内容需要包含一个根元素，故返回值的最外层通常要加上 &lt;div&gt;&lt;/div&gt;...</div></div></div></a><a class="pagination-related" href="/posts/5dc45f0c.html" title="Jupyter Notebook 学习笔记"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/Jupyter%20Notebook%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-16</div><div class="info-item-2">Jupyter Notebook 学习笔记</div></div><div class="info-2"><div class="info-item-1">什么是 Jupyter Notebook  Jupyter Notebook 是基于网页的用于交互计算的应用程序。其可被应用于全过程计算：开发、文档编写、运行代码和展示结果。——Jupyter Notebook 官方介绍  所以简单来说就是以网页形式打开，可以在其中直接编写并运行代码，代码的运行结果也会直接显示在代码块下，同时说明文档也可以直接编写在下面，支持 markdown增强版博客 组成部分：  网页应用 文档  安装和启动 一般搭配 Anaconda 使用，一般来说安装后已经自动安装了 Jupyter Notebook 了。若没有，可以手动安装： conda install notebook 运行： jupyter notebook 该命令以默认端口（8888）启动，若被占用，则顺延至 8889 等。同时浏览器自动访问该网址 注意：终端不要关闭，否则会断开与本地服务器的连接 当然也可以用 --port xxxx 指定 xxxx 端口启动，也可以添加 --no-browser 参数不打开浏览器 设置 Jupyter Notebook...</div></div></div></a><a class="pagination-related" href="/posts/cc1b9611.html" title="JavaScript"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/JavaScript.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-25</div><div class="info-item-2">JavaScript</div></div><div class="info-2"><div class="info-item-1">写在最前 基于 Marijn Haverbeke 的 Eloquent JavaScript 编写 JavaScript 和 Java 没有任何关系，这个名字是为了蹭 Java 的热度 console.log(&#x27;Hello, world!&#x27;); VSCode 开发环境配置 JavaScript/TypeScript + React 原生支持（毕竟 VS Code 就是用 TypeScript 编写的，所有的扩展都是用 JS 写的，但可以添加一些提高开发效率的代码片段 JavaScript (ES6) code snippets 支持 JS/TS，JSX/TSX，html 等 摘录一些常用的： 导入与导出：    触发方式 功能 示例     imp 导入整个模块 import fs from 'fs';   imn 匿名模块导入 import 'animate.css'   imd 使用解构导入 import &#123;rename&#125; from 'fs';   rqr 需要包 require('');   req 以 const...</div></div></div></a><a class="pagination-related" href="/posts/a541262a.html" title="Spring Boot"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/Spring%20Boot.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-17</div><div class="info-item-2">Spring Boot</div></div><div class="info-2"><div class="info-item-1">Maven Maven 可以用于管理 Java 项目的依赖 在 pom.xml 文件中指定了 Maven 坐标，其构成如下：  groupId：通常是域名反写 artifactId：通常是模块名称 version：版本号  引入依赖：在 &lt;dependencies&gt; 标签下，使用 &lt;dependency&gt; 引入标签，并定义 Maven 坐标 依赖有传递性，可以使用 &lt;exclusion&gt; 手动排除依赖的资源 使用 &lt;scope&gt; 设置其作用范围，通常使用默认的和 &lt;test&gt; Maven 有 3 套独立的生命周期：  clean default：编译、测试、打包、部署等 site：生成报告、发布站点  可以手动执行其中的若干个生命周期 请求与响应 Tomcat 是一个轻量级的 web 服务器，支持 Servlet 规范 几种请求参数： 简单参数：名字一致，也可以使用一个对象接收多个参数 GET...</div></div></div></a><a class="pagination-related" href="/posts/13aafbc3.html" title="包管理器"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-31</div><div class="info-item-2">包管理器</div></div><div class="info-2"><div class="info-item-1">Python 包管理器——uv uv 是一个用于管理 Python 虚拟环境的工具，特点在于速度快 换源问题，中国人永远的痛；中科大源，中国人永远的神： 在 ~/.config/uv/uv.toml（Linux）或 %APPDATA%\uv\uv.toml（Windows）中添加如下内容： [[index]]    url=&quot;https://mirrors.ustc.edu.cn/pypi/simple&quot; project 管理：  创建新的项目：uv init &lt;project_name&gt; 向项目中添加新的包：uv add &lt;package_name&gt; 移除：uv remove &lt;package_name&gt; 运行某个脚本：uv run path/to/script.py 运行一条命令：uv run &quot;command&quot;  Python 版本管理：  安装指定版本：uv install python 3.8.5 查看可用的版本：uv list python 将当前 project 设置为指定版本：uv...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/%E5%A4%B4%E5%83%8F_%E7%81%B0%E5%A4%AA%E7%8B%BC.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Aefrivern</div><div class="author-info-description">我一定会回来的</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">180</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">235</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/aefrivern" rel="external nofollow noreferrer" target="_blank" title="icon-github"><i class="GitHub"></i></a><a class="social-icon" href="mailto:2771503468@qq.com" rel="external nofollow noreferrer" target="_blank" title="icon-youxiang"><i class="QQ邮箱"></i></a><a class="social-icon" href="https://steamcommunity.com/id/old_driver_zero" rel="external nofollow noreferrer" target="_blank" title="icon-steam"><i class="Steam"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><a class="faa-parent animated-hover"><svg class="faa-tada icon" style="height:25px;width:25px;fill:currentColor;position:relative;top:5px" aria-hidden="true"><use xlink:href="#icon-mulu"></use></svg></a><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#React-router%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89-hook%EF%BC%8C%E5%88%A9%E7%94%A8-CSS-%E5%92%8C-webpack-%E7%BB%99-app-%E6%B7%BB%E5%8A%A0%E6%A0%B7%E5%BC%8F"><span class="toc-number">1.</span> <span class="toc-text">React router、自定义 hook，利用 CSS 和 webpack 给 app 添加样式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#React-router"><span class="toc-number">1.1.</span> <span class="toc-text">React-router</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-hooks"><span class="toc-number">1.2.</span> <span class="toc-text">自定义 hooks</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B7%E5%BC%8F%E8%BF%9B%E9%98%B6"><span class="toc-number">1.3.</span> <span class="toc-text">样式进阶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Webpack"><span class="toc-number">1.4.</span> <span class="toc-text">Webpack</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%84%E7%A7%8D%E5%90%84%E6%A0%B7%E7%9A%84-Class-components"><span class="toc-number">1.5.</span> <span class="toc-text">各种各样的 Class components</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GraphQL"><span class="toc-number">2.</span> <span class="toc-text">GraphQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GraphQL-%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">2.1.</span> <span class="toc-text">GraphQL 服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#React-%E4%B8%8E-GraphQL"><span class="toc-number">2.2.</span> <span class="toc-text">React 与 GraphQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%8E%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="toc-number">2.3.</span> <span class="toc-text">数据库与用户管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E4%B8%8E%E6%9B%B4%E6%96%B0%E7%BC%93%E5%AD%98"><span class="toc-number">2.4.</span> <span class="toc-text">登录与更新缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fragments-%E4%B8%8E-subscriptions"><span class="toc-number">2.5.</span> <span class="toc-text">Fragments 与 subscriptions</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TypeScript"><span class="toc-number">3.</span> <span class="toc-text">TypeScript</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E4%B8%8E%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.1.</span> <span class="toc-text">背景与介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TypeScript-%E7%9A%84%E4%B8%80%E5%B0%8F%E6%AD%A5"><span class="toc-number">3.2.</span> <span class="toc-text">TypeScript 的一小步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TypeScript-%E7%89%88%E7%9A%84-express-%E5%BA%94%E7%94%A8"><span class="toc-number">3.3.</span> <span class="toc-text">TypeScript 版的 express 应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8-TypeScript-%E7%BC%96%E5%86%99-React-%E5%BA%94%E7%94%A8"><span class="toc-number">3.4.</span> <span class="toc-text">利用 TypeScript 编写 React 应用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#React-Native"><span class="toc-number">4.</span> <span class="toc-text">React Native</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#React-Native-%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.1.</span> <span class="toc-text">React Native 介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#React-Native-%E5%85%A5%E9%97%A8"><span class="toc-number">4.2.</span> <span class="toc-text">React Native 入门</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8E%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%80%9A%E4%BF%A1"><span class="toc-number">4.3.</span> <span class="toc-text">与服务端通信</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E4%B8%8E%E6%89%A9%E5%B1%95%E6%88%91%E4%BB%AC%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">4.4.</span> <span class="toc-text">测试与扩展我们的应用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CI-CD"><span class="toc-number">5.</span> <span class="toc-text">CI&#x2F;CD</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CI-CD-%E7%AE%80%E4%BB%8B"><span class="toc-number">5.1.</span> <span class="toc-text">CI&#x2F;CD 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%A7%8B%E8%AE%A4%E8%AF%86-GitHub-Actions-%E5%90%A7"><span class="toc-number">5.2.</span> <span class="toc-text">开始认识 GitHub Actions 吧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2"><span class="toc-number">5.3.</span> <span class="toc-text">部署</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%9D%E6%8C%81%E5%81%A5%E5%BA%B7%E7%8A%B6%E6%80%81"><span class="toc-number">5.4.</span> <span class="toc-text">保持健康状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%8D%E6%89%A9%E5%B1%95%E4%B8%80%E4%B8%8B"><span class="toc-number">5.5.</span> <span class="toc-text">再扩展一下</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8"><span class="toc-number">6.</span> <span class="toc-text">容器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E4%BB%8B%E7%BB%8D"><span class="toc-number">6.1.</span> <span class="toc-text">容器介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83"><span class="toc-number">6.2.</span> <span class="toc-text">构建配置环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E6%8E%92%E5%9F%BA%E7%A1%80"><span class="toc-number">6.3.</span> <span class="toc-text">编排基础</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">7.</span> <span class="toc-text">使用关系型数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8-Sequelize-%E4%BD%BF%E7%94%A8%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">7.1.</span> <span class="toc-text">用 Sequelize 使用关系型数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E5%85%A5%E8%A1%A8%E4%B8%8E%E6%9F%A5%E8%AF%A2"><span class="toc-number">7.2.</span> <span class="toc-text">加入表与查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%81%E7%A7%BB%EF%BC%8C%E5%A4%9A%E5%AF%B9%E5%A4%9A%E5%85%B3%E7%B3%BB"><span class="toc-number">7.3.</span> <span class="toc-text">迁移，多对多关系</span></a></li></ol></li></ol></div></div><div class="card-widget card-post-series"><div class="item-headline"><svg class="meta_icon post-ui-icon" style="width:25px;height:25px;position:relative;top:5px"><use xlink:href="#icon-a-layergroup"></use></svg><span>系列文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/e5d89884.html" title="全栈公开课（第二部分）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/%E5%85%A8%E6%A0%88%E5%85%AC%E5%BC%80%E8%AF%BE%EF%BC%88%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%EF%BC%89.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="全栈公开课（第二部分）"></a><div class="content"><a class="title" href="/posts/e5d89884.html" title="全栈公开课（第二部分）">全栈公开课（第二部分）</a><time datetime="2024-01-03T00:17:22.000Z" title="发表于 2024-01-03 08:17:22">2024-01-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/320cf12b.html" title="全栈公开课（第一部分）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/%E5%85%A8%E6%A0%88%E5%85%AC%E5%BC%80%E8%AF%BE%EF%BC%88%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%89.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="全栈公开课（第一部分）"></a><div class="content"><a class="title" href="/posts/320cf12b.html" title="全栈公开课（第一部分）">全栈公开课（第一部分）</a><time datetime="2023-12-27T00:17:22.000Z" title="发表于 2023-12-27 08:17:22">2023-12-27</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="ft"><div class="ft-item-1"><div class="t-top"><div class="t-t-l"><p class="ft-t t-l-t">格言🧬</p><div class="bg-ad"><div>安得广厦千万间，大庇天下寒士俱欢颜，风雨不动安如山。</div></div></div><div class="t-t-r"><p class="ft-t t-l-t">猜你想看💡</p><ul class="ft-links"><li><a href="/comments/">留点什么</a><a href="/random/">随便逛逛</a></li><li><a href="/about/">关于</a><a href="/archives/">文章归档</a></li><li><a href="/categories/">文章分类</a><a href="/tags/">文章标签</a></li><li><a href="/gallery/">我的画廊</a><a href="/charts/">网站统计</a></li></ul></div></div></div></div><div class="copyright">&copy;2022 - 2025 By Aefrivern</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"></div><script async src="//at.alicdn.com/t/c/font_4031045_1yiosqv4vch.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#web_bg",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      window.location.href = e.request.responseURL
    }
  })
})()</script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/lite/builds/browser.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script></div></div><!-- hexo injector body_end start --><script async src="//at.alicdn.com/t/c/font_4031045_izvon5l4fr8.js"></script><!-- hexo injector body_end end --></body></html>