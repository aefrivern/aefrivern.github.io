<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Stanford CS144：计算机网络导论 | Aefrivern的小屋</title><meta name="author" content="Aefrivern"><meta name="copyright" content="Aefrivern"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Internet 和 IP 简介 应用的一天生活 网络应用：通过网络读写数据 模型：双向、可靠的字节数据流连接 connection  一边读，一边写 可靠 双向操作   万维网（HTTP）就是一个服务器-客户端模型：  比特流 BitTorrent 是多客户端之间的连接：  Skype 有两个客户端，方法较多，分为三种情况：    Internet 四层模型  链路层 link：  一次通过一个">
<meta property="og:type" content="article">
<meta property="og:title" content="Stanford CS144：计算机网络导论">
<meta property="og:url" content="https://aefrivern.github.io/posts/447a8d68.html">
<meta property="og:site_name" content="Aefrivern的小屋">
<meta property="og:description" content="Internet 和 IP 简介 应用的一天生活 网络应用：通过网络读写数据 模型：双向、可靠的字节数据流连接 connection  一边读，一边写 可靠 双向操作   万维网（HTTP）就是一个服务器-客户端模型：  比特流 BitTorrent 是多客户端之间的连接：  Skype 有两个客户端，方法较多，分为三种情况：    Internet 四层模型  链路层 link：  一次通过一个">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://aefrivern.github.io/gallery/cover/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA.webp">
<meta property="article:published_time" content="2023-12-10T00:17:22.000Z">
<meta property="article:modified_time" content="2024-11-23T06:43:58.000Z">
<meta property="article:author" content="Aefrivern">
<meta property="article:tag" content="Stanford">
<meta property="article:tag" content="计算机网络">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://aefrivern.github.io/gallery/cover/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA.webp"><link rel="shortcut icon" href="/illustration/favicon.ico"><link rel="canonical" href="https://aefrivern.github.io/posts/447a8d68.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"GY5EJYJ1FS","apiKey":"c443c952672ec7062840aac45536181e","indexName":"blog","hitsPerPage":6,"languages":{"input_placeholder":"搜索文章","hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，耗时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Stanford CS144：计算机网络导论',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><link rel="stylesheet" href="//at.alicdn.com/t/c/font_4031045_1yiosqv4vch.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/highlight.css"><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/hexo-butterfly-article-double-row.css"><script src="/js/echarts.min.js"></script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(/gallery/wallpaper/wallpaper.webp);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/%E5%A4%B4%E5%83%8F_%E7%81%B0%E5%A4%AA%E7%8B%BC.webp" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">170</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">226</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-shouye-01"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw iconfont icon-guidang"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw iconfont icon-a-16-01-01"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw iconfont icon-wenjianjia"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/anime/"><i class="fa-fw iconfont icon-zhifeiji"></i><span> 二次元</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw iconfont icon-xiangce"></i><span> 画廊</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-guanyu"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/charts/"><i class="fa-fw iconfont icon-tongjichaxun"></i><span> 统计</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw iconfont icon-liuyan"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/random/"><i class="fa-fw iconfont icon-suiji"></i><span> 随便逛逛</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/gallery/cover/Stanford CS144：计算机网络导论.webp);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Aefrivern的小屋</span></a><a class="nav-page-title" href="/"><span class="site-name">Stanford CS144：计算机网络导论</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><svg class="meta_icon post-ui-icon" style="width:16px;height:16px;position:relative;top:3px"><use xlink:href="#icon-sousuo1"></use></svg><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-shouye-01"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw iconfont icon-guidang"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw iconfont icon-a-16-01-01"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw iconfont icon-wenjianjia"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/anime/"><i class="fa-fw iconfont icon-zhifeiji"></i><span> 二次元</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw iconfont icon-xiangce"></i><span> 画廊</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-guanyu"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/charts/"><i class="fa-fw iconfont icon-tongjichaxun"></i><span> 统计</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw iconfont icon-liuyan"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/random/"><i class="fa-fw iconfont icon-suiji"></i><span> 随便逛逛</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Stanford CS144：计算机网络导论</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><svg class="meta_icon post-ui-icon" style="width:16px;height:16px;position:relative;top:3px"><use xlink:href="#icon-rili"></use></svg><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-12-10T00:17:22.000Z" title="发表于 2023-12-10 08:17:22">2023-12-10</time><span class="post-meta-separator">|</span><svg class="meta_icon post-ui-icon" style="width:13px;height:13px;position:relative;top:2px"><use xlink:href="#icon-gengxin"></use></svg><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-11-23T06:43:58.000Z" title="更新于 2024-11-23 14:43:58">2024-11-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><a class="faa-parent animated-hover"></a><svg class="meta_icon post-ui-icon" style="width:13px;height:13px;position:relative;top:2px"><use xlink:href="#icon-fenlei"></use></svg><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><svg class="meta_icon post-ui-icon" style="width:16px;height:16px;position:relative;top:3px"><use xlink:href="#icon-word"></use></svg><span class="post-meta-label">总字数:</span><span class="word-count">9056</span><span class="post-meta-separator">|</span><svg class="meta_icon post-ui-icon" style="width:16px;height:16px;position:relative;top:3px"><use xlink:href="#icon-shizhong"></use></svg><span class="post-meta-label">阅读时长:</span><span>30分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="Internet-和-IP-简介">Internet 和 IP 简介</h2>
<h3 id="应用的一天生活">应用的一天生活</h3>
<p>网络应用：通过网络读写数据</p>
<p>模型：双向、可靠的字节数据流<strong>连接 connection</strong></p>
<ul>
<li>一边读，一边写</li>
<li>可靠</li>
<li>双向操作</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E5%AD%97%E8%8A%82%E6%B5%81%E6%A8%A1%E5%9E%8B.webp" alt="字节流模型"></p>
<p>万维网（HTTP）就是一个服务器-客户端模型：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E4%B8%87%E7%BB%B4%E7%BD%91.webp" alt="万维网"></p>
<p><strong>比特流 BitTorrent</strong> 是多客户端之间的连接：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E6%AF%94%E7%89%B9%E6%B5%81.webp" alt="比特流"></p>
<p>Skype 有两个客户端，方法较多，分为三种情况：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/Skype.webp" alt="Skype"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E5%A4%8D%E6%9D%82%E7%9A%84Skype.webp" alt="复杂的Skype"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E6%9B%B4%E5%A4%8D%E6%9D%82%E7%9A%84Skype.webp" alt="更复杂的Skype"></p>
<h3 id="Internet-四层模型">Internet 四层模型</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/Internet%20%E5%9B%9B%E5%B1%82%E6%A8%A1%E5%9E%8B.webp" alt="Internet 四层模型"></p>
<p><strong>链路层 link</strong>：</p>
<ul>
<li>一次通过一个链路传递数据</li>
<li><strong>以太网 Ethernet</strong>，<strong>WIFI</strong> 等就是属于这一层</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E9%93%BE%E8%B7%AF%E5%B1%82.webp" alt="链路层"></p>
<p><strong>网络层 network</strong>：其数据包称为<strong>数据报 datagram</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E7%BD%91%E7%BB%9C%E5%B1%82.webp" alt="网络层"></p>
<p>注意到从网络层的角度看，其是在与另一个网络层通信，却不关心这是通过链路层实现的</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E7%BD%91%E7%BB%9C%E5%B1%82%E9%80%9A%E4%BF%A1.webp" alt="网络层通信"></p>
<p>网络层</p>
<ul>
<li>尽可能传递数据报</li>
<li>但有可能丢失</li>
<li><strong>只</strong>有 <strong>Internet Protocol（IP）</strong></li>
</ul>
<p><strong>传输层 Transport</strong>：</p>
<ul>
<li>保证端到端的正确、顺序的数据传递</li>
<li>控制阻塞</li>
<li>包括 TCP，UDP 等</li>
</ul>
<p><strong>应用层 Application</strong>：</p>
<ul>
<li>两个应用间双向可靠的字节流</li>
<li>HTTP 等</li>
</ul>
<p>可以注意到，只有网络层中只有 IP 一种方法，故 IP 被称为 <strong>thin waist</strong></p>
<p><strong>国际标准化组织 International Standards Organization(ISO)</strong> 制定了<strong>开放式通信系统互联参考模型 Open System Interconnection（OSI）</strong>，即 <strong>ISO/OSI</strong>，这个模型有 7 层，但 Internet 在实现时合并了其中的几层，故只有 4 层（或 5 层）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/OSI%207%E5%B1%82%E6%A8%A1%E5%9E%8B.webp" alt="OSI 7层模型"></p>
<h3 id="IP-服务模型">IP 服务模型</h3>
<p>将传输段作为数据包中的数据，并附上头，然后传递给链路层：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/IP.webp" alt="IP"></p>
<p>特点：</p>
<ul>
<li>数据报：独立的路由包，hop-by-hop 路由</li>
<li>不可靠：可能丢包</li>
<li>努力：只有必要时才会丢包</li>
<li>无连接：到达可能是无序的</li>
</ul>
<p>简单：</p>
<ul>
<li>构建和维护的成本低</li>
<li>端到端原则：尽可能在终端实现特性</li>
<li>允许上层服务</li>
<li>对下层的假设少</li>
</ul>
<p>细节：</p>
<ul>
<li>使用**生存时间 Time To Live（TTL）**字段防止包永远循环</li>
<li>如果包太大，则会分裂包</li>
<li>使用检验和减少传递到错误地点的可能性</li>
<li>IPv4 &amp; IPv6</li>
<li>运行新功能添加到包头中</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/IPv4%E6%95%B0%E6%8D%AE%E5%8C%85.webp" alt="IPv4数据包"></p>
<h3 id="包的一天">包的一天</h3>
<p><strong>传输控制协议 Transmission Control Protocol (TCP) 字节流：</strong></p>
<p><strong>三次握手 3-way handshake：</strong></p>
<ul>
<li><strong>syn</strong>：客户端对服务器同步信息</li>
<li><strong>syn/ack</strong>：同步消息的服务器响应同时确认客户端的同步</li>
<li><strong>ack</strong>：客户端确认服务做出响应</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.webp" alt="三次握手"></p>
<p>建立连接需要 IP 地址和 TCP 端口</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/IP%E5%9C%B0%E5%9D%80%E4%B8%8ETCP%E7%AB%AF%E5%8F%A3.webp" alt="IP地址与TCP端口"></p>
<p>在流的内部通过 hop 在一个一个路由之间传递：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E6%B5%81%E5%86%85%E9%83%A8.webp" alt="流内部"></p>
<p>在每个 hop 的内部，路由器通过<strong>转发表 forwarding table</strong> 选择要使用哪个链路</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/hop%E5%86%85%E9%83%A8.webp" alt="hop内部"></p>
<h3 id="包交换原则">包交换原则</h3>
<p><strong>包 packet</strong>：自我包含的数据单元，载着到达目的地的必要信息</p>
<p><strong>包交换 packet switching</strong>：独立地为每个抵达的包选择其传出链路，如果链路空闲，则发送；否则保持，并等待</p>
<p>结果：</p>
<ul>
<li>包转发更简单</li>
<li>有效共享链接</li>
</ul>
<p><strong>流 flow</strong>：属于相同端到端通信的数据报集合</p>
<ul>
<li>包交换不需要每个流的状态，包自我包含</li>
<li>无需添加/移除/储存每个流的状态</li>
</ul>
<p>数据交通是<strong>突发的 burst</strong></p>
<ul>
<li>单一资源在多个用户之间共享的想法叫<strong>统计复用 statistical multiplexing</strong></li>
</ul>
<h3 id="分层原则">分层原则</h3>
<ul>
<li><strong>层 layer</strong> 是功能单元</li>
<li>每层向上层提供定义好的服务</li>
<li>层顺序通过下层通信</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E5%B1%82.webp" alt="层"></p>
<p>理由：</p>
<ul>
<li>模块化</li>
<li>定义明确的服务</li>
<li>复用</li>
<li>分离关注</li>
<li>连续提高</li>
<li>点对点通信</li>
</ul>
<h3 id="封装">封装</h3>
<p>两种画法：头在左边，头在右边</p>
<p>简单来说就是层层套娃</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E4%BD%BF%E7%94%A8VPN%E7%9A%84%E5%B0%81%E8%A3%85.webp" alt="使用VPN的封装"></p>
<h3 id="字节序">字节序</h3>
<p>小端：x86，arm</p>
<p>大端：Internet</p>
<p>所以在处理时需要小心，使用 <code>ntohs()</code> 等转换</p>
<h3 id="IPv4-地址">IPv4 地址</h3>
<p>32 bit：a.b.c.d</p>
<p><strong>子网掩码 netmask</strong>：使用这个 mask，如果匹配，则在相同网络内</p>
<p>最初的层级：网络 network + 主机 host</p>
<p>最初有 3 类地址：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/3%E7%B1%BBIP%E5%9C%B0%E5%9D%80.webp" alt="3类IP地址"></p>
<p>但这种分法太粗糙了，故有了<strong>无类别域间路由 Classless Inter-Domain Routing(CIDR)</strong></p>
<ul>
<li>地址块是一对：地址，计数 count</li>
<li>count 是 2 的幂次，表示子网掩码长度</li>
<li>171.64.0.0/16 表示 171.64.0.0 - 171.64.255.255 地址范围</li>
</ul>
<p><strong>互联网号码分配局 Internet Assigned Numbers Authority（IANA）</strong> 分发 /8s 给<strong>地区性互联网注册管理机构 Regional Internet Registries(RIR)</strong>，则已经用完了</p>
<h3 id="最长前缀匹配">最长前缀匹配</h3>
<p>转发表是 CIDR 项集合，使用最长前缀匹配的项转发</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/hop%E5%86%85%E9%83%A8%E7%9A%84%E7%9C%9F%E5%AE%9E%E7%BB%93%E6%9E%84.webp" alt="hop内部的真实结构"></p>
<h3 id="地址解析协议">地址解析协议</h3>
<p><strong>地址解析协议 Address Resolution Protocol(ARP)</strong>：网络层使用这个来发现与其直接连接的网络地址关联的链接地址</p>
<p>链接地址描述特定的网卡，辨识设备</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/ARP.webp" alt="ARP"></p>
<p>ARP</p>
<ul>
<li>生成层级 2 和 3 的地址值</li>
<li>简单的请求-回复协议
<ul>
<li>请求发送到链接层网络地址</li>
<li>回复发送请求地址</li>
</ul>
</li>
<li>包头包括冗余数据</li>
<li>状态不会共享</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/ARP%E5%8C%85.webp" alt="ARP包"></p>
<h2 id="运输层">运输层</h2>
<h3 id="TCP-服务模型">TCP 服务模型</h3>
<ul>
<li>接受来自应用层字节流，封装到 TCP 段的数据中，发送给网络层</li>
<li>TCP 对等通信</li>
<li>通过三次握手建立连接</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/TCP%E6%AE%B5.webp" alt="TCP段"></p>
<p>连接关闭：四次挥手</p>
<ul>
<li>A 发送 Fin 消息表示自己不发送数据了</li>
<li>B 确认 A 不再有发送的数据，但仍可以向 A 发送数据，即关闭了 A 到 B 的数据流</li>
<li>B 发送 Fin 给 A</li>
<li>A 确认</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B.webp" alt="四次挥手"></p>
<p>特点：</p>
<ul>
<li>字节流</li>
<li>可靠的传递：
<ul>
<li>确认表示正确接受</li>
<li>校验和检测污染的数据</li>
<li>序列号检测丢失的数据</li>
<li>流量控制防止接受者超速运行</li>
</ul>
</li>
<li>顺序</li>
<li>阻塞控制</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/TCP%E6%AE%B5%E6%A0%BC%E5%BC%8F.webp" alt="TCP段格式"></p>
<p>TCP 端口和 IP 头共同形成一个唯一的 TCP ID</p>
<ul>
<li>主机 A 为每个连接增加原端口</li>
<li>TCP 选择随机的 ISN（起始序列号）来防止和之前的连接有相同的 ID</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/TCP%E8%BF%9E%E6%8E%A5%E7%9A%84%E5%94%AF%E4%B8%80ID.webp" alt="TCP连接的唯一ID"></p>
<p>TCP 端口解复用</p>
<h3 id="UDP-服务模型">UDP 服务模型</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/UDP%E6%95%B0%E6%8D%AE%E5%8C%85%E6%A0%BC%E5%BC%8F.webp" alt="UDP数据包格式"></p>
<p>注意校验和中包括了 IP 地址，这违反了层的分离，为了检测目的地是否正确</p>
<p>UDP 也是端口解复用的，故有人称其为<strong>用户多路复用协议 User Demultiplexing Protocol</strong></p>
<p>特点：</p>
<ul>
<li>无连接：包无序</li>
<li>自我包括</li>
<li>不可靠传递：
<ul>
<li>无确认</li>
<li>无检测丢包或乱包的机制</li>
<li>无流控制</li>
</ul>
</li>
</ul>
<h3 id="ICMP-服务模型">ICMP 服务模型</h3>
<p>网络层工作：</p>
<ul>
<li>IP</li>
<li>路由表</li>
<li>ICMP</li>
</ul>
<p><strong>因特网控制消息协议 Internet Control Message Protocol(ICMP)</strong>：报告错误信息，帮助检测问题</p>
<p>ICMP 在网络层之上工作：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/ICMP%E5%B1%82%E7%BA%A7.webp" alt="ICMP层级"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/ICMP%E4%BE%8B%E5%AD%90.webp" alt="ICMP例子"></p>
<p>特点：</p>
<ul>
<li>报告消息：自我包含 消息报告错误</li>
<li>不可靠</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/ICMP%E6%A0%BC%E5%BC%8F.webp" alt="ICMP格式"></p>
<p>一些 ICMP 消息类型：</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>代码</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0</td>
<td>echo 回复</td>
</tr>
<tr>
<td>3</td>
<td>0</td>
<td>目的网络不可达</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>目的主机不可达</td>
</tr>
<tr>
<td>3</td>
<td>3</td>
<td>目的端口不可达</td>
</tr>
<tr>
<td>8</td>
<td>0</td>
<td>echo 回应</td>
</tr>
<tr>
<td>11</td>
<td>0</td>
<td>TTL 过期</td>
</tr>
</tbody>
</table>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/ping%E4%B8%8EICMP.webp" alt="ping与ICMP"></p>
<p>对于 traceroute，分别发送 TTL 为 0，1 … 的包，路由器会返回 TTL 过期的消息，即可直到每一站的路由地址等信息</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/traceroute%E4%B8%8EICMP.webp" alt="traceroute与ICMP"></p>
<h3 id="端到端原则">端到端原则</h3>
<p>网络可以做很多事情来提供<strong>帮助</strong>，有助于<strong>提高</strong>效率等，但是想要<strong>保证正确</strong>，必须在端到端实现</p>
<p><strong>强端到端 strong end-to-end</strong>：网络的工作在于尽可能地高效和灵活地传递数据报，其余的事情应该在边缘实现，否则整个系统会越来越复杂</p>
<h3 id="错误检测">错误检测</h3>
<p>检验和(IP,TCP,UDP)：</p>
<ul>
<li>对包中所有 16 bit 字求和</li>
<li>简单，快速</li>
<li>只能<strong>保证检测一个位</strong>的错误</li>
</ul>
<p><strong>循环冗余校验码 Cyclic Redundancy Check (CRC)</strong>：链路层</p>
<ul>
<li>把 n bit 的数据拆卸成 c bit，c &lt;&lt; n</li>
</ul>
<p>可以检测：</p>
<ul>
<li>奇数个数的 bit 错误</li>
<li>2 bit 的错误</li>
<li>&lt;= c bit 的一个突发错误</li>
</ul>
<p><strong>消息认证码 Message Authentication Code(MAC)</strong>：</p>
<ul>
<li>当字节翻转时，有<strong>很大概率</strong>会有变化，而不能<strong>保证</strong>检测出任何一个错误</li>
<li>所以通常用于保护信息被恶意篡改，而不是检测错误</li>
</ul>
<h3 id="有限状态机">有限状态机</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/TCP%20Connect$20%E7%8A%B6%E6%80%81%E6%9C%BA.webp" alt="TCP Connect状态机"></p>
<h3 id="流控制">流控制</h3>
<p>不能比接受者能够处理的速度还要快地发送包</p>
<p><strong>停止并等待 stop and wait：</strong></p>
<ul>
<li>任何时候最多一个包在飞行中</li>
<li>发送者发送一个包</li>
<li>接收者收到包时发送确认包</li>
<li>收到确认包时，发送者发送新的包</li>
<li>超时时，发送者重新发送当前包</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E5%81%9C%E6%AD%A2%E5%B9%B6%E7%AD%89%E5%BE%85%E7%8A%B6%E6%80%81%E6%9C%BA.webp" alt="停止并等待状态机"></p>
<p>注意到如果接收者发送了确认，但是速度较慢，发送方认为超时了，又重新发送，然后又收到了之前的确认，就会出问题，故需要序列号标识确认的是哪个包</p>
<p><strong>滑动窗口 sliding window：</strong></p>
<ul>
<li>一次发送多个包</li>
</ul>
<p>发送者：</p>
<ul>
<li>每个段都有一个序列化</li>
<li>发送窗口大小 SWS</li>
<li>最后确认收到 LAR</li>
<li>最后发送的段 LSS</li>
<li>维护不变量 LSS - LAR &lt;= SWS</li>
<li>当收到新的确认时，前进 LAR</li>
<li>缓冲最多 SWS 段</li>
</ul>
<p>接受者：</p>
<ul>
<li>接受窗口大小 RWS</li>
<li>最后确认的段 LAS</li>
<li>最后收到的段 LSR</li>
<li>维护不变量 LAS - LSR &lt;= RWS</li>
<li>如果接受的包 &lt; LAS，则发送确认
<ul>
<li>发送的是<strong>累积</strong>确认</li>
</ul>
</li>
</ul>
<p>RWS, SWS, 序列空间：</p>
<ul>
<li>需要 RWS + SWS 个序列号</li>
</ul>
<p>TCP 流控制：</p>
<ul>
<li>接收者使用 window 域广告 RWS</li>
<li>发送者只发送最多 LAR + window 的数据</li>
</ul>
<h3 id="重传策略">重传策略</h3>
<p>返回 N：一个丢失导致整个窗口重传</p>
<p>选择性重复：一个丢失只重传那个包</p>
<h3 id="连接建立与拆除">连接建立与拆除</h3>
<p>注意 syn 同步的就是序列号，尽管其没有数据，却会导致序列号 +1</p>
<p>如果双方同时发送，则是四次握手</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B(2).webp" alt="三次握手"></p>
<p>同样的，在拆除连接时，fin 也会使序列号 +1</p>
<p>为了防止忘记了最后的信息，故会<strong>等待一定时间</strong>再关闭</p>
<h2 id="包交换">包交换</h2>
<h3 id="历史">历史</h3>
<p>通信中的五个概念：</p>
<ul>
<li>编码</li>
<li>流控制</li>
<li>同步</li>
<li>纠错和重传</li>
<li>加密</li>
</ul>
<p>发明的四个阶段：</p>
<ul>
<li>预先定义好的信息</li>
<li>传输任意信息</li>
<li>常用字词使用数字编码压缩</li>
<li>控制信号</li>
</ul>
<h3 id="端到端延迟和传播延迟">端到端延迟和传播延迟</h3>
<p><strong>传播延迟</strong>：一个 bit 以传播速度 c 沿链接传播的时间</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E4%BC%A0%E6%92%AD%E5%BB%B6%E8%BF%9F.webp" alt="传播延迟"></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>t</mi><mi>l</mi></msub><mo>=</mo><mfrac><mi>l</mi><mi>c</mi></mfrac></mrow><annotation encoding="application/x-tex">t_l = \frac lc
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.76508em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">c</span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p><strong>封包组装延迟</strong>：一个包的第一个 bit 到最后一个 bit 传输所用时间</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E5%88%86%E5%8C%85%E7%BB%84%E8%A3%85%E5%BB%B6%E8%BF%9F.webp" alt="分包组装延迟"></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>t</mi><mi>p</mi></msub><mo>=</mo><mfrac><mi>p</mi><mi>r</mi></mfrac></mrow><annotation encoding="application/x-tex">t_p = \frac pr
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9011879999999999em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.7935599999999998em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1075599999999999em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal">p</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>但是在路由器中还有排队延迟，故<strong>端到端延迟</strong></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>t</mi><mo>=</mo><munder><mo>∑</mo><mi>i</mi></munder><mo stretchy="false">(</mo><mfrac><mi>p</mi><msub><mi>r</mi><mi>i</mi></msub></mfrac><mo>+</mo><mfrac><msub><mi>l</mi><mi>i</mi></msub><mi>c</mi></mfrac><mo>+</mo><msub><mi>Q</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">t = \sum_i (\frac{p}{r_i} + \frac{l_i}{c} + Q_i(t))
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.385229em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0500050000000003em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1075599999999999em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">c</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></p>
<p>注意到排队延迟是唯一具有变量的延迟，却导致了端到端延迟的变化，一般经过的路由器越多，方差越大</p>
<h3 id="播放缓冲">播放缓冲</h3>
<p>实时应用程序使用播放缓冲来吸收排队延迟的变化</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E6%92%AD%E6%94%BE%E7%BC%93%E5%86%B2.webp" alt="播放缓冲"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E6%92%AD%E6%94%BE%E7%BC%93%E5%86%B22.webp" alt="播放缓冲2"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E6%92%AD%E6%94%BE%E7%BC%93%E5%86%B2%E5%A4%AA%E5%B0%8F.webp" alt="播放缓冲太小"></p>
<h3 id="简单确定性排队模型">简单确定性排队模型</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E7%AE%80%E5%8D%95%E6%8E%92%E9%98%9F%E6%A8%A1%E5%9E%8B.webp" alt="简单排队模型"></p>
<p>画成折线图，竖直代表队列长度 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Q(t)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">)</span></span></span></span>，水平代表延迟 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d(t)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">)</span></span></span></span></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E7%AE%80%E5%8D%95%E9%98%9F%E5%88%97%E6%A8%A1%E5%9E%8B.webp" alt="简单队列模型"></p>
<p>更小的包使用了流水线从而减少延迟：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E5%88%86%E6%88%90%E5%B0%8F%E5%8C%85%E7%9A%84%E5%BB%B6%E8%BF%9F.webp" alt="分成小包的延迟"></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>t</mi><mo>=</mo><munder><mo>∑</mo><mi>i</mi></munder><mo stretchy="false">(</mo><mfrac><mi>p</mi><msub><mi>r</mi><mi>i</mi></msub></mfrac><mo>+</mo><mfrac><msub><mi>l</mi><mi>i</mi></msub><mi>c</mi></mfrac><mo stretchy="false">)</mo><mo>+</mo><mfrac><mi>M</mi><mrow><mi>p</mi><mo>−</mo><mn>1</mn></mrow></mfrac><mo>∗</mo><mfrac><mi>p</mi><msub><mi>r</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub></mfrac></mrow><annotation encoding="application/x-tex">t = \sum_i (\frac{p}{r_i} + \frac{l_i}{c}) + \frac{M}{p-1} * \frac{p}{r_{min}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.385229em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0500050000000003em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1075599999999999em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.05744em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">c</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.01968em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.2407700000000004em;vertical-align:-0.8804400000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.94356em;vertical-align:-0.8360000000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1075599999999999em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>统计复用意味着出口链路不需要运行在 NR 的速率，因为 buffer 会吸收超出 R 的速率，但是因为 buffer 是有限的，所以一定会有丢失</p>
<p>统计复用增益：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E7%BB%9F%E8%AE%A1%E5%A4%8D%E7%94%A8%E5%A2%9E%E7%9B%8A.webp" alt="统计复用增益"></p>
<p>有两种表示方法：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>gain</mtext><mo>=</mo><mn>2</mn><mi>C</mi><mi mathvariant="normal">/</mi><mi>R</mi></mrow><annotation encoding="application/x-tex">\text{gain} = 2C/R
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord text"><span class="mord">gain</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span></span></p>
<p>其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span> 可以是顶峰，也可以是恰好填充满时的速率</p>
<h3 id="排队模型属性">排队模型属性</h3>
<p>详见排队论，这里只需记住几个性质</p>
<p>突发增加了延迟</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E7%AA%81%E5%8F%91%E5%A2%9E%E5%8A%A0%E5%BB%B6%E8%BF%9F.webp" alt="突发增加延迟"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E7%AA%81%E5%8F%91%E5%A2%9E%E5%8A%A0%E5%BB%B6%E8%BF%9F2.webp" alt="突发增加延迟2"></p>
<p>一般来说，确定性最小化延迟</p>
<p>里特尔结果：如果没有丢失或抛弃，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mo>=</mo><mi>λ</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">L = λ d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">d</span></span></span></span>，其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi></mrow><annotation encoding="application/x-tex">\lambda</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">λ</span></span></span></span> 为抵达速度，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">L</span></span></span></span> 为平均队列长度，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">d</span></span></span></span> 为平均延迟</p>
<p>泊松过程：经过包抵达不是泊松过程，但是这个模型很好</p>
<p>M/M/1 队列：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>d</mi><mo>=</mo><mfrac><mn>1</mn><mrow><mi>μ</mi><mo>−</mo><mi>λ</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">d = \frac{1}{\mu - \lambda}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.20188em;vertical-align:-0.8804400000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">λ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<h3 id="交换和转发">交换和转发</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E5%8C%85%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%BB%93%E6%9E%84.webp" alt="包交换机结构"></p>
<p><strong>以太网交换机 Ethernet Switch</strong>：</p>
<ul>
<li>检查每个到达的框架的头</li>
<li>如果以太网目标地址在转发表中，则转发到正确的端口</li>
<li>如果不在，则向所有端口广播（除了来的端口）</li>
<li>表中的项通过检查到达包的源地址学习</li>
</ul>
<p><strong>因特网路由器 Internet Router</strong>：</p>
<ul>
<li>如果以太网目标地址属于这个路由器，则接受栈帧</li>
<li>检查 IP 版本号和数据包长度</li>
<li>减少 TTL，更新校验和</li>
<li>检查 TTL == 0？</li>
<li>如果目标 IP 地址在转发表中，则转发到下一个 hop 的正确出口端口</li>
<li>找到下一个 hop 路由器的以太网目标地址</li>
<li>创建新的以太网框架并发送</li>
</ul>
<p>基本操作：<strong>查找地址</strong>和<strong>交换</strong></p>
<p>以太网查找地址：用 hash 表存储地址，找到精确匹配</p>
<p>IP 地址查找使用最长前缀匹配，有 trie 实现和 TCAM 实现，后者并行比较，速度快但是成本高</p>
<p>通用查询地址：<code>&lt;Match, Action&gt;</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E8%BE%93%E5%87%BA%E6%8E%92%E9%98%9F%E7%9A%84%E5%8C%85%E4%BA%A4%E6%8D%A2%E6%9C%BA.webp" alt="输出排队的包交换机"></p>
<p>注意到输出排队的包交换机不可伸缩，如果把队列移动到输入端，则内存速度要求明显下降</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E8%BE%93%E5%85%A5%E6%8E%92%E9%98%9F%E7%9A%84%E5%8C%85%E4%BA%A4%E6%8D%A2%E6%9C%BA.webp" alt="输入排队的包交换机"></p>
<p>对于每个队列，尽管有的有黑色，但是每行的头都是橙色，故只能等待</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E8%A1%8C%E9%A6%96%E9%98%BB%E5%A1%9E.webp" alt="行首阻塞"></p>
<p>可以通过虚拟输出队列实现，即在输入队列中做好分类</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E8%99%9A%E6%8B%9F%E8%BE%93%E5%87%BA%E9%98%9F%E5%88%97.webp" alt="虚拟输出队列"></p>
<p>输出排队：</p>
<ul>
<li>工作节约</li>
<li>吞吐量最大化</li>
<li>期望延迟最小</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E8%99%9A%E6%8B%9F%E8%BE%93%E5%87%BA%E7%9A%84%E8%BE%93%E5%85%A5%E9%98%9F%E5%88%97.webp" alt="三种队列的比较"></p>
<p>虚拟输出队列相当于十字路口的车道</p>
<h3 id="比率保证">比率保证</h3>
<p>因为队列是 FIFO 的，故偏向于流量大的数据，这鼓励了恶性竞争</p>
<p>严格优先：通常用于控制信号</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E4%B8%A5%E6%A0%BC%E4%BC%98%E5%85%88.webp" alt="严格优先"></p>
<p>加权优先：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E5%8A%A0%E6%9D%83%E4%BC%98%E5%85%88.webp" alt="加权优先"></p>
<p>在具体实现中，包的开始时间 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">s_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和结束时间 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">F_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 有递归关系</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>F</mi><mi>k</mi></msub><mo>=</mo><msub><mi>S</mi><mi>k</mi></msub><mo>+</mo><mfrac><mi>L</mi><msub><mi>W</mi><mn>1</mn></msub></mfrac></mrow><annotation encoding="application/x-tex">F_k = S_k + \frac{L}{W_1}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.19633em;vertical-align:-0.8360000000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.3139999999999996em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8360000000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>S</mi><mi>k</mi></msub><mo>=</mo><mi>max</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>F</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mi>n</mi><mi>o</mi><mi>w</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S_k = \max (F_{k-1}, now)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">max</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">n</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mclose">)</span></span></span></span></span></p>
<h3 id="延迟保证">延迟保证</h3>
<p>控制延迟的方法：</p>
<ul>
<li><strong>比率</strong>(WFQ)</li>
<li>队列的<strong>大小</strong></li>
</ul>
<p>约束交通：在任何时间长度 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em;"></span><span class="mord mathnormal">t</span></span></span></span> 的周期中，到达的 bit 数被 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi><mo>+</mo><mi>ρ</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">σ + ρ t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.80952em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">ρ</span><span class="mord mathnormal">t</span></span></span></span>，被称为“(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi></mrow><annotation encoding="application/x-tex">σ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ρ</mi></mrow><annotation encoding="application/x-tex">ρ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">ρ</span></span></span></span> 约束）”</p>
<p>在我们的例子中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi><mo>=</mo><mi>B</mi><mo separator="true">,</mo><mi>ρ</mi><mo>=</mo><msub><mi>R</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">σ = B, ρ = R_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">ρ</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E6%8E%A7%E5%88%B6%E4%BA%A4%E9%80%9A.webp" alt="控制交通"></p>
<p><strong>漏斗 leaky bucket 调节器</strong>：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E6%BC%8F%E6%96%97%E8%B0%83%E8%8A%82%E5%99%A8.webp" alt="漏斗调节器"></p>
<p>然后使用这个调节发送的速率</p>
<h2 id="阻塞控制">阻塞控制</h2>
<h3 id="基础">基础</h3>
<p>导致阻塞的原因：网络能缓冲的包数量是有限的，当进入网络的包速度高于流出的速度时，则经过足够长的时间，一定会有阻塞</p>
<p>所以阻塞是不可避免的，但是在阻塞不太多的情况下是有益的，因为其保持了网络的利用率；但另一方面，如果过大，则延迟过大</p>
<p><strong>公平</strong>的定义——<strong>最大-最小公平</strong>：无法在不减少其它流的速率时增加某一个流的速率</p>
<p><strong>基于网络</strong>的控制：ECN 路由器指出阻塞的程度，标记数据包中的位，接收者把这位包括到确认消息中，从而传递回发送者，令其调整发送速度</p>
<p><strong>基于终端</strong>：</p>
<p>想起之前的滑动窗口：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/TCP%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3.webp" alt="TCP滑动窗口"></p>
<p>通过变化窗口大小改变网络中未处理的包数量，要保证</p>
<p>窗口大小 = min{广告窗口（接收者），阻塞窗口（传递者“cwnd”）}</p>
<p><strong>AIMD (Addictive Increase, Multiplicative Decrease)</strong>：</p>
<ul>
<li>如果包成功接受，则 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mo>←</mo><mi>W</mi><mo>+</mo><mfrac><mn>1</mn><mi>W</mi></mfrac></mrow><annotation encoding="application/x-tex">W ← W + \frac{1}{W}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></li>
<li>如果包丢弃，则 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mo>←</mo><mfrac><mi>W</mi><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">W ← \frac W2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">←</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></li>
</ul>
<p>AIMD 锯齿：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/AIMD.webp" alt="AIMD"></p>
<h3 id="简单-AIMD-流的动态">简单 AIMD 流的动态</h3>
<p>每当窗口大小增加一时，因为链路已经满了，所以相当于把一个包放到路由器的缓冲区中，当其减半时，相当于等待路由器将缓冲区中的包清空</p>
<p>可以注意到，在理想情况下，链路可以保持充满，缓冲区的占用重复填满-清空的过程</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mi>W</mi><mrow><mi>R</mi><mi>T</mi><mi>T</mi></mrow></mfrac><mo>=</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">\frac{W}{RTT} = R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span></span> 是一个常数，因为我们事实上没有调节速率，而是在探索缓冲区的大小</p>
<p>链路速率 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>，则缓冲区的理想大小 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mo>=</mo><mi>R</mi><mi>T</mi><mi>T</mi><mo>×</mo><mi>C</mi></mrow><annotation encoding="application/x-tex">B = RTT × C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span></p>
<h3 id="多个流的-AIMD">多个流的 AIMD</h3>
<p>从整个缓冲区来看，则占有率几乎保持满；但从其中一个流来看，则其经历了和之前相同的历程。</p>
<p>注意到因为 buffer 占用率不在改变，故 RTT 是一个常数，则吞吐量 = <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>W</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow><mrow><mi>R</mi><mi>T</mi><mi>T</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{W(t)}{RTT}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.355em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E5%8D%95%E6%B5%81vs%E5%A4%9A%E6%B5%81.webp" alt="单流vs多流"></p>
<p>通过几何图形的两种计算方法，可以得到</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>R</mi><mo>=</mo><msqrt><mfrac><mn>3</mn><mn>2</mn></mfrac></msqrt><mfrac><mn>1</mn><mrow><mi>R</mi><mi>T</mi><mi>T</mi><msqrt><mi>p</mi></msqrt></mrow></mfrac></mrow><annotation encoding="application/x-tex">R = \sqrt{\frac 32} \frac{1}{RTT \sqrt{p}}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.6745349999999997em;vertical-align:-1.02294em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.651595em;"><span class="svg-align" style="top:-4.4em;"><span class="pstrut" style="height:4.4em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord">2</span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord">3</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.6115950000000003em;"><span class="pstrut" style="height:4.4em;"></span><span class="hide-tail" style="min-width:1.02em;height:2.48em;"><svg width='400em' height='2.48em' viewBox='0 0 400000 2592' preserveAspectRatio='xMinYMin slice'><path d='M424,2478
c-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514
c0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20
s-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121
s209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081
l0 -0c4,-6.7,10,-10,18,-10 H400000
v40H1014.6
s-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185
c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2z M1001 80
h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.788405em;"><span></span></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.70306em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord mathnormal">p</span></span></span><span style="top:-2.66306em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.33693999999999996em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.02294em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">p</span></span></span></span> 为丢包的概率</p>
<h3 id="TCP-Tahoe">TCP Tahoe</h3>
<p>有几个问题：</p>
<ul>
<li>何时发送？</li>
<li>何时重传？</li>
<li>何时确认？</li>
</ul>
<p>早期的 TCP 开始时预设的窗口太大了，白白浪费了很多时间在重传上</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/1986%E7%9A%84TCP.webp" alt="1986的TCP"></p>
<p>TCP Tahoe 做出了三大改进：</p>
<ul>
<li>阻塞窗口</li>
<li>超时估计</li>
<li>自我计时</li>
</ul>
<p>把阻塞控制分成两个状态：</p>
<ul>
<li>慢开始：连接建立或包超时</li>
<li>防止阻塞：稳定操作</li>
</ul>
<p>慢开始：</p>
<ul>
<li>窗口在最大段大小（MSS）开始</li>
<li>对每个确认的包增长窗口 MSS</li>
<li>也就是指数级增长，“慢”是相当于之前使用的网络策略的，其实很快</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/TCP%20Tahoe%20%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA.webp" alt="TCP Tahoe 有限状态机"></p>
<p>如果估计的往返时间太短，则无意义的重传；太长，则空闲时间浪费了容量</p>
<p>但是 RTT 是高度动态的</p>
<p>在获取 RTT 时，要同时更新考虑到估计值和方差，即</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span> 是 RTT 估计值</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi></mrow><annotation encoding="application/x-tex">g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span></span></span> 是 EWMA 增益</li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">m</span></span></span></span> 是最近的确认的数据包的 RTT 测量值</li>
<li>误差为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mo>=</mo><mi>m</mi><mo>−</mo><mi>r</mi></mrow><annotation encoding="application/x-tex">e = m - r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span></li>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>=</mo><mi>r</mi><mo>+</mo><mi>g</mi><mo>⋅</mo><mi>e</mi></mrow><annotation encoding="application/x-tex">r = r + g ⋅ e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.63889em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">e</span></span></span></span></li>
<li>方差 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mo>=</mo><mi>v</mi><mo>+</mo><mi>g</mi><mo stretchy="false">(</mo><mi mathvariant="normal">∣</mi><mi>e</mi><mi mathvariant="normal">∣</mi><mo>−</mo><mi>v</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">v = v + g(|e| - v)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord">∣</span><span class="mord mathnormal">e</span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span></span></span></li>
<li>超时 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo><mi>r</mi><mo>+</mo><mi>β</mi><mi>v</mi><mo stretchy="false">(</mo><mi>β</mi><mo>=</mo><mn>4</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">= r + β v(β = 4)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">4</span><span class="mclose">)</span></span></span></span></li>
</ul>
<p>自我计时：返回的时候已经以一个合适的速率均匀分布好了</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E8%87%AA%E6%88%91%E8%AE%A1%E6%97%B6.webp" alt="自我计时"></p>
<h3 id="TCP-Reno-和-New-Reno">TCP Reno 和 New Reno</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/TCP%20Tahoe.webp" alt="TCP Tahoe"></p>
<p>TCP Reno</p>
<ul>
<li>超时和 Tahoe 一样</li>
<li>三重确认时
<ul>
<li>设置门槛为 window/2</li>
<li>设置阻塞窗口为 window/2（快速恢复）</li>
<li>重传丢失段（快速重传）</li>
<li>保持在避免阻塞状态</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/TCP%20Reno.webp" alt="TCP Reno"></p>
<p>TCP New Reno</p>
<ul>
<li>超时和 Tahoe 一样</li>
<li>在快速恢复阶段
<ul>
<li>跟踪最后一个未确认的包</li>
<li>在每次重复确认，<strong>膨胀阻塞窗口</strong>最大段大小</li>
<li>当最后一个包裹确认时，返回避免阻塞状态，设为 cwnd 为进入快速恢复的值</li>
<li>当<strong>快速重传</strong>在传输中时，开始发送新的包裹</li>
</ul>
</li>
</ul>
<h3 id="AIMD">AIMD</h3>
<p>可以用 Chiu Jain 图表示为什么 AIMD 是有效的</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/Chiu%20Jain%E5%9B%BE.webp" alt="Chiu Jain图"></p>
<h3 id="RFC">RFC</h3>
<p><strong>Request For Comment(RFC)</strong> 是一系列文件</p>
<h2 id="应用层和-NAT">应用层和 NAT</h2>
<h3 id="NAT-类型">NAT 类型</h3>
<p><strong>网络地址转化 Network Address Translator(NAT)</strong>：将某主机的端口映射到公网 IP 的另一端口上，外部设备无法主动向内网设备打开连接</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/NAT%E7%BB%93%E6%9E%84.webp" alt="NAT结构"></p>
<p><strong>完全圆锥型 NAT full cone NAT</strong>：普通的 NAT 没有什么限制</p>
<p><strong>受限圆锥型 NAT Restrict Cone NAT</strong>：尽管内部端口和 IP 没变，但是外部的 IP 不一样，则不一样的外部 IP 无法连接到该内部主机</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E5%8F%97%E9%99%90%E5%9C%86%E9%94%A5%E5%9E%8B%20NAT.webp" alt="受限圆锥型 NAT"></p>
<p><strong>端口受限型 NAT</strong>：类似，但对于不同的端口无效</p>
<p><strong>对称 NAT</strong>：不同的外部 IP 对应相同的内部端口，会建立不同的外部端口</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E5%AF%B9%E7%A7%B0NAT.webp" alt="对称NAT"></p>
<p><strong>Hairpinning</strong>：A 和 B 相互通信时，必须要经过 NAT，但明明可以直接通过 switch 通信，这降低了网络效率</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/hairpinning.webp" alt="hairpinning"></p>
<h3 id="影响">影响</h3>
<p>外部设备无法主动向内网设备打开连接，故对于两个都在内网的设备，必须通过中继通信，但还有一种方法——<strong>内网穿透 NAT Hole-Punching</strong></p>
<ul>
<li>服务器与两个客户端建立连接，并分别报告另一方的 IP 和端口</li>
<li>两个客户端同时向另一方发起连接的请求</li>
<li>这对于对称型 NAT 没有用，但这并不是很常见</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F.webp" alt="内网穿透"></p>
<p>此外，NAT 只支持 IP，TCP，UDP 三种协议，故很难有其他的协议能够普及</p>
<p>所以 NAT 在一定程度上提高了安全性，缓解了 IP 地址缺少带来的问题，但也带来了非常多的不便</p>
<h3 id="操作">操作</h3>
<p>对于没有映射的端口，NAT 和普通的终端一样没有什么区别，所以可以打开自己路由器的配置网页</p>
<h3 id="HTTP">HTTP</h3>
<p>普通的 ASCII 字符</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/HTTP%E8%AF%B7%E6%B1%82%E6%A0%BC%E5%BC%8F.webp" alt="HTTP请求格式"></p>
<p>HTTP/1.0</p>
<ul>
<li>打开连接</li>
<li>发送 GET</li>
<li>服务器在回复后关闭连接</li>
</ul>
<h3 id="HTTP-1-1-保活">HTTP/1.1 保活</h3>
<p>为请求/回应添加连接头，使对方不要着急关闭连接</p>
<h3 id="BitTorrent">BitTorrent</h3>
<p>Torrent 文件描述了下载的文件</p>
<ul>
<li>tracker</li>
<li>文件长度，块长度，SHA1 哈希</li>
<li>额外元数据</li>
</ul>
<p>客户端对话 tracker，开始和同伴连接</p>
<p>无 tracker 的 torrent 使用 DHT（分布式哈希表）</p>
<ul>
<li>信息存在许多结点群上</li>
<li>分布式协调机制</li>
</ul>
<p>piece 的哈希值保证了端到端的完整</p>
<p><strong>以牙还牙 tit-for-tat 策略</strong>：上传给你的数据的同伴</p>
<p>绝大多数 peer 被 choke 了而没有得到数据</p>
<p>按照下载速率给未 choke 的 peer 排序，choke 非 P 最好的</p>
<p>随机解除 choke 一个 peer</p>
<p>BitTyrant</p>
<ul>
<li>给 peer 刚足够使其 unchoke 你</li>
<li>使尽可能多的 peers unchoke 你</li>
<li>给更多 peers 分享容量而不是给其中每个更多</li>
</ul>
<h3 id="DNS">DNS</h3>
<p>两个性质使得 DNS 可行：</p>
<ul>
<li>只读和经常读的数据库</li>
<li>一致性宽松</li>
</ul>
<p>这两个性质允许广泛的缓存</p>
<p>层次结构区域（root，edu，Stanford，scs）</p>
<p>每个区域分开管理</p>
<p>美育区域从几个复制的服务器服务</p>
<p>两类请求：</p>
<ul>
<li>递归</li>
<li>非递归</li>
</ul>
<p>UDP 端口 53</p>
<p>可以通过修改缓存中的数据达到污染 DNS 的目的</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/DNS%E6%9F%A5%E8%AF%A2.webp" alt="DNS查询"></p>
<p>所有 DNS 消息以**资源记录 Resource Records(RRs)**形式表示：</p>
<p>name [TTL] [class] type rdata</p>
<ul>
<li>name：域名</li>
<li>TTL：存活时间</li>
<li>class：通常是 IN 1（Internet）</li>
<li>type：记录的类型
<ul>
<li>A（IPv4 地址）</li>
<li>NS（域名服务器）</li>
</ul>
</li>
<li>rdata：依赖于 type 的资源数据</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/DNS%20RR%E7%BB%93%E6%9E%84.webp" alt="DNS RR结构"></p>
<p>dig 工具</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/DNS%E6%B6%88%E6%81%AF%E7%BB%93%E6%9E%84.webp" alt="DNS消息结构"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/DNS%E5%A4%B4%E7%BB%93%E6%9E%84.webp" alt="DNS头结构"></p>
<ul>
<li>QR：0=查询，1=回应</li>
<li>OPCODE：0=标准查询</li>
<li>RCODE：错误代码</li>
<li>flags
<ul>
<li>AA：authoritative answer</li>
<li>TC：truncated</li>
<li>RD：Recursion desired</li>
<li>RA：Recursion available</li>
</ul>
</li>
</ul>
<p>域名压缩：</p>
<ul>
<li>把名字分成标签，每个标签用长度编码，如：15aefrivern，6github，2io</li>
<li>以偏移量引用</li>
</ul>
<p>glue record：父域中的 A 记录，与 NS 记录关联</p>
<p><strong>CNAME (canonical name)</strong> 记录：一个名字是别名</p>
<ul>
<li>任何规范名字的记录都会与这个名字关联</li>
<li>cname 阻止其他名字的 RR</li>
</ul>
<p>MX 记录：邮件交换记录</p>
<p>其他类型的记录：</p>
<ul>
<li>SOA：开始权威</li>
<li>TXT：任意文本</li>
<li>PTR：将地址映射为名字</li>
<li>AAAA：IPv6 地址</li>
</ul>
<h3 id="DHCP">DHCP</h3>
<p>用 IP 通信需要：</p>
<ul>
<li>IP 地址</li>
<li>子网掩码</li>
<li>网关路由</li>
<li>DNS 服务器 IP 地址</li>
</ul>
<p><s>手动配置</s></p>
<p><strong>动态主机配置协议 DHCP（Dynamic Host Configuration Protocol)</strong>：</p>
<ul>
<li>可以向 DHCP 服务器请求配置</li>
<li>discover，offer，Request，ack，release</li>
<li>可以有多个服务器返回 offer，选择一个</li>
</ul>
<p>无 IPv4 通信：</p>
<ul>
<li>UDP 端口 67（服务器）和 68（客户端）</li>
<li>广播地址：255.255.255.255</li>
<li>使用中继通过链接转发</li>
</ul>
<h2 id="路由">路由</h2>
<h3 id="泛洪，源路由和生成树">泛洪，源路由和生成树</h3>
<p>flooding：每个路由向所有端口传递包，可能会出现环，所以需要 TLL，在对拓扑结构一无所知的情况下有用</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/flooding.webp" alt="flooding"></p>
<p>源路由：源在包头中指定路由的路径（端到端）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E6%BA%90%E8%B7%AF%E7%94%B1.webp" alt="源路由"></p>
<p>生成树</p>
<p>多路径：通过多个路径将数据包散布到目的地，不给一条路径增加大量负担</p>
<p><strong>多播 multicast</strong>：将数据包发送给多个主机</p>
<h3 id="Bellman-Ford-算法">Bellman Ford 算法</h3>
<p>假设每个路由直到邻居链路的花费，每个路由 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">R_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 都维护抵达 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mn>8</mn></msub></mrow><annotation encoding="application/x-tex">R_8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的花费 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">C_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p>
<p>向量 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo>=</mo><mo stretchy="false">(</mo><msub><mi>C</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>C</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>C</mi><mn>7</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C=(C_1, C_2, \dots, C_7)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">7</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 是到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mn>8</mn></msub></mrow><annotation encoding="application/x-tex">R_8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">8</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 的距离向量，所以这个算法是一种<strong>距离向量</strong>算法</p>
<p>Bellman-Ford 算法的问题在于<strong>坏消息传播慢</strong></p>
<p>解决方法：</p>
<ul>
<li>将无穷设置为某个较小的整数</li>
<li>水平分裂：因为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">R_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 从 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">R_3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 处获取最小路径，故其不会反过来通过 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">R_3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
</ul>
<h3 id="Dijkstra-s-最短路径优先算法">Dijkstra's 最短路径优先算法</h3>
<p>这是一种<strong>链路状态算法</strong></p>
<p>交换链路状态：一个路由向每个与其相连的链路状态路由泛洪</p>
<p>每个路由独立地运行 Dijkstra's 最短路径优先算法</p>
<p>特点：</p>
<ul>
<li>链路状态被每个路由得知</li>
<li>每个路由找到向其他路由的最短路径生成树</li>
</ul>
<p>这是 **OSPF（Open Shortest Path First）**的基础</p>
<p>算法的直观理解：将小球用线连接在一起，慢慢举起一个小球</p>
<h3 id="Internet-中的路由">Internet 中的路由</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/Internet%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84.webp" alt="Internet层次结构"></p>
<p><strong>自治系统 Autonomous System(AS)</strong> 是互联网层次结构的基本单元</p>
<ul>
<li>在 AS 中，所有者决定路由方式</li>
<li>在 AS 间，必须使用 <strong>BGP-4（边界网关协议 Border Gateway Protocol, v4)</strong></li>
</ul>
<p><strong>内部路由协议 Interior Routing Protocol</strong>：</p>
<ul>
<li><strong>路由信息协议 Routing Information Protocol (RIP)</strong>：使用 Bellman-Ford 算法，现在很少用</li>
<li><strong>OSPF 路由协议 Open Shortest Path First(OSPF)</strong>：每个路由使用 Dijkstra 算法，广泛使用</li>
<li><strong>IS-IS 路由协议</strong>：类似，也广泛使用</li>
</ul>
<p>路由到一个出口：每个包都发送到默认路由器即可</p>
<p>路由到多个出口：</p>
<ul>
<li>热土豆路由：发送到最近的出口</li>
<li>选择离目的地最近的出口</li>
</ul>
<p><strong>外部路由协议：</strong></p>
<p><strong>BGP-4</strong>：解决不同 AS 的边境争端</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/Internet%E7%BB%93%E6%9E%84.webp" alt="Internet结构"></p>
<h3 id="BGP">BGP</h3>
<p>BGP 使用<strong>路径向量</strong>，其发布完整的路径，也称作 AS_PATH</p>
<ul>
<li>有环的路径在局部被检测并忽略</li>
<li>局部政策在选项中选择路径</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E5%90%8C%E4%BC%B4%E5%85%B3%E7%B3%BB.webp" alt="同伴关系"></p>
<p>BGP 消息：</p>
<ul>
<li>Open：建立 BGP 对话</li>
<li>Keep Alive：定期提供一次握手</li>
<li>Notification：关闭同伴对话</li>
<li>update：<strong>宣布</strong>或<strong>撤销</strong>之前宣布的路线</li>
</ul>
<p>BGP announcement = prefix + path attributes</p>
<ul>
<li>path attributes 包括：下一跳，AS 路径，局部选择，多出口鉴别器</li>
</ul>
<h3 id="多播">多播</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E5%A4%9A%E6%92%AD.webp" alt="多播"></p>
<p><strong>反向路径广播（RPB 或 RPF）</strong>：相当于剪枝后的洪泛算法，每个路由只接受来自生成树上的包并向所有端口扩散，这样就避免了成环</p>
<p><strong>剪枝 pruning</strong> 策略：无目的主机的路由向源发送剪枝消息</p>
<p>一棵树 vs 多棵树：维护某一路由的最小生成树，所有路由都要经过那个路由，而不是每个路由都有一颗最小生成树</p>
<p>D 类 IPv4 地址用于多播</p>
<p><strong>Internet 组管理协议 IGMP (Internet Group Management Ptotocol)：</strong></p>
<ul>
<li>在主机和直接连接的路由器中</li>
<li>主机询问接受属于一个特定的多播组的包</li>
<li>路由器周期性地询问注意想要哪个组</li>
<li>如果没有回应，则成员关系超时</li>
</ul>
<p><strong>距离矢量组播路由选择协议 DVMRP (Distance Vector Multicast Routing Protocol)</strong>：</p>
<ul>
<li>第一个互联网路由协议</li>
<li>使用 RPB + Prune</li>
</ul>
<p><strong>协议无关多播 PIM (Protocol Independent Multicast)</strong>：</p>
<ul>
<li>稠密模式：类似于 DVMRP</li>
<li>稀疏模式：建造集会点</li>
</ul>
<p>在实践中多播使用并不广泛（主要是流媒体的兴起）</p>
<h3 id="生成树协议">生成树协议</h3>
<p>防止循环：</p>
<ul>
<li>决定树的根</li>
<li>决定转发的端口</li>
</ul>
<p>工作：</p>
<ul>
<li>
<p>所有的交换机广播<strong>网桥协议数据单元 Bridge Protocol Data Unit (BPDU)</strong></p>
<ul>
<li>发送者的 ID，根的 ID，从发送者到根的距离</li>
</ul>
</li>
<li>
<p>每个交换机都声称是根：设置距离为 0</p>
</li>
<li>
<p>每个交换机广播直到收到一个<strong>更好</strong>的信息</p>
</li>
<li>
<p>如果一个交换机收到一个更好的信息，则重传</p>
</li>
<li>
<p>根端口：最接近根的端口</p>
</li>
<li>
<p>指派端口：用于抵达根的端口</p>
</li>
<li>
<p>其余端口被阻塞转发，但仍可以发送和接收 BPDU</p>
</li>
</ul>
<h3 id="IPv6">IPv6</h3>
<ul>
<li>128 位</li>
<li>写成 8 块 16 bit</li>
<li>可以使用 <code>::</code> 省略大量的 0</li>
<li>在 URL 中使用 <code>[]</code></li>
<li>低 32 位可以像 IPv4 一样书写</li>
</ul>
<p>可以从子网掩码 /64 和以太网地址中自动生成 IPv6 地址：</p>
<p>| c c c c c c 0 g | c c c c c c c c | c c c c c c c c | m m m m m m m m | m m m m m m m m | m m m m m m m m |</p>
<p>反转 0 和插入 0xfffe：</p>
<p>| c c c c c c 1 g | c c c c c c c c | c c c c c c c c | 1 1 1 1 1 1 1 1 | 1 1 1 1 1 1 1 0 | m m m m m m m m | m m m m m m m m | m m m m m m m m |</p>
<h2 id="更低的层级">更低的层级</h2>
<h3 id="容量与调制">容量与调制</h3>
<p><strong>香农极限</strong>：信道容量 = <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><msub><mo><mi>log</mi><mo>⁡</mo></mo><mn>2</mn></msub><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mi>S</mi><mi mathvariant="normal">/</mi><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">B\log_2(1+S/N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span></p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span> 是带宽，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span> 是信号强度，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span> 是噪声</li>
</ul>
<p><strong>振幅键控方式 Amplitude Shift Keying(ASK)</strong>：在有线网中有用，因为信号强度不会衰减很多</p>
<p>PMA-5：五级脉冲振幅调制：在 100BASE-T 和 1000BASE-T 以太网中常用</p>
<p>PMA-16：16 级，在 10GBASE-T 中使用</p>
<p><strong>相位偏移调制 Phase Shift Keying(PSK)</strong>：更广泛使用</p>
<ul>
<li><strong>二进制相移键控 BPSK</strong>：两个相位 (0, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>π</mi></mrow><annotation encoding="application/x-tex">\pi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">π</span></span></span></span>)</li>
<li><strong>正交相移键控 QPSK</strong>：四个相位</li>
</ul>
<p><strong>IQ 星座 I/Q Constellation</strong>：在二维图中表示相位偏移调制的符号</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/IQ%E6%98%9F%E5%BA%A7%E5%9B%BE.webp" alt="IQ星座图"></p>
<p><strong>符号 symbol</strong> 是物理层的传输单元，一个符号可以容纳多个 bit</p>
<p><strong>正交振幅调制 Quadrature Amplitude Modulation(QAM)</strong> 同时使用了振幅和相位</p>
<ul>
<li>16-QAM：16 个符号</li>
<li>256-QAM：256 个符号</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/16-QAM.webp" alt="16-QAM"></p>
<h3 id="位错误和编码">位错误和编码</h3>
<p>bit 错误率可能很低，但绝不会为 0</p>
<p>编码：在物理层添加一些冗余提高链接层的吞吐量</p>
<p><strong>编码增益 coding gain</strong>：</p>
<ul>
<li>3/4 编码：每 3 个链路层的 bit 对应物理层的 4 bit</li>
</ul>
<p>bitrate = bits/symbol * symbol rate * coding rate</p>
<h3 id="时钟和时钟恢复">时钟和时钟恢复</h3>
<p>数据通过时钟传递，但是不知道发送者的时钟，可能会有一定偏差</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E6%97%B6%E9%92%9F%E5%90%8C%E6%AD%A5.webp" alt="时钟同步"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E5%90%8C%E6%AD%A5%E9%80%9A%E4%BF%A1.webp" alt="同步通信"></p>
<p>因为始终没有单独发送，故数据流必须有足够多的转移使接受者确定时钟</p>
<p><strong>曼彻斯特 Manchester 编码</strong>：数据为 0 时对应下降沿，为 1 时对应上升沿，两个相同的则会在中间添加一个时钟沿</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E6%9B%BC%E5%BD%BB%E6%96%AF%E7%89%B9%E7%BC%96%E7%A0%81.webp" alt="曼彻斯特编码"></p>
<p>优点：</p>
<ul>
<li>保证了每个 bit 周期都有一个转移</li>
<li>保证了 d.c. 平衡，即高电平和低电平数量一样</li>
</ul>
<p>缺点：最坏情况下带宽加倍</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E6%9B%BC%E5%BD%BB%E6%96%AF%E7%89%B9%E7%BC%96%E7%A0%81%E9%A2%91%E5%9F%9F.webp" alt="曼彻斯特编码频域"></p>
<p>方法 2：<strong>4b5b 编码</strong></p>
<p>优点：</p>
<ul>
<li>带宽利用率更高</li>
<li>允许控制信息的额外编码</li>
</ul>
<p>缺点：转移较少，恢复较难</p>
<h3 id="转发错误纠正">转发错误纠正</h3>
<p><strong>Reed-Solomon 错误纠正</strong>：广泛使用，数学上较简单</p>
<p>思想：</p>
<ul>
<li>选择 k 块数据</li>
<li>使其成为 k-1 阶多项式的系数</li>
<li>沿着多项式计算 n 个点，作为编码数据发送
<ul>
<li>n 个点中的任意 k 个点都能还原多项式系数</li>
</ul>
</li>
</ul>
<p>细节：</p>
<ul>
<li>可以纠正至多 n-k 个擦除 erasure（直到错误发生的位置）</li>
<li>纠正至多 (n-k)/2 个错误（不知道发生的位置）</li>
</ul>
<p>因为物理媒介通常是并发的错误，所以可以通过<strong>交错 interleaving</strong> 使编码更强健</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E4%BA%A4%E9%94%99.webp" alt="交错"></p>
<h3 id="CSMA-CD">CSMA/CD</h3>
<p>在以太网，多个主机共享媒介，所以需要决定谁去发送，何时发送</p>
<p>有一类<strong>媒质访问控制协议 Medium Access Control(MAC) Protocol Protocol</strong></p>
<p>目标：</p>
<ul>
<li>共享信道的高利用率</li>
<li>公平</li>
<li>低成本，简单</li>
<li>对错误强健</li>
</ul>
<p><strong>Aloha 协议：</strong></p>
<ul>
<li>如果有数据要发送，就发送</li>
<li>如果传输和其他冲突了，则过一会儿重传</li>
</ul>
<p>**带有冲突检测的载波侦听多路存取 Carrier Sense Multiple Access/collision detection (CSMA/CD) 协议：**当有包想要传递时</p>
<ul>
<li><strong>载波侦听 carrier sense</strong>：在传输之前检查线路</li>
<li><strong>冲突检测</strong>：尽可能检测冲突，如果检测到冲突，则等待；等待随机时间（二项式指数后退），然后返回</li>
</ul>
<p>要等到两个发送者都能检测出冲突，所以必须满足 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mi>P</mi><mi>R</mi></mfrac><mo>≥</mo><mfrac><mrow><mn>2</mn><mi>L</mi></mrow><mi>c</mi></mfrac></mrow><annotation encoding="application/x-tex">\frac PR ≥ \frac {2L}{c}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E5%8C%85%E5%A4%A7%E5%B0%8F%E8%A6%81%E6%B1%82.webp" alt="包大小要求"></p>
<h3 id="以太网">以太网</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E4%BB%A5%E5%A4%AA%E7%BD%91%E5%B8%A7%E6%A0%BC%E5%BC%8F.webp" alt="以太网帧格式"></p>
<ul>
<li>preamble：恢复时钟</li>
<li>SFD：指示开始帧</li>
<li>DA：48 位的全局唯一的目标地址，有制造商赋予</li>
<li>type：封装数据的协议 IP=0x0800</li>
<li>pad：满足最小帧长度</li>
<li>CRC：循环冗余检查，检验序列，用于检测位错误</li>
</ul>
<p>最常见的是 10Base-T：双绞线以太网</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E6%98%9F%E5%BD%A2%E4%BB%A5%E5%A4%AA%E7%BD%91.webp" alt="星形以太网"></p>
<p>当数据速度 R 提升时，为了满足之前的不等式，可以限制 L 或使用以太网交换机</p>
<p>100Base-TX：</p>
<ul>
<li><strong>全双工 full duplex</strong>，即数据可以在两个方向上同时传输</li>
</ul>
<p>现代不再用 hub 了，而是全部改成了 switch</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E6%9C%BA.webp" alt="以太网交换机"></p>
<h3 id="无限网络">无限网络</h3>
<p>不同之处：</p>
<ul>
<li>空间传播：衰减快（平方反比）</li>
<li>无法控制的介质：信号强度随着时间改变</li>
<li>干扰</li>
</ul>
<h3 id="CSMA-CA">CSMA/CA</h3>
<p>以太网的 CSMA/CD 无法直接使用，因为发送者可能无法得知发生了冲突</p>
<p>故这里采用 CSMA/CA，区别在于如果接收方成功接收到了数据，则发送 ack；如果发送方未收到 ack，则认为发生了冲突</p>
<p>这种方法也存在一些问题，如</p>
<p>隐藏的终端：A 和 C 无法感知到对方的存在，但会发生冲突</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E9%9A%90%E8%97%8F%E7%9A%84%E7%BB%88%E7%AB%AF.webp" alt="隐藏的终端"></p>
<p>暴露的终端：B 和 C 可以同时发送，却根据规则，其中一方无法发送</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E6%9A%B4%E9%9C%B2%E7%9A%84%E7%BB%88%E7%AB%AF.webp" alt="暴露的终端"></p>
<p>无法区分是冲突还是信噪比低：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E5%86%B2%E7%AA%81%E8%BF%98%E6%98%AF%E4%BD%8E%E4%BF%A1%E5%99%AA%E6%AF%94.webp" alt="冲突还是低信噪比"></p>
<h3 id="RTS-CTS">RTS/CTS</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/RTS%20CTS.webp" alt="RTS/CTS"></p>
<p>可以解决第一个问题，可以帮助解决第二和第三个问题</p>
<p>问题在于当传输速率提到时，这种方法的开销占比明显增大</p>
<h3 id="802-11-格式和开销">802.11 格式和开销</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/802.11%20MAC.webp" alt="802.11 MAC"></p>
<p>链路层头的前两项用于<strong>虚拟载波感知 Virtual Carrier Sense</strong></p>
<p>接下来的地址项为无限连接的节点提供有线的虚拟访问</p>
<p>为了向后兼容，无法全速发送物理层的头，否则一些旧设备无法接收到，故当传输速率较大时，会收到这一段的传输速率限制</p>
<h3 id="碎片化">碎片化</h3>
<p>高层的数据单元比较低层的数据单元大，故要将其分裂为更小的块</p>
<p>组装：合并为原来的数据单元</p>
<p>TCP 一般要避免 IP 碎片化，故需要选择合适的段大小，可以二分查找，但一般直接尝试几种常见的 IP 碎片大小就行了</p>
<h2 id="安全">安全</h2>
<h3 id="介绍">介绍</h3>
<ul>
<li><strong>窃听 eavesdrop</strong>：被动嗅探或记录网络数据</li>
<li>修改，删除，插入：主动篡改数据</li>
<li>阻止通信：denial of service</li>
</ul>
<p>都可以发生在网络的各个层级</p>
<p>中间人攻击：伪装成另一方，作为一个两者通信的中间人</p>
<p>我们需要：</p>
<ul>
<li><strong>保密性 confidentiality</strong>：没人可以监听通信——加密</li>
<li><strong>完好 integrity</strong>：消息不被篡改——消息验证码</li>
<li><strong>身份验证 authentication</strong>：确认其他另一方的身份——数字签名和证书</li>
</ul>
<h3 id="攻击">攻击</h3>
<p>第二层：</p>
<ul>
<li>监听杂乱模式的接口</li>
<li>强制包广播，然后使用上面的方法</li>
<li>伪装成 DHCP 或 ARP 服务器，重定向包到一个不同的端主机</li>
</ul>
<p>MAC 溢出攻击</p>
<h3 id="第三层攻击">第三层攻击</h3>
<p>使用 ICMP 告诉源端主机重定向交通</p>
<p>BGP 劫机：</p>
<ul>
<li>ISP 广告属于其他人的前缀，阻塞交通</li>
<li>广告无效的路径，制造黑洞</li>
<li>需要伪装成 ISP 或接管 BGP TCP 段</li>
</ul>
<p>更具体的前缀</p>
<h3 id="保密性">保密性</h3>
<p>对称式加密</p>
<p><strong>一次一密 one-time pad</strong>：使用异或加密和解密</p>
<p>但是注意到如果使用同一个密钥加密了两个数据，这两个加密后的数据会泄露信息</p>
<p>流密码：伪随机的 pad</p>
<p>块密码：对固定大小的块操作</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/blowfish.webp" alt="blowfish"></p>
<p>注意到攻击者可以学习重复的明文块</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/ECB.webp" alt="ECB"></p>
<p><strong>密码分组链接 Cipher-block chaining (CBC)</strong>：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/CBC.webp" alt="CBC"></p>
<h3 id="完整性">完整性</h3>
<ul>
<li>加密哈希</li>
<li>消息验证码（MACs）</li>
</ul>
<p>加密哈希</p>
<ul>
<li>抗碰撞，即很难找到哈希值相同的两个不同的数据</li>
<li>SHA-256 或 SHA-512</li>
</ul>
<p>HMAC：从密钥和哈希中生成 MAC，即 HMAC(K,M) = H(K ⊕ opad, H(K ⊕ ipad, M))</p>
<p>加密和 MAC 混用时，注意一定要先加密，再计算 MAC</p>
<h3 id="公钥加密">公钥加密</h3>
<p>非对称式加密</p>
<ul>
<li>机密性：公钥加密，私钥解密
<ul>
<li>加密必须是随机的，否则可以猜出简单的明文</li>
</ul>
</li>
<li>签名：私钥加密，公钥解密</li>
</ul>
<p>杂交方法：用公钥加密对称式密钥</p>
<p>注意不要给未指定的信息签名，如未填写收件人信息和时间等</p>
<h3 id="证书">证书</h3>
<p>如何证明服务器的公钥是真的？</p>
<p>每个人信任几个签名机构并获知其公钥，通过信任链去信任更多的证书</p>
<p>是 TLS/HTTPS 的工作原理</p>
<h3 id="TLS">TLS</h3>
<p><strong>传输层安全 TLS</strong>：TCP 之上的会话层安全</p>
<p>TLS 会话指派了四个密钥：</p>
<ul>
<li>服务器和客户端的身份验证（RSA）</li>
<li>密钥交换（RSA）</li>
<li>对称式加密（AES）</li>
<li>完整性（HMAC-MD5）</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/TLS%E5%AF%86%E9%92%A5%E5%8D%8F%E5%95%86.webp" alt="TLS密钥协商"></p>
<p>TLS 将数据流分裂为记录，记录可以被压缩，记录通过 TCP 发送</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/Stanford%20CS144%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AF%BC%E8%AE%BA/%E4%BC%9A%E8%AF%9D%E5%AF%86%E9%92%A5%E7%BB%86%E8%8A%82.webp" alt="会话密钥细节"></p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Stanford/">Stanford</a><a class="post-meta__tags" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/cc1b9611.html" title="JavaScript"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/JavaScript.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">JavaScript</div></div><div class="info-2"><div class="info-item-1">写在最前 基于 Marijn Haverbeke 的 Eloquent JavaScript 编写 JavaScript 和 Java 没有任何关系，这个名字是为了蹭 Java 的热度 console.log(&#x27;Hello, world!&#x27;); VSCode 开发环境配置 JavaScript/TypeScript + React 原生支持（毕竟 VS Code 就是用 TypeScript 编写的，所有的扩展都是用 JS 写的，但可以添加一些提高开发效率的代码片段 JavaScript (ES6) code snippets 支持 JS/TS，JSX/TSX，html 等 摘录一些常用的： 导入与导出：    触发方式 功能 示例     imp 导入整个模块 import fs from 'fs';   imn 匿名模块导入 import 'animate.css'   imd 使用解构导入 import &#123;rename&#125; from 'fs';   rqr 需要包 require('');   req 以 const...</div></div></div></a><a class="pagination-related" href="/posts/b291b1dc.html" title="Shell 与 CLI"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/Shell%20%E4%B8%8E%20CLI.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Shell 与 CLI</div></div><div class="info-2"><div class="info-item-1">WSL2 ~~邪教——适用于 Linux 的 Windows 子系统（WSL2） 尽管 WSL2 中的 Linux 内核是不完整的，但几乎已经足够使用了。而且其无论是启动速度还是易用性方面都比虚拟机好得多，而且 IP 地址相同 参考文档：适用于 Linux 的 Windows 子系统文档 | Microsoft Learn wsl --install 查看可用非发行版：wsl --list --online 列出已安装的版本：wsl --list --verbose 安装指定 Linux 发行版：wsl --install -d &lt;distribution name&gt; 运行指定 Linux 发行版：wsl --distribution &lt;Distribution Name&gt; 设置默认 Linux 发行版：wsl --set-default &lt;Distribution Name&gt; 关闭：wsl --shutdown 换源：使用中科大源 这里使用的是最新的 Ubuntu 24.04，使用其提供的命令： sudo sed -i...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="iconfont icon-tuijian"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/86226930.html" title="Coursera：机器学习"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/Coursera%EF%BC%9A%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-21</div><div class="info-item-2">Coursera：机器学习</div></div><div class="info-2"><div class="info-item-1">机器学习 监督学习：人为做标签  回归：有无数种可能的结果，预测一个数字 分类：较少的可能结果，预测类别  非监督学习：无数据的标签，探索数据的结构  集群：将相似的数据点放到一起 降维：使用更少的数字压缩数据 异常检测：找到异常的数据点  线性回归 fw,b(x)=wx+bf_{w,b}(x) = wx + b fw,b​(x)=wx+b 最小二乘法的代价函数： J(w,b)=12m∑i=1m(y^(i)−y(i))2J(w, b) = \frac{1}{2m} \sum_{i=1}^m (\hat{y}^{(i)} - y^{(i)})^2 J(w,b)=2m1​i=1∑m​(y^​(i)−y(i))2 梯度下降找极小值：  w=w−α∂∂wJ(w,b)w = w - α \frac{\partial}{\partial w} J(w, b)w=w−α∂w∂​J(w,b) b=b−α∂∂bJ(w,b)b = b - α \frac{\partial}{\partial b} J(w, b)b=b−α∂b∂​J(w,b)  其中的 α\alphaα...</div></div></div></a><a class="pagination-related" href="/posts/fcb984bc.html" title="Coursera：深度学习"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/Coursera%EF%BC%9A%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-10-11</div><div class="info-item-2">Coursera：深度学习</div></div><div class="info-2"><div class="info-item-1">深层神经网络  在反向传播训练 w 和 b 时，我们需要计算 dZ[l]dZ^{[l]}dZ[l]，dW[l]dW^{[l]}dW[l]，db[l]db^{[l]}db[l]，方法是通过链式法则求导，向量化之后可以得到： dW[l]=1mdZ[l]A[l−1]TdW^{[l]} = \frac{1}{m} dZ^{[l]} A^{[l-1]T} dW[l]=m1​dZ[l]A[l−1]T db[l]=1m∑dZ[l]db^{[l]} = \frac{1}{m} \sum dZ^{[l]} db[l]=m1​∑dZ[l] dZ[l−1]=W[l]TdZ[l]∗g[l−1]′(Z[l−1])dZ^{[l-1]} = W^{[l]T} dZ^{[l]} * g^{[l-1]\prime}(Z^{[l-1]}) dZ[l−1]=W[l]TdZ[l]∗g[l−1]′(Z[l−1]) 最后一层的 dZ[L]=A[L]−YdZ^{[L]} =     A^{[L]} - YdZ[L]=A[L]−Y 其中，g[l]′(Z[l])g^{[l]\prime}(Z^{[l]})g[l]′(Z[l])...</div></div></div></a><a class="pagination-related" href="/posts/dd378ae0.html" title="Stanford CS106L：标准C++程序设计"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/Stanford%20CS106L%EF%BC%9A%E6%A0%87%E5%87%86%20C++%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-19</div><div class="info-item-2">Stanford CS106L：标准C++程序设计</div></div><div class="info-2"><div class="info-item-1"> 流 Stream stream 相当于缓冲区 buffer，在不同物件中传输数据 构造 stringstream ##include &lt;iostream&gt;##include &lt;sstream&gt;##include &lt;string&gt;int main() &#123;    std::istringstream iss(&quot;Initial&quot;);    std::ostringstream oss(&quot;Initial&quot;);    std::string s;    iss &gt;&gt; s;    oss &lt;&lt; s;    return 0;&#125; 四个 bits：  Good：准备好读写 Fail：之前的操作失败了 EOF：之前的操作到达了 buffer 的末尾 Bad：外部错误  通常检查 EOF 和 Fail 位的状态 不要大量使用 std::endl，因为每次使用时都会清除一次 buffer，导致效率低下，改为 \n。 还有很多 manipulator 可供使用，例如控制格式的...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/%E5%A4%B4%E5%83%8F_%E7%81%B0%E5%A4%AA%E7%8B%BC.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Aefrivern</div><div class="author-info-description">我一定会回来的</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">170</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">226</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/aefrivern" rel="external nofollow noreferrer" target="_blank" title="icon-github"><i class="GitHub"></i></a><a class="social-icon" href="mailto:2771503468@qq.com" rel="external nofollow noreferrer" target="_blank" title="icon-youxiang"><i class="QQ邮箱"></i></a><a class="social-icon" href="https://steamcommunity.com/id/old_driver_zero" rel="external nofollow noreferrer" target="_blank" title="icon-steam"><i class="Steam"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><a class="faa-parent animated-hover"><svg class="faa-tada icon" style="height:25px;width:25px;fill:currentColor;position:relative;top:5px" aria-hidden="true"><use xlink:href="#icon-mulu"></use></svg></a><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Internet-%E5%92%8C-IP-%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">Internet 和 IP 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E7%9A%84%E4%B8%80%E5%A4%A9%E7%94%9F%E6%B4%BB"><span class="toc-number">1.1.</span> <span class="toc-text">应用的一天生活</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Internet-%E5%9B%9B%E5%B1%82%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.2.</span> <span class="toc-text">Internet 四层模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IP-%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.3.</span> <span class="toc-text">IP 服务模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%85%E7%9A%84%E4%B8%80%E5%A4%A9"><span class="toc-number">1.4.</span> <span class="toc-text">包的一天</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%85%E4%BA%A4%E6%8D%A2%E5%8E%9F%E5%88%99"><span class="toc-number">1.5.</span> <span class="toc-text">包交换原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B1%82%E5%8E%9F%E5%88%99"><span class="toc-number">1.6.</span> <span class="toc-text">分层原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%81%E8%A3%85"><span class="toc-number">1.7.</span> <span class="toc-text">封装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E8%8A%82%E5%BA%8F"><span class="toc-number">1.8.</span> <span class="toc-text">字节序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPv4-%E5%9C%B0%E5%9D%80"><span class="toc-number">1.9.</span> <span class="toc-text">IPv4 地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E9%95%BF%E5%89%8D%E7%BC%80%E5%8C%B9%E9%85%8D"><span class="toc-number">1.10.</span> <span class="toc-text">最长前缀匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.11.</span> <span class="toc-text">地址解析协议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%BE%93%E5%B1%82"><span class="toc-number">2.</span> <span class="toc-text">运输层</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP-%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.1.</span> <span class="toc-text">TCP 服务模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UDP-%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.2.</span> <span class="toc-text">UDP 服务模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ICMP-%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.3.</span> <span class="toc-text">ICMP 服务模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%8E%9F%E5%88%99"><span class="toc-number">2.4.</span> <span class="toc-text">端到端原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E6%A3%80%E6%B5%8B"><span class="toc-number">2.5.</span> <span class="toc-text">错误检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA"><span class="toc-number">2.6.</span> <span class="toc-text">有限状态机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E6%8E%A7%E5%88%B6"><span class="toc-number">2.7.</span> <span class="toc-text">流控制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E4%BC%A0%E7%AD%96%E7%95%A5"><span class="toc-number">2.8.</span> <span class="toc-text">重传策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E5%BB%BA%E7%AB%8B%E4%B8%8E%E6%8B%86%E9%99%A4"><span class="toc-number">2.9.</span> <span class="toc-text">连接建立与拆除</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%85%E4%BA%A4%E6%8D%A2"><span class="toc-number">3.</span> <span class="toc-text">包交换</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%86%E5%8F%B2"><span class="toc-number">3.1.</span> <span class="toc-text">历史</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%AF%E5%88%B0%E7%AB%AF%E5%BB%B6%E8%BF%9F%E5%92%8C%E4%BC%A0%E6%92%AD%E5%BB%B6%E8%BF%9F"><span class="toc-number">3.2.</span> <span class="toc-text">端到端延迟和传播延迟</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%92%AD%E6%94%BE%E7%BC%93%E5%86%B2"><span class="toc-number">3.3.</span> <span class="toc-text">播放缓冲</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%A1%AE%E5%AE%9A%E6%80%A7%E6%8E%92%E9%98%9F%E6%A8%A1%E5%9E%8B"><span class="toc-number">3.4.</span> <span class="toc-text">简单确定性排队模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E9%98%9F%E6%A8%A1%E5%9E%8B%E5%B1%9E%E6%80%A7"><span class="toc-number">3.5.</span> <span class="toc-text">排队模型属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%A4%E6%8D%A2%E5%92%8C%E8%BD%AC%E5%8F%91"><span class="toc-number">3.6.</span> <span class="toc-text">交换和转发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AF%94%E7%8E%87%E4%BF%9D%E8%AF%81"><span class="toc-number">3.7.</span> <span class="toc-text">比率保证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%B6%E8%BF%9F%E4%BF%9D%E8%AF%81"><span class="toc-number">3.8.</span> <span class="toc-text">延迟保证</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%BB%E5%A1%9E%E6%8E%A7%E5%88%B6"><span class="toc-number">4.</span> <span class="toc-text">阻塞控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80"><span class="toc-number">4.1.</span> <span class="toc-text">基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95-AIMD-%E6%B5%81%E7%9A%84%E5%8A%A8%E6%80%81"><span class="toc-number">4.2.</span> <span class="toc-text">简单 AIMD 流的动态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E6%B5%81%E7%9A%84-AIMD"><span class="toc-number">4.3.</span> <span class="toc-text">多个流的 AIMD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP-Tahoe"><span class="toc-number">4.4.</span> <span class="toc-text">TCP Tahoe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP-Reno-%E5%92%8C-New-Reno"><span class="toc-number">4.5.</span> <span class="toc-text">TCP Reno 和 New Reno</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AIMD"><span class="toc-number">4.6.</span> <span class="toc-text">AIMD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RFC"><span class="toc-number">4.7.</span> <span class="toc-text">RFC</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%B1%82%E5%92%8C-NAT"><span class="toc-number">5.</span> <span class="toc-text">应用层和 NAT</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NAT-%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.1.</span> <span class="toc-text">NAT 类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BD%B1%E5%93%8D"><span class="toc-number">5.2.</span> <span class="toc-text">影响</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C"><span class="toc-number">5.3.</span> <span class="toc-text">操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP"><span class="toc-number">5.4.</span> <span class="toc-text">HTTP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP-1-1-%E4%BF%9D%E6%B4%BB"><span class="toc-number">5.5.</span> <span class="toc-text">HTTP&#x2F;1.1 保活</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BitTorrent"><span class="toc-number">5.6.</span> <span class="toc-text">BitTorrent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DNS"><span class="toc-number">5.7.</span> <span class="toc-text">DNS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DHCP"><span class="toc-number">5.8.</span> <span class="toc-text">DHCP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1"><span class="toc-number">6.</span> <span class="toc-text">路由</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%9B%E6%B4%AA%EF%BC%8C%E6%BA%90%E8%B7%AF%E7%94%B1%E5%92%8C%E7%94%9F%E6%88%90%E6%A0%91"><span class="toc-number">6.1.</span> <span class="toc-text">泛洪，源路由和生成树</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bellman-Ford-%E7%AE%97%E6%B3%95"><span class="toc-number">6.2.</span> <span class="toc-text">Bellman Ford 算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dijkstra-s-%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84%E4%BC%98%E5%85%88%E7%AE%97%E6%B3%95"><span class="toc-number">6.3.</span> <span class="toc-text">Dijkstra&#39;s 最短路径优先算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Internet-%E4%B8%AD%E7%9A%84%E8%B7%AF%E7%94%B1"><span class="toc-number">6.4.</span> <span class="toc-text">Internet 中的路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BGP"><span class="toc-number">6.5.</span> <span class="toc-text">BGP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E6%92%AD"><span class="toc-number">6.6.</span> <span class="toc-text">多播</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E6%A0%91%E5%8D%8F%E8%AE%AE"><span class="toc-number">6.7.</span> <span class="toc-text">生成树协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPv6"><span class="toc-number">6.8.</span> <span class="toc-text">IPv6</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E4%BD%8E%E7%9A%84%E5%B1%82%E7%BA%A7"><span class="toc-number">7.</span> <span class="toc-text">更低的层级</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E9%87%8F%E4%B8%8E%E8%B0%83%E5%88%B6"><span class="toc-number">7.1.</span> <span class="toc-text">容量与调制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%8D%E9%94%99%E8%AF%AF%E5%92%8C%E7%BC%96%E7%A0%81"><span class="toc-number">7.2.</span> <span class="toc-text">位错误和编码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%92%9F%E5%92%8C%E6%97%B6%E9%92%9F%E6%81%A2%E5%A4%8D"><span class="toc-number">7.3.</span> <span class="toc-text">时钟和时钟恢复</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%AC%E5%8F%91%E9%94%99%E8%AF%AF%E7%BA%A0%E6%AD%A3"><span class="toc-number">7.4.</span> <span class="toc-text">转发错误纠正</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CSMA-CD"><span class="toc-number">7.5.</span> <span class="toc-text">CSMA&#x2F;CD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A5%E5%A4%AA%E7%BD%91"><span class="toc-number">7.6.</span> <span class="toc-text">以太网</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E9%99%90%E7%BD%91%E7%BB%9C"><span class="toc-number">7.7.</span> <span class="toc-text">无限网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CSMA-CA"><span class="toc-number">7.8.</span> <span class="toc-text">CSMA&#x2F;CA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RTS-CTS"><span class="toc-number">7.9.</span> <span class="toc-text">RTS&#x2F;CTS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#802-11-%E6%A0%BC%E5%BC%8F%E5%92%8C%E5%BC%80%E9%94%80"><span class="toc-number">7.10.</span> <span class="toc-text">802.11 格式和开销</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A2%8E%E7%89%87%E5%8C%96"><span class="toc-number">7.11.</span> <span class="toc-text">碎片化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8"><span class="toc-number">8.</span> <span class="toc-text">安全</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">8.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%BB%E5%87%BB"><span class="toc-number">8.2.</span> <span class="toc-text">攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E5%B1%82%E6%94%BB%E5%87%BB"><span class="toc-number">8.3.</span> <span class="toc-text">第三层攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%9D%E5%AF%86%E6%80%A7"><span class="toc-number">8.4.</span> <span class="toc-text">保密性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E6%80%A7"><span class="toc-number">8.5.</span> <span class="toc-text">完整性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AC%E9%92%A5%E5%8A%A0%E5%AF%86"><span class="toc-number">8.6.</span> <span class="toc-text">公钥加密</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%81%E4%B9%A6"><span class="toc-number">8.7.</span> <span class="toc-text">证书</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TLS"><span class="toc-number">8.8.</span> <span class="toc-text">TLS</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="ft"><div class="ft-item-1"><div class="t-top"><div class="t-t-l"><p class="ft-t t-l-t">格言🧬</p><div class="bg-ad"><div>安得广厦千万间，大庇天下寒士俱欢颜，风雨不动安如山。</div></div></div><div class="t-t-r"><p class="ft-t t-l-t">猜你想看💡</p><ul class="ft-links"><li><a href="/comments/">留点什么</a><a href="/random/">随便逛逛</a></li><li><a href="/about/">关于</a><a href="/archives/">文章归档</a></li><li><a href="/categories/">文章分类</a><a href="/tags/">文章标签</a></li><li><a href="/gallery/">我的画廊</a><a href="/charts/">网站统计</a></li></ul></div></div></div></div><div class="copyright">&copy;2022 - 2024 By Aefrivern</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(async () => {
  const showKatex = () => {
    document.querySelectorAll('#article-container .katex').forEach(el => el.classList.add('katex-show'))
  }

  if (!window.katex_js_css) {
    window.katex_js_css = true
    await btf.getCSS('https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css')
    if (true) {
      await btf.getScript('https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js')
    }
  }

  showKatex()
})()</script></div><script async src="//at.alicdn.com/t/c/font_4031045_1yiosqv4vch.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      pjax.loadUrl('/404.html')
    }
  })
})()</script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/lite/builds/browser.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script></div></div><!-- hexo injector body_end start --><script async src="//at.alicdn.com/t/c/font_4031045_izvon5l4fr8.js"></script><!-- hexo injector body_end end --></body></html>