<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>全栈公开课（第一部分） | Aefrivern的小屋</title><meta name="author" content="Aefrivern"><meta name="copyright" content="Aefrivern"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Web app 基础 web 开发第一原则：始终打开控制台 可以在控制台查看网络信息 传统 web 应用：获取 html，获取 css，获取 JavaScript html 是树状的结构（DOM） 可以从控制台操作 DOM 接下来是 AJAX Asynchronous JavaScript and XML 时代 React 入门 React 简介 先安装 Node.js 创建应用：npm crea">
<meta property="og:type" content="article">
<meta property="og:title" content="全栈公开课（第一部分）">
<meta property="og:url" content="https://aefrivern.github.io/posts/320cf12b.html">
<meta property="og:site_name" content="Aefrivern的小屋">
<meta property="og:description" content="Web app 基础 web 开发第一原则：始终打开控制台 可以在控制台查看网络信息 传统 web 应用：获取 html，获取 css，获取 JavaScript html 是树状的结构（DOM） 可以从控制台操作 DOM 接下来是 AJAX Asynchronous JavaScript and XML 时代 React 入门 React 简介 先安装 Node.js 创建应用：npm crea">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://aefrivern.github.io/gallery/cover/%E5%85%A8%E6%A0%88%E5%85%AC%E5%BC%80%E8%AF%BE%EF%BC%88%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%89.webp">
<meta property="article:published_time" content="2023-12-27T00:17:22.000Z">
<meta property="article:modified_time" content="2024-11-23T06:15:53.000Z">
<meta property="article:author" content="Aefrivern">
<meta property="article:tag" content="赫尔辛基大学">
<meta property="article:tag" content="web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://aefrivern.github.io/gallery/cover/%E5%85%A8%E6%A0%88%E5%85%AC%E5%BC%80%E8%AF%BE%EF%BC%88%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%89.webp"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "全栈公开课（第一部分）",
  "url": "https://aefrivern.github.io/posts/320cf12b.html",
  "image": "https://aefrivern.github.io/gallery/cover/%E5%85%A8%E6%A0%88%E5%85%AC%E5%BC%80%E8%AF%BE%EF%BC%88%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%89.webp",
  "datePublished": "2023-12-27T00:17:22.000Z",
  "dateModified": "2024-11-23T06:15:53.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "Aefrivern",
      "url": "https://aefrivern.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/illustration/favicon.ico"><link rel="canonical" href="https://aefrivern.github.io/posts/320cf12b.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"GY5EJYJ1FS","apiKey":"c443c952672ec7062840aac45536181e","indexName":"blog","hitsPerPage":6,"languages":{"input_placeholder":"搜索文章","hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，耗时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '全栈公开课（第一部分）',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="//at.alicdn.com/t/c/font_4031045_1yiosqv4vch.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/highlight.css"><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/hexo-butterfly-article-double-row.css"><script src="/js/echarts.min.js"></script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><script>window.paceOptions = {
  restartOnPushState: false
}

btf.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')

</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="web_bg" style="background-image: url(/gallery/wallpaper/wallpaper.webp);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/%E5%A4%B4%E5%83%8F_%E7%81%B0%E5%A4%AA%E7%8B%BC.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">187</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">243</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-shouye-01"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw iconfont icon-guidang"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw iconfont icon-a-16-01-01"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw iconfont icon-wenjianjia"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/anime/"><i class="fa-fw iconfont icon-zhifeiji"></i><span> 二次元</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw iconfont icon-xiangce"></i><span> 画廊</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-guanyu"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/charts/"><i class="fa-fw iconfont icon-tongjichaxun"></i><span> 统计</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw iconfont icon-liuyan"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/random/"><i class="fa-fw iconfont icon-suiji"></i><span> 随便逛逛</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/gallery/cover/全栈公开课（第一部分）.webp);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Aefrivern的小屋</span></a><a class="nav-page-title" href="/"><span class="site-name">全栈公开课（第一部分）</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><svg class="meta_icon post-ui-icon" style="width:16px;height:16px;position:relative;top:3px"><use xlink:href="#icon-sousuo1"></use></svg><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-shouye-01"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw iconfont icon-guidang"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw iconfont icon-a-16-01-01"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw iconfont icon-wenjianjia"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/anime/"><i class="fa-fw iconfont icon-zhifeiji"></i><span> 二次元</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw iconfont icon-xiangce"></i><span> 画廊</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-guanyu"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page" href="/charts/"><i class="fa-fw iconfont icon-tongjichaxun"></i><span> 统计</span></a></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw iconfont icon-liuyan"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/random/"><i class="fa-fw iconfont icon-suiji"></i><span> 随便逛逛</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">全栈公开课（第一部分）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><svg class="meta_icon post-ui-icon" style="width:16px;height:16px;position:relative;top:3px"><use xlink:href="#icon-rili"></use></svg><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-12-27T00:17:22.000Z" title="发表于 2023-12-27 08:17:22">2023-12-27</time><span class="post-meta-separator">|</span><svg class="meta_icon post-ui-icon" style="width:13px;height:13px;position:relative;top:2px"><use xlink:href="#icon-gengxin"></use></svg><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-11-23T06:15:53.000Z" title="更新于 2024-11-23 14:15:53">2024-11-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><a class="faa-parent animated-hover"></a><svg class="meta_icon post-ui-icon" style="width:13px;height:13px;position:relative;top:2px"><use xlink:href="#icon-fenlei"></use></svg><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><svg class="meta_icon post-ui-icon" style="width:16px;height:16px;position:relative;top:3px"><use xlink:href="#icon-word"></use></svg><span class="post-meta-label">总字数:</span><span class="word-count">5465</span><span class="post-meta-separator">|</span><svg class="meta_icon post-ui-icon" style="width:16px;height:16px;position:relative;top:3px"><use xlink:href="#icon-shizhong"></use></svg><span class="post-meta-label">阅读时长:</span><span>27分钟</span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="Web-app-基础">Web app 基础</h2>
<p>web 开发第一原则：<strong>始终打开控制台</strong></p>
<p>可以在控制台查看网络信息</p>
<p>传统 web 应用：获取 html，获取 css，获取 JavaScript</p>
<p>html 是树状的结构（<strong>DOM</strong>）</p>
<p>可以从控制台操作 DOM</p>
<p>接下来是 <strong>AJAX Asynchronous JavaScript and XML</strong> 时代</p>
<h2 id="React-入门">React 入门</h2>
<h3 id="React-简介">React 简介</h3>
<p>先安装 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://nodejs.org/en">Node.js</a></p>
<p>创建应用：<code>npm create vite@latest part1 -- --template react</code></p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"></span>) =&gt; (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Hello world<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>);<br></code></pre></td></tr></table></figure>
<p>.jsx 文件看起来返回的是 HTML 标记，实际上底层转化为了 JavaScript</p>
<p>注意 JSX 的每个标签都必须关闭，即写成 <code>&lt;br /&gt;</code></p>
<p>使用 <code>props</code> 向组件传递数据</p>
<p>React 组件名称必须大写</p>
<p>React 组件内容需要包含一个根元素，故返回值的最外层通常要加上 <code>&lt;div&gt;&lt;/div&gt;</code> 或 <code>&lt;&gt;&lt;/&gt;</code></p>
<h3 id="组件状态，事件处理">组件状态，事件处理</h3>
<p>可以在组件内部定义助手函数</p>
<p>结构可用于参数传递时，如</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> <span class="hljs-title function_">Hello</span> = (<span class="hljs-params">&#123; name, age &#125;</span>) =&gt; &#123;&#125;;<br></code></pre></td></tr></table></figure>
<p>状态钩子的用法：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> [counter, setCounter] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">setCounter</span>(counter + <span class="hljs-number">1</span>), <span class="hljs-number">1000</span>);<br>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;counter&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;<br>&#125;;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>;<br></code></pre></td></tr></table></figure>
<p>事件处理：注意要求的事件处理器是对函数的引用</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> [counter, setCounter] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;clicked&#x27;</span>);<br>  &#125;;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&#123;counter&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleClick&#125;</span>&gt;</span>plus<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br></code></pre></td></tr></table></figure>
<h3 id="深入-React-应用调试">深入 React 应用调试</h3>
<p>复杂状态：可以使用对象或数组作为状态</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> [clicks, setClicks] = <span class="hljs-title function_">useState</span>(&#123; <span class="hljs-attr">left</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">0</span> &#125;);<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleLeftClick</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-title function_">setClicks</span>(&#123; ...clicks, <span class="hljs-attr">left</span>: clicks.<span class="hljs-property">left</span> + <span class="hljs-number">1</span> &#125;);<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleRightClick</span> = (<span class="hljs-params"></span>) =&gt;<br>    <span class="hljs-title function_">setClicks</span>(&#123; ...clicks, <span class="hljs-attr">right</span>: clicks.<span class="hljs-property">right</span> + <span class="hljs-number">1</span> &#125;);<br><br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      &#123;clicks.left&#125;</span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleLeftClick&#125;</span>&gt;</span>left<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;handleRightClick&#125;</span>&gt;</span>right<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      &#123;clicks.right&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br></code></pre></td></tr></table></figure>
<p><code>useState</code> 函数<strong>只能</strong>直接在 component 中定义</p>
<h2 id="与服务端通信">与服务端通信</h2>
<h3 id="从渲染集合到模块学习">从渲染集合到模块学习</h3>
<p>可以使用 <code>map</code> 函数从数组中生成渲染对象，注意要有 key 属性</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript">notes.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">note</span>) =&gt;</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;note.id&#125;</span>&gt;</span>&#123;note.content&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span>);<br></code></pre></td></tr></table></figure>
<h3 id="表单">表单</h3>
<p>输入框处理：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params">props</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> [newNote, setNewNote] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">&#x27;a new note...&#x27;</span>);<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleNoteChange</span> = (<span class="hljs-params">event</span>) =&gt; &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>);<br>    <span class="hljs-title function_">setNewNote</span>(event.<span class="hljs-property">target</span>.<span class="hljs-property">value</span>);<br>  &#125;;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">&#123;addNote&#125;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;newNote&#125;</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">&#123;handleNoteChange&#125;</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&#x27;submit&#x27;</span>&gt;</span>save<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br></code></pre></td></tr></table></figure>
<h3 id="从服务器获取数据">从服务器获取数据</h3>
<p>使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/typicode/json-server">json-server</a>，安装为开发依赖项：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">npm install json-server --save-dev<br></code></pre></td></tr></table></figure>
<p>在 <code>package.json</code> 文件的 <code>scripts</code> 部分做一个小小的补充：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;server&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;json-server -p3001 --watch db.json&quot;</span><br></code></pre></td></tr></table></figure>
<p>数据存储在 <code>db.json</code> 中</p>
<p>使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/axios/axios">axios</a> 库来代替浏览器和服务器之间的通信</p>
<p>effect hook 可以对函数组件进行副作用</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;effect&#x27;</span>);<br>  axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;http://localhost:3001/notes&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;promise fulfilled&#x27;</span>);<br>    <span class="hljs-title function_">setNotes</span>(response.<span class="hljs-property">data</span>);<br>  &#125;);<br>&#125;, []);<br></code></pre></td></tr></table></figure>
<p><code>useEffect</code> 第二个参数用于指定效果的运行频率，这里使用 <code>[]</code> 表示只在第一次渲染时运行</p>
<h3 id="在服务端将数据-Alert-出来">在服务端将数据 Alert 出来</h3>
<p>json-server 比较接近 RESTful 的 API</p>
<p>在 REST 中，把单个数据对象称作资源，可以通过 <code>note/3</code> 找到一个单独的笔记，其中 <code>3</code> 表示该笔记的 id</p>
<p>json-server 的所有数据用 json 格式发送</p>
<p>向服务器发送数据：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript">addNote = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> &#123;<br>  event.<span class="hljs-title function_">preventDefault</span>();<br>  <span class="hljs-keyword">const</span> noteObject = &#123;<br>    <span class="hljs-attr">content</span>: newNote,<br>    <span class="hljs-attr">date</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(),<br>    <span class="hljs-attr">important</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &gt; <span class="hljs-number">0.5</span>,<br>  &#125;;<br><br>  axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;http://localhost:3001/notes&#x27;</span>, noteObject).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> &#123;<br>    <span class="hljs-title function_">setNotes</span>(notes.<span class="hljs-title function_">concat</span>(response.<span class="hljs-property">data</span>));<br>    <span class="hljs-title function_">setNewNote</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>  &#125;);<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>使用 HTTP PUT 请求来替换整个笔记：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">toggleImportanceOf</span> = (<span class="hljs-params">id</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> url = <span class="hljs-string">`http://localhost:3001/notes/<span class="hljs-subst">$&#123;id&#125;</span>`</span>;<br>  <span class="hljs-keyword">const</span> note = notes.<span class="hljs-title function_">find</span>(<span class="hljs-function">(<span class="hljs-params">n</span>) =&gt;</span> n.<span class="hljs-property">id</span> === id);<br>  <span class="hljs-keyword">const</span> changedNote = &#123; ...note, <span class="hljs-attr">important</span>: !note.<span class="hljs-property">important</span> &#125;;<br><br>  axios.<span class="hljs-title function_">put</span>(url, changedNote).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> &#123;<br>    <span class="hljs-title function_">setNotes</span>(notes.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">note</span>) =&gt;</span> (note.<span class="hljs-property">id</span> !== id ? note : response.<span class="hljs-property">data</span>)));<br>  &#125;);<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>将其分离成一个单独的模块：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;axios&#x27;</span>;<br><span class="hljs-keyword">const</span> baseUrl = <span class="hljs-string">&#x27;http://localhost:3001/notes&#x27;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">getAll</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> request = axios.<span class="hljs-title function_">get</span>(baseUrl);<br>  <span class="hljs-keyword">return</span> request.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> response.<span class="hljs-property">data</span>);<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">create</span> = (<span class="hljs-params">newObject</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> request = axios.<span class="hljs-title function_">post</span>(baseUrl, newObject);<br>  <span class="hljs-keyword">return</span> request.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> response.<span class="hljs-property">data</span>);<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">update</span> = (<span class="hljs-params">id, newObject</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> request = axios.<span class="hljs-title function_">put</span>(<span class="hljs-string">`<span class="hljs-subst">$&#123;baseUrl&#125;</span>/<span class="hljs-subst">$&#123;id&#125;</span>`</span>, newObject);<br>  <span class="hljs-keyword">return</span> request.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> response.<span class="hljs-property">data</span>);<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123; getAll, create, update &#125;;<br></code></pre></td></tr></table></figure>
<p>直接调用：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    noteService.<span class="hljs-title function_">getAll</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">initialNotes</span>) =&gt;</span> &#123;<br>      <span class="hljs-title function_">setNotes</span>(initialNotes);<br>    &#125;);<br>  &#125;, []);<br><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">toggleImportanceOf</span> = (<span class="hljs-params">id</span>) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> note = notes.<span class="hljs-title function_">find</span>(<span class="hljs-function">(<span class="hljs-params">n</span>) =&gt;</span> n.<span class="hljs-property">id</span> === id);<br>    <span class="hljs-keyword">const</span> changedNote = &#123; ...note, <span class="hljs-attr">important</span>: !note.<span class="hljs-property">important</span> &#125;;<br>    noteService.<span class="hljs-title function_">update</span>(id, changedNote).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">returnedNote</span>) =&gt;</span> &#123;<br>      <span class="hljs-title function_">setNotes</span>(notes.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">note</span>) =&gt;</span> (note.<span class="hljs-property">id</span> !== id ? note : returnedNote)));<br>    &#125;);<br>  &#125;;<br><br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">addNote</span> = (<span class="hljs-params">event</span>) =&gt; &#123;<br>    event.<span class="hljs-title function_">preventDefault</span>();<br>    <span class="hljs-keyword">const</span> noteObject = &#123;<br>      <span class="hljs-attr">content</span>: newNote,<br>      <span class="hljs-attr">date</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>(),<br>      <span class="hljs-attr">important</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &gt; <span class="hljs-number">0.5</span>,<br>    &#125;;<br>    noteService.<span class="hljs-title function_">create</span>(noteObject).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">returnedNote</span>) =&gt;</span> &#123;<br>      <span class="hljs-title function_">setNotes</span>(notes.<span class="hljs-title function_">concat</span>(returnedNote));<br>      <span class="hljs-title function_">setNewNote</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>    &#125;);<br>  &#125;;<br>&#125;;<br></code></pre></td></tr></table></figure>
<h3 id="给-React-应用加点样式">给 React 应用加点样式</h3>
<p>除了定义另外一个 css 文件并引入的方法外，还支持内联样式</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> <span class="hljs-title function_">Footer</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> footerStyle = &#123;<br>    <span class="hljs-attr">color</span>: <span class="hljs-string">&#x27;green&#x27;</span>,<br>    <span class="hljs-attr">fontStyle</span>: <span class="hljs-string">&#x27;italic&#x27;</span>,<br>    <span class="hljs-attr">fontSize</span>: <span class="hljs-number">16</span>,<br>  &#125;;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;footerStyle&#125;</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span></span><br><span class="language-xml">        Note app, Department of Computer Science, University of Helsinki 2022</span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br></code></pre></td></tr></table></figure>
<h2 id="用-NodeJS-和-Express-写服务端程序">用 NodeJS 和 Express 写服务端程序</h2>
<h3 id="Node-js-与-Express">Node.js 与 Express</h3>
<p>可以在 package.json 文件中写脚本，并 <code>npm run 脚本名</code> 运行</p>
<figure class="highlight json"><table><tr><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;start&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;node index.js&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;test&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br></code></pre></td></tr></table></figure>
<p>这里使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/expressjs/express">express</a> 库的接口：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>)<br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>()<br><span class="hljs-keyword">let</span> notes = [...]<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">request, response</span>) =&gt;</span> &#123; response.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;&lt;h1&gt;Hello World!&lt;/h1&gt;&#x27;</span>) &#125;)<br><br>app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/notes&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">request, response</span>) =&gt;</span> &#123; response.<span class="hljs-title function_">json</span>(notes) &#125;)<br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = <span class="hljs-number">3001</span><br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-function">() =&gt;</span> &#123; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Server running on port <span class="hljs-subst">$&#123;PORT&#125;</span>`</span>) &#125;)<br></code></pre></td></tr></table></figure>
<p>使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/remy/nodemon">nodemon</a> 可以在代码修改后自动重启服务器</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">npm install --save-dev nodemon<br></code></pre></td></tr></table></figure>
<p>REST API：</p>
<table>
<thead>
<tr>
<th style="text-align:left">URL</th>
<th style="text-align:left">动作</th>
<th style="text-align:left">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">notes/10</td>
<td style="text-align:left">GET</td>
<td style="text-align:left">获取一个资源</td>
</tr>
<tr>
<td style="text-align:left">notes</td>
<td style="text-align:left">GET</td>
<td style="text-align:left">获取集合中所有的资源</td>
</tr>
<tr>
<td style="text-align:left">notes</td>
<td style="text-align:left">POST</td>
<td style="text-align:left">基于 request data 创建新的资源</td>
</tr>
<tr>
<td style="text-align:left">notes/10</td>
<td style="text-align:left">DELETE</td>
<td style="text-align:left">移除该资源</td>
</tr>
<tr>
<td style="text-align:left">notes/10</td>
<td style="text-align:left">PUT</td>
<td style="text-align:left">用 request data 替代该资源</td>
</tr>
<tr>
<td style="text-align:left">notes/10</td>
<td style="text-align:left">PATCH</td>
<td style="text-align:left">用 request data 替代该资源的一部分</td>
</tr>
</tbody>
</table>
<p>获取单独的资源：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/notes/:id&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">request, response</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> id = <span class="hljs-title class_">Number</span>(request.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>);<br>  <span class="hljs-keyword">const</span> note = notes.<span class="hljs-title function_">find</span>(<span class="hljs-function">(<span class="hljs-params">note</span>) =&gt;</span> note.<span class="hljs-property">id</span> === id);<br>  response.<span class="hljs-title function_">json</span>(note);<br>&#125;);<br></code></pre></td></tr></table></figure>
<p>删除资源：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript">app.<span class="hljs-title function_">delete</span>(<span class="hljs-string">&#x27;/api/notes/:id&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">request, response</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> id = <span class="hljs-title class_">Number</span>(request.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>);<br>  notes = notes.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">note</span>) =&gt;</span> note.<span class="hljs-property">id</span> !== id);<br>  response.<span class="hljs-title function_">status</span>(<span class="hljs-number">204</span>).<span class="hljs-title function_">end</span>();<br>&#125;);<br></code></pre></td></tr></table></figure>
<p>vscode 可以装 REST client 插件测试</p>
<p>接收数据要加入 json 解释器：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript">app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>()); <span class="hljs-comment">// 加入 json 解释器</span><br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">generateId</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> maxId = notes.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> ? <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(...notes.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">n</span>) =&gt;</span> n.<span class="hljs-property">id</span>)) : <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">return</span> maxId + <span class="hljs-number">1</span>;<br>&#125;;<br><br>app.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/api/notes&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">request, response</span>) =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> body = request.<span class="hljs-property">body</span>;<br>  <span class="hljs-keyword">if</span> (!body.<span class="hljs-property">content</span>)<br>    <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">error</span>: <span class="hljs-string">&#x27;content missing&#x27;</span> &#125;);<br><br>  <span class="hljs-keyword">const</span> note = &#123;<br>    <span class="hljs-attr">content</span>: body.<span class="hljs-property">content</span>,<br>    <span class="hljs-attr">important</span>: body.<span class="hljs-property">important</span> || <span class="hljs-literal">false</span>,<br>    <span class="hljs-attr">date</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(),<br>    <span class="hljs-attr">id</span>: <span class="hljs-title function_">generateId</span>(),<br>  &#125;;<br><br>  notes = notes.<span class="hljs-title function_">concat</span>(note);<br>  response.<span class="hljs-title function_">json</span>(note);<br>&#125;);<br></code></pre></td></tr></table></figure>
<p>注意 REST 测试时要指明数据类型：</p>
<figure class="highlight http"><table><tr><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">http://localhost:3001/api/notes/</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">content-type</span><span class="hljs-punctuation">: </span>application/json<br><br><span class="language-json"><span class="hljs-punctuation">&#123;</span></span><br><span class="language-json">    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sample&quot;</span><span class="hljs-punctuation">,</span></span><br><span class="language-json">    <span class="hljs-attr">&quot;time&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Wed, 21 Oct 2015 18:27:50 GMT&quot;</span></span><br><span class="language-json"><span class="hljs-punctuation">&#125;</span></span><br></code></pre></td></tr></table></figure>
<p>json-parser 是一个<strong>中间件</strong>，可以用来处理 request 和 response 的函数</p>
<h3 id="把应用部署到网上">把应用部署到网上</h3>
<p>因为一些跨域请求默认是被禁止的，故可以使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/expressjs/cors">cors</a> 中间件来运行其他来源的请求</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> cors = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;cors&#x27;</span>);<br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>());<br></code></pre></td></tr></table></figure>
<p>部署后端</p>
<p>部署前端：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;build:ui&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rm -rf build &amp;&amp; cd ../part2-notes/ &amp;&amp; npm run build &amp;&amp; cp -r build ../notes-backend&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;deploy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;git push heroku main&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;deploy:full&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;npm run build:ui &amp;&amp; git add . &amp;&amp; git commit -m uibuild &amp;&amp; npm run deploy&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;logs:prod&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;heroku logs --tail&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
<p>因为前端修改为了相对路径（前端和后端部署在了一起），故无法在本地调试前端，可以在本地添加一个代理：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;proxy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://localhost:3001&quot;</span><br></code></pre></td></tr></table></figure>
<h3 id="将数据存入-MongoDB">将数据存入 MongoDB</h3>
<p>使用的数据库为 MongoDB，常用的服务提供商是 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.mongodb.com/atlas/database">MongoDB Atlas</a></p>
<p>使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/Automattic/mongoose">mongoose</a> 库，其提供了一个更高级别的 API</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;mongoose&#x27;</span>);<br><br><span class="hljs-keyword">const</span> password = process.<span class="hljs-property">argv</span>[<span class="hljs-number">2</span>];<br><br><span class="hljs-keyword">const</span> url = <span class="hljs-string">`mongodb+srv://fullstack:<span class="hljs-subst">$&#123;password&#125;</span>@cluster0.o1opl.mongodb.net/myFirstDatabase?retryWrites=true&amp;w=majority`</span>;<br><br>mongoose.<span class="hljs-title function_">connect</span>(url);<br><br><span class="hljs-comment">// 定义模式</span><br><span class="hljs-keyword">const</span> noteSchema = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Schema</span>(&#123;<br>  <span class="hljs-attr">content</span>: <span class="hljs-title class_">String</span>,<br>  <span class="hljs-attr">date</span>: <span class="hljs-title class_">Date</span>,<br>  <span class="hljs-attr">important</span>: <span class="hljs-title class_">Boolean</span>,<br>&#125;);<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">Note</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Note&#x27;</span>, noteSchema); <span class="hljs-comment">// 创建模型</span><br><br><span class="hljs-comment">// 创建一个新的对象（使用构造函数）</span><br><span class="hljs-keyword">const</span> note = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Note</span>(&#123;<br>  <span class="hljs-attr">content</span>: <span class="hljs-string">&#x27;HTML is Easy&#x27;</span>,<br>  <span class="hljs-attr">date</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(),<br>  <span class="hljs-attr">important</span>: <span class="hljs-literal">true</span>,<br>&#125;);<br><br><span class="hljs-comment">// 将对象保存到数据库</span><br>note.<span class="hljs-title function_">save</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;note saved!&#x27;</span>);<br>  mongoose.<span class="hljs-property">connection</span>.<span class="hljs-title function_">close</span>();<br>&#125;);<br><br><span class="hljs-comment">// 从数据库中获取对象</span><br><span class="hljs-title class_">Note</span>.<span class="hljs-title function_">find</span>(&#123;&#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> &#123;<br>  result.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">note</span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(note);<br>  &#125;);<br>  mongoose.<span class="hljs-property">connection</span>.<span class="hljs-title function_">close</span>();<br>&#125;);<br></code></pre></td></tr></table></figure>
<p>可以修改模式的 <code>toJSON</code> 方法：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript">noteSchema.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;toJSON&#x27;</span>, &#123;<br>  <span class="hljs-attr">transform</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-variable language_">document</span>, returnedObject</span>) =&gt;</span> &#123;<br>    returnedObject.<span class="hljs-property">id</span> = returnedObject.<span class="hljs-property">_id</span>.<span class="hljs-title function_">toString</span>();<br>    <span class="hljs-keyword">delete</span> returnedObject.<span class="hljs-property">_id</span>;<br>    <span class="hljs-keyword">delete</span> returnedObject.<span class="hljs-property">__v</span>;<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>
<p>一般使用环境变量，安装 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/motdotla/dotenv">dotenv</a> 库</p>
<p>在 .env 文件中加入</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs env">MONGODB_URI=mongodb+srv://fullstack:&lt;password&gt;@cluster0.o1opl.mongodb.net/noteApp?retryWrites=true&amp;w=majority<br>PORT=3001<br></code></pre></td></tr></table></figure>
<p>该文件的信息的使用方法：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;dotenv&#x27;</span>).<span class="hljs-title function_">config</span>();<br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">PORT</span>;<br>app.<span class="hljs-title function_">listen</span>(<span class="hljs-variable constant_">PORT</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Server running on port <span class="hljs-subst">$&#123;PORT&#125;</span>`</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>
<p>mongoose 有 <code>findById</code> 方法，获取一个单独的笔记方法如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/notes/:id&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">request, response</span>) =&gt;</span> &#123;<br>  <span class="hljs-title class_">Note</span>.<span class="hljs-title function_">findById</span>(request.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">note</span>) =&gt;</span> &#123;<br>    response.<span class="hljs-title function_">json</span>(note);<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure>
<p><code>findByIdAndDelete</code> 和 <code>findByIdAndUpdate</code> 等同理</p>
<p>最好在每个 <code>.then</code> 块之后使用 <code>.catch</code> 捕捉异常：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript">.<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error)<br>  response.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">error</span>: <span class="hljs-string">&#x27;malformatted id&#x27;</span> &#125;)<br>&#125;)<br></code></pre></td></tr></table></figure>
<p>可以进一步把错误处理程序封装到一个中间件：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript">app.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/notes/:id&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">request, response, next</span>) =&gt;</span> &#123;<br>  <span class="hljs-title class_">Note</span>.<span class="hljs-title function_">findById</span>(request.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>)<br>    .<span class="hljs-title function_">then</span>()<br>    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> <span class="hljs-title function_">next</span>(error));<br>&#125;);<br></code></pre></td></tr></table></figure>
<p>我们的错误处理程序如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">errorHandler</span> = (<span class="hljs-params">error, request, response, next</span>) =&gt; &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error.<span class="hljs-property">message</span>);<br>  <span class="hljs-keyword">if</span> (error.<span class="hljs-property">name</span> === <span class="hljs-string">&#x27;CastError&#x27;</span>)<br>    <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">error</span>: <span class="hljs-string">&#x27;malformatted id&#x27;</span> &#125;);<br>  <span class="hljs-title function_">next</span>(error);<br>&#125;;<br><br><span class="hljs-comment">// 这必须是最后一个载入的中间件。</span><br>app.<span class="hljs-title function_">use</span>(errorHandler);<br></code></pre></td></tr></table></figure>
<h3 id="ESLint-与代码检查">ESLint 与代码检查</h3>
<p>可以使用 Mongoose 中的验证功能来检查输入格式是否正确：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> noteSchema = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Schema</span>(&#123;<br>  <span class="hljs-attr">content</span>: &#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,<br>    <span class="hljs-attr">minLength</span>: <span class="hljs-number">5</span>,<br>    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,<br>  &#125;,<br>  <span class="hljs-attr">date</span>: &#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Date</span>,<br>    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,<br>  &#125;,<br>  <span class="hljs-attr">important</span>: <span class="hljs-title class_">Boolean</span>,<br>&#125;);<br></code></pre></td></tr></table></figure>
<p>中间件可以添加一些信息：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">errorHandler</span> = (<span class="hljs-params">error, request, response, next</span>) =&gt; &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error.<span class="hljs-property">message</span>);<br>  <span class="hljs-keyword">if</span> (error.<span class="hljs-property">name</span> === <span class="hljs-string">&#x27;CastError&#x27;</span>)<br>    <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">error</span>: <span class="hljs-string">&#x27;malformatted id&#x27;</span> &#125;);<br>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">name</span> === <span class="hljs-string">&#x27;ValidationError&#x27;</span>)<br>    <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">status</span>(<span class="hljs-number">400</span>).<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">error</span>: error.<span class="hljs-property">message</span> &#125;);<br>  <span class="hljs-title function_">next</span>(error);<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>注意 <code>findOneAndUpdate</code> 不会自动验证，可以显示指定：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Note</span>.<span class="hljs-title function_">findByIdAndUpdate</span>(request.<span class="hljs-property">params</span>.<span class="hljs-property">id</span>, request.<span class="hljs-property">body</span>, &#123;<br>  <span class="hljs-attr">new</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">runValidators</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">context</span>: <span class="hljs-string">&#x27;query&#x27;</span>,<br>&#125;);<br></code></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://eslint.org/">ESlint</a> 是 JavaScript 的静态分析工具</p>
<p>初始化一个默认的 ESlint 配置：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">npx eslint --init<br></code></pre></td></tr></table></figure>
<p>该配置保存在 <code>.eslintrc.js</code> 文件中，<code>.eslintignore</code> 文件保存忽略的文件</p>
<p>创建单独的脚本进行 <code>linting</code></p>
<figure class="highlight json"><table><tr><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;lint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;eslint .&quot;</span><br></code></pre></td></tr></table></figure>
<h2 id="测试-Express-服务端程序-以及用户管理">测试 Express 服务端程序, 以及用户管理</h2>
<h3 id="从后端结构到测试入门">从后端结构到测试入门</h3>
<p>项目的结构一般如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><code class="hljs file">├── index.js<br>├── app.js<br>├── build<br>│   └── ...<br>├── controllers<br>│   └── notes.js<br>├── models<br>│   └── note.js<br>├── package-lock.json<br>├── package.json<br>├── utils<br>│   ├── config.js<br>│   ├── logger.js<br>│   └── middleware.js<br></code></pre></td></tr></table></figure>
<p><code>utils/logger.js</code> 文件中存放打印模块：</p>
<figure class="highlight javascript"><figcaption><span>utils/logger.js</span></figcaption><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">info</span> = (<span class="hljs-params">...params</span>) =&gt; &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(...params);<br>&#125;;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">error</span> = (<span class="hljs-params">...params</span>) =&gt; &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(...params);<br>&#125;;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123; info, error &#125;;<br></code></pre></td></tr></table></figure>
<p><code>utils/config.js</code> 文件中处理环境变量：</p>
<figure class="highlight javascript"><figcaption><span>utils/config.js</span></figcaption><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;dotenv&#x27;</span>).<span class="hljs-title function_">config</span>();<br><br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PORT</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">PORT</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">MONGODB_URI</span> = process.<span class="hljs-property">env</span>.<span class="hljs-property">MONGODB_URI</span>;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123; <span class="hljs-variable constant_">MONGODB_URI</span>, <span class="hljs-variable constant_">PORT</span> &#125;;<br></code></pre></td></tr></table></figure>
<p><code>utils/middleware.js</code> 模块中是自定义的中间件：</p>
<figure class="highlight javascript"><figcaption><span>utils/middleware.js</span></figcaption><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> logger = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./logger&#x27;</span>)<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">requestLogger</span> = (<span class="hljs-params">request, response, next</span>) =&gt; &#123;...&#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">unknownEndpoint</span> = (<span class="hljs-params">request, response</span>) =&gt; &#123; response.<span class="hljs-title function_">status</span>(<span class="hljs-number">404</span>).<span class="hljs-title function_">send</span>(&#123; <span class="hljs-attr">error</span>: <span class="hljs-string">&#x27;unknown endpoint&#x27;</span> &#125;) &#125;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">errorHandler</span> = (<span class="hljs-params">error, request, response, next</span>) =&gt; &#123;...&#125;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123; requestLogger, unknownEndpoint, errorHandler &#125;<br></code></pre></td></tr></table></figure>
<p>与 <code>notes</code> 相关的路由现在都在 <code>controllers/notes.js</code> 模块中：</p>
<figure class="highlight javascript"><figcaption><span>controllers/notes.js</span></figcaption><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> notesRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>).<span class="hljs-title class_">Router</span>()<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">Note</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../models/note&#x27;</span>)<br><br>notesRouter.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">request, response</span>) =&gt;</span> &#123;...&#125;)<br>notesRouter.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/:id&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">request, response, next</span>) =&gt;</span> &#123;...&#125;)<br>notesRouter.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">request, response, next</span>) =&gt;</span> &#123;...&#125;)<br>notesRouter.<span class="hljs-title function_">delete</span>(<span class="hljs-string">&#x27;/:id&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">request, response, next</span>) =&gt;</span> &#123;...&#125;)<br>notesRouter.<span class="hljs-title function_">put</span>(<span class="hljs-string">&#x27;/:id&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">request, response, next</span>) =&gt;</span> &#123;...&#125;)<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = notesRouter<br></code></pre></td></tr></table></figure>
<p>这些路由对象相当于是中间件，注意 <code>/api/notes/:id</code> 被缩短为了 <code>/:id</code></p>
<p><code>models/note.js</code> 文件定义了 Mongoose 模式：</p>
<figure class="highlight javascript"><figcaption><span>models/note.js</span></figcaption><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;mongoose&#x27;</span>)<br><br><span class="hljs-keyword">const</span> noteSchema = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Schema</span>(&#123;...&#125;)<br><br>noteSchema.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;toJSON&#x27;</span>, &#123;...&#125;)<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = mongoose.<span class="hljs-title function_">model</span>(<span class="hljs-string">&#x27;Note&#x27;</span>, noteSchema)<br></code></pre></td></tr></table></figure>
<p><code>index.js</code> 文件用于启动应用：</p>
<figure class="highlight javascript"><figcaption><span>index.js</span></figcaption><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> app = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./app&#x27;</span>); <span class="hljs-comment">// the actual Express application</span><br><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http&#x27;</span>);<br><span class="hljs-keyword">const</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./utils/config&#x27;</span>);<br><span class="hljs-keyword">const</span> logger = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./utils/logger&#x27;</span>);<br><br><span class="hljs-keyword">const</span> server = http.<span class="hljs-title function_">createServer</span>(app);<br><br>server.<span class="hljs-title function_">listen</span>(config.<span class="hljs-property">PORT</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Server running on port <span class="hljs-subst">$&#123;config.PORT&#125;</span>`</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>
<p><code>app.js</code> 使用到了大量的中间件：</p>
<figure class="highlight javascript"><figcaption><span>app.js</span></figcaption><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./utils/config&#x27;</span>);<br><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);<br><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();<br><span class="hljs-keyword">const</span> cors = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;cors&#x27;</span>);<br><span class="hljs-keyword">const</span> notesRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./controllers/notes&#x27;</span>);<br><span class="hljs-keyword">const</span> middleware = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./utils/middleware&#x27;</span>);<br><span class="hljs-keyword">const</span> logger = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./utils/logger&#x27;</span>);<br><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;mongoose&#x27;</span>);<br><br>logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">&#x27;connecting to&#x27;</span>, config.<span class="hljs-property">MONGODB_URI</span>);<br><br>mongoose.<span class="hljs-title function_">connect</span>(config.<span class="hljs-property">MONGODB_URI</span>);<br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>());<br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">static</span>(<span class="hljs-string">&#x27;build&#x27;</span>));<br>app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">json</span>());<br>app.<span class="hljs-title function_">use</span>(middleware.<span class="hljs-property">requestLogger</span>);<br><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-string">&#x27;/api/notes&#x27;</span>, notesRouter);<br><br>app.<span class="hljs-title function_">use</span>(middleware.<span class="hljs-property">unknownEndpoint</span>);<br>app.<span class="hljs-title function_">use</span>(middleware.<span class="hljs-property">errorHandler</span>);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = app;<br></code></pre></td></tr></table></figure>
<p><code>utils/for_testing.js</code> 存放自动化测试文件，如</p>
<figure class="highlight javascript"><figcaption><span>utils/for_testing.js</span></figcaption><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">reverse</span> = (<span class="hljs-params">string</span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> string.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;&#x27;</span>).<span class="hljs-title function_">reverse</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">&#x27;&#x27;</span>);<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">average</span> = (<span class="hljs-params">array</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">reducer</span> = (<span class="hljs-params">sum, item</span>) =&gt; &#123;<br>    <span class="hljs-keyword">return</span> sum + item;<br>  &#125;;<br>  <span class="hljs-keyword">return</span> array.<span class="hljs-title function_">reduce</span>(reducer, <span class="hljs-number">0</span>) / array.<span class="hljs-property">length</span>;<br>&#125;;<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123; reverse, average &#125;;<br></code></pre></td></tr></table></figure>
<p>这里使用 node 的内置测试库 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://nodejs.org/docs/latest/api/test.html">node:test</a></p>
<p>定义 npm test：</p>
<figure class="highlight json"><figcaption><span>package.json</span></figcaption><table><tr><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;test&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;node --test&quot;</span><br></code></pre></td></tr></table></figure>
<p>测试文件在 <code>test/reverse.test.js</code> 中：</p>
<figure class="highlight javascript"><figcaption><span>test/reverse.test.js</span></figcaption><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> &#123; test &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;node:test&#x27;</span>);<br><span class="hljs-keyword">const</span> assert = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;node:assert&#x27;</span>);<br><br><span class="hljs-keyword">const</span> reverse = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../utils/for_testing&#x27;</span>).<span class="hljs-property">reverse</span>;<br><br><span class="hljs-title function_">test</span>(<span class="hljs-string">&#x27;reverse of a&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">reverse</span>(<span class="hljs-string">&#x27;a&#x27;</span>);<br>  assert.<span class="hljs-title function_">strictEqual</span>(result, <span class="hljs-string">&#x27;a&#x27;</span>);<br>&#125;);<br></code></pre></td></tr></table></figure>
<h3 id="测试后端应用">测试后端应用</h3>
<p>使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/kentcdodds/cross-env">cross-env</a> 包来实现跨平台兼容，并使用 <code>NODE_ENV</code> 环境变量来定义应用的执行模式：</p>
<figure class="highlight json"><figcaption><span>package.json</span></figcaption><table><tr><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;start&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;cross-env NODE_ENV=production node index.js&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;dev&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;cross-env NODE_ENV=development nodemon index.js&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;test&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;cross-env NODE_ENV=test jest --verbose --runInBand&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br></code></pre></td></tr></table></figure>
<p>为测试设置单独的数据库：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">MONGODB_URI</span> =<br>  process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">&#x27;test&#x27;</span><br>    ? process.<span class="hljs-property">env</span>.<span class="hljs-property">TEST_MONGODB_URI</span><br>    : process.<span class="hljs-property">env</span>.<span class="hljs-property">MONGODB_URI</span>;<br></code></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">TEST_MONGODB_URI=mongodb+srv://fullstack:&lt;password&gt;@cluster0.o1opl.mongodb.net/testNoteApp?retryWrites=<span class="hljs-literal">true</span>&amp;w=majority<br></code></pre></td></tr></table></figure>
<p>使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/ladjs/supertest">supertest</a> 包测试 API</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> mongoose = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;mongoose&#x27;</span>);<br><span class="hljs-keyword">const</span> supertest = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;supertest&#x27;</span>);<br><span class="hljs-keyword">const</span> app = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../app&#x27;</span>);<br><br><span class="hljs-keyword">const</span> api = supertest(app);<br><br><span class="hljs-title function_">test</span>(<span class="hljs-string">&#x27;notes are returned as json&#x27;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>  <span class="hljs-keyword">await</span> api<br>    .<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/api/notes&#x27;</span>)<br>    .<span class="hljs-title function_">expect</span>(<span class="hljs-number">200</span>)<br>    .<span class="hljs-title function_">expect</span>(<span class="hljs-string">&#x27;Content-Type&#x27;</span>, <span class="hljs-regexp">/application\/json/</span>);<br>&#125;);<br><br><span class="hljs-comment">// 在所有测试完成后关闭连接</span><br><span class="hljs-title function_">afterAll</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  mongoose.<span class="hljs-property">connection</span>.<span class="hljs-title function_">close</span>();<br>&#125;);<br></code></pre></td></tr></table></figure>
<p><code>expect(response.body).toHaveLength(2)</code> 和 <code>expect(response.body[0].content).toBe('HTML is easy')</code> 等方便比较内容</p>
<p>类似的，还有 <code>beforeEach()</code> 函数在所有测试开始之前执行</p>
<p>可以使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/davidbanham/express-async-errors">express-async-errors</a> 来避免代码中大量出现的 <code>try...catch...</code> 块</p>
<h3 id="用户管理">用户管理</h3>
<p>Mongo 不是关系型数据库，故本身不支持 join 操作，只能自定义模式</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> userSchema = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Schema</span>(&#123;<br>  <span class="hljs-attr">username</span>: <span class="hljs-title class_">String</span>,<br>  <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>,<br>  <span class="hljs-attr">passwordHash</span>: <span class="hljs-title class_">String</span>,<br>  <span class="hljs-attr">notes</span>: [<br>    &#123;<br>      <span class="hljs-attr">type</span>: mongoose.<span class="hljs-property">Schema</span>.<span class="hljs-property">Types</span>.<span class="hljs-property">ObjectId</span>,<br>      <span class="hljs-attr">ref</span>: <span class="hljs-string">&#x27;Note&#x27;</span>,<br>    &#125;,<br>  ],<br>&#125;);<br></code></pre></td></tr></table></figure>
<p>另一边类似的</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> noteSchema = <span class="hljs-keyword">new</span> mongoose.<span class="hljs-title class_">Schema</span>(&#123;<br>  <span class="hljs-attr">content</span>: &#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,<br>    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">minlength</span>: <span class="hljs-number">5</span>,<br>  &#125;,<br>  <span class="hljs-attr">date</span>: <span class="hljs-title class_">Date</span>,<br>  <span class="hljs-attr">important</span>: <span class="hljs-title class_">Boolean</span>,<br><br>  <span class="hljs-attr">user</span>: &#123;<br>    <span class="hljs-attr">type</span>: mongoose.<span class="hljs-property">Schema</span>.<span class="hljs-property">Types</span>.<span class="hljs-property">ObjectId</span>,<br>    <span class="hljs-attr">ref</span>: <span class="hljs-string">&#x27;User&#x27;</span>,<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>
<p>安装 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/kelektiv/node.bcrypt.js">bcrypt</a> 软件包来生成密码散列：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> saltRounds = <span class="hljs-number">10</span>;<br><span class="hljs-keyword">const</span> passwordHash = <span class="hljs-keyword">await</span> bcrypt.<span class="hljs-title function_">hash</span>(password, saltRounds);<br></code></pre></td></tr></table></figure>
<p>使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/mongoose-unique-validator/mongoose-unique-validator">mongoose-unique-validator</a> 包来实现唯一性检查</p>
<p>Mongoose 库实现了集合之间的连接</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> users = <span class="hljs-keyword">await</span> <span class="hljs-title class_">User</span>.<span class="hljs-title function_">find</span>(&#123;&#125;).<span class="hljs-title function_">populate</span>(<span class="hljs-string">&#x27;notes&#x27;</span>);<br></code></pre></td></tr></table></figure>
<h3 id="密钥认证">密钥认证</h3>
<p>在后台实现基于令牌的认证的支持</p>
<p>安装 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/auth0/node-jsonwebtoken">jsonwebtoken</a> 库</p>
<p>登录功能的代码放在 <code>controllers/login.js</code> 文件中</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;jsonwebtoken&#x27;</span>);<br><span class="hljs-keyword">const</span> bcrypt = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;bcrypt&#x27;</span>);<br><span class="hljs-keyword">const</span> loginRouter = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>).<span class="hljs-title class_">Router</span>();<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">User</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../models/user&#x27;</span>);<br><br>loginRouter.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-keyword">async</span> (request, response) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> &#123; username, password &#125; = request.<span class="hljs-property">body</span>;<br><br>  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title class_">User</span>.<span class="hljs-title function_">findOne</span>(&#123; username &#125;);<br>  <span class="hljs-keyword">const</span> passwordCorrect =<br>    user === <span class="hljs-literal">null</span> ? <span class="hljs-literal">false</span> : <span class="hljs-keyword">await</span> bcrypt.<span class="hljs-title function_">compare</span>(password, user.<span class="hljs-property">passwordHash</span>);<br><br>  <span class="hljs-keyword">if</span> (!(user &amp;&amp; passwordCorrect))<br>    <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">status</span>(<span class="hljs-number">401</span>).<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">error</span>: <span class="hljs-string">&#x27;invalid username or password&#x27;</span> &#125;);<br><br>  <span class="hljs-keyword">const</span> userForToken = &#123; <span class="hljs-attr">username</span>: user.<span class="hljs-property">username</span>, <span class="hljs-attr">id</span>: user.<span class="hljs-property">_id</span> &#125;;<br><br>  <span class="hljs-keyword">const</span> token = jwt.<span class="hljs-title function_">sign</span>(<br>    userForToken,<br>    process.<span class="hljs-property">env</span>.<span class="hljs-property">SECRET</span>,<br>    &#123; <span class="hljs-attr">expiresIn</span>: <span class="hljs-number">60</span> * <span class="hljs-number">60</span> &#125; <span class="hljs-comment">// 一个小时过期</span><br>  );<br><br>  response<br>    .<span class="hljs-title function_">status</span>(<span class="hljs-number">200</span>)<br>    .<span class="hljs-title function_">send</span>(&#123; token, <span class="hljs-attr">username</span>: user.<span class="hljs-property">username</span>, <span class="hljs-attr">name</span>: user.<span class="hljs-property">name</span> &#125;);<br>&#125;);<br><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = loginRouter;<br></code></pre></td></tr></table></figure>
<p>将令牌从浏览器发送到服务器要使用授权头，有几种认证方案，这里使用 Bearer 方案，检验的方法是：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> jwt = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;jsonwebtoken&#x27;</span>)<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">getTokenFrom</span> = request =&gt; &#123;<br>  <span class="hljs-keyword">const</span> authorization = request.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;authorization&#x27;</span>)<br>  <span class="hljs-keyword">if</span> (authorization &amp;&amp; authorization.<span class="hljs-title function_">toLowerCase</span>().<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">&#x27;bearer &#x27;</span>)) &#123;<br>    <span class="hljs-keyword">return</span> authorization.<span class="hljs-title function_">substring</span>(<span class="hljs-number">7</span>)<br>  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span><br>&#125;<br><br>notesRouter.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-keyword">async</span> (request, response) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> body = request.<span class="hljs-property">body</span><br>  <span class="hljs-keyword">const</span> token = <span class="hljs-title function_">getTokenFrom</span>(request)<br>  <span class="hljs-keyword">const</span> decodedToken = jwt.<span class="hljs-title function_">verify</span>(token, process.<span class="hljs-property">env</span>.<span class="hljs-property">SECRET</span>)<br>  <span class="hljs-keyword">if</span> (!decodedToken.<span class="hljs-property">id</span>) &#123; <span class="hljs-keyword">return</span> response.<span class="hljs-title function_">status</span>(<span class="hljs-number">401</span>).<span class="hljs-title function_">json</span>(&#123; <span class="hljs-attr">error</span>: <span class="hljs-string">&#x27;token missing or invalid&#x27;</span> &#125;) &#125;<br>  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title class_">User</span>.<span class="hljs-title function_">findById</span>(decodedToken.<span class="hljs-property">id</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>
<p>发送要加上头：</p>
<figure class="highlight http"><table><tr><td class="code"><pre><code class="hljs http"><span class="hljs-attribute">Authorization</span><span class="hljs-punctuation">: </span>Bearer eyJhbGciOiJIUzI1NiIsInR5c2VybmFtZSI6Im1sdXVra2FpIiwiaW<br></code></pre></td></tr></table></figure>
<h2 id="测试-React-应用">测试 React 应用</h2>
<h3 id="完成前台的登录功能">完成前台的登录功能</h3>
<p>有条件地渲染登录窗口和笔记窗口：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js">&#123;<br>  user === <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-title function_">loginForm</span>();<br>&#125;<br>&#123;<br>  user !== <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-title function_">noteForm</span>();<br>&#125;<br></code></pre></td></tr></table></figure>
<p>登录成功的用户信息储存在 token 中，故 noteService 模块中应添加</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">let</span> token = <span class="hljs-literal">null</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">setToken</span> = (<span class="hljs-params">newToken</span>) =&gt; &#123;<br>  token = <span class="hljs-string">`bearer <span class="hljs-subst">$&#123;newToken&#125;</span>`</span>;<br>&#125;;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">create</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">newObject</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> config = &#123; <span class="hljs-attr">headers</span>: &#123; <span class="hljs-title class_">Authorization</span>: token &#125; &#125;;<br>  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(baseUrl, newObject, config);<br>  <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>;<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>每次刷新后用户信息就消失了，可以通过将登录信息保存到本地存储中解决：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&#x27;loggedNoteappUser&#x27;</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(user));<br></code></pre></td></tr></table></figure>
<p>使用<strong>效果钩子</strong>在进入页面时查找本地存储</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> loggedUserJSON = <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&#x27;loggedNoteappUser&#x27;</span>);<br>  <span class="hljs-keyword">if</span> (loggedUserJSON) &#123;<br>    <span class="hljs-keyword">const</span> user = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(loggedUserJSON);<br>    <span class="hljs-title function_">setUser</span>(user);<br>    noteService.<span class="hljs-title function_">setToken</span>(user.<span class="hljs-property">token</span>);<br>  &#125;<br>&#125;, []);<br></code></pre></td></tr></table></figure>
<h3 id="props-children-与-proptypes">props.children 与 proptypes</h3>
<p>一个可以展开和折叠的组件：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">Togglable</span> = (<span class="hljs-params">props</span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> [visible, setVisible] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);<br>  <span class="hljs-keyword">const</span> hideWhenVisible = &#123; <span class="hljs-attr">display</span>: visible ? <span class="hljs-string">&#x27;none&#x27;</span> : <span class="hljs-string">&#x27;&#x27;</span> &#125;;<br>  <span class="hljs-keyword">const</span> showWhenVisible = &#123; <span class="hljs-attr">display</span>: visible ? <span class="hljs-string">&#x27;&#x27;</span> : <span class="hljs-string">&#x27;none&#x27;</span> &#125;;<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">toggleVisibility</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-title function_">setVisible</span>(!visible);<br>  &#125;;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;hideWhenVisible&#125;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;toggleVisibility&#125;</span>&gt;</span>&#123;props.buttonLabel&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;showWhenVisible&#125;</span>&gt;</span></span><br><span class="language-xml">        &#123;props.children&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">&#123;toggleVisibility&#125;</span>&gt;</span>cancel<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br>  );<br>&#125;;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Togglable</span>;<br></code></pre></td></tr></table></figure>
<p>如果想要在 Togglable 组件之外访问 visible 变量，可以使用 React 的 ref 机制：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; useState, useEffect, useRef &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">const</span> noteFormRef = <span class="hljs-title function_">useRef</span>();<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">noteForm</span> = (<span class="hljs-params"></span>) =&gt; (<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Togglable</span> <span class="hljs-attr">buttonLabel</span>=<span class="hljs-string">&#x27;new note&#x27;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&#123;noteFormRef&#125;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">NoteForm</span> <span class="hljs-attr">createNote</span>=<span class="hljs-string">&#123;addNote&#125;</span> /&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">Togglable</span>&gt;</span></span><br>);<br></code></pre></td></tr></table></figure>
<p>Togglable 组件中：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; useState, forwardRef, useImperativeHandle &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-title class_">Togglable</span> = <span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> &#123;<br>  <span class="hljs-title function_">useImperativeHandle</span>(ref, <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> &#123; toggleVisibility &#125;;<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure>
<p>通过 <code>noteFormRef.current.toggleVisibility()</code> 隐藏表单</p>
<p>可以使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/facebook/prop-types">prop-types</a> 包定义组件的预期和要求，如：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">PropTypes</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;prop-types&#x27;</span><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">Togglable</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> &#123;...&#125;)<br><span class="hljs-title class_">Togglable</span>.<span class="hljs-property">propTypes</span> = &#123; <span class="hljs-attr">buttonLabel</span>: <span class="hljs-title class_">PropTypes</span>.<span class="hljs-property">string</span>.<span class="hljs-property">isRequired</span> &#125;<br></code></pre></td></tr></table></figure>
<h3 id="进行测试-React-应用">进行测试 React 应用</h3>
<p>这里使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://vitest.dev/">Vitest</a> 测试，安装一些有用的测试库：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">npm install --save-vitest vitest jsdom<br>npm install --save-dev @testing-library/react @testing-library/jest-dom<br></code></pre></td></tr></table></figure>
<p>配置测试脚本：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span> <span class="hljs-attr">&quot;test&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;vitest run&quot;</span> <span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>
<p>创建 <code>testSetup.js</code> 的文件，用于重置模拟浏览器的 jsdom：</p>
<figure class="highlight js"><figcaption><span>testSetup.js</span></figcaption><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; afterEach &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vitest&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; cleanup &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@testing-library/react&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;@testing-library/jest-dom/vitest&#x27;</span>;<br><br><span class="hljs-title function_">afterEach</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-title function_">cleanup</span>();<br>&#125;);<br></code></pre></td></tr></table></figure>
<p>将 <code>vite.config.js</code> 文件扩展如下：</p>
<figure class="highlight js"><figcaption><span>vite.config.js</span></figcaption><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(&#123;<br>  <span class="hljs-attr">test</span>: &#123;<br>    <span class="hljs-attr">environment</span>: <span class="hljs-string">&#x27;jsdom&#x27;</span>,<br>    <span class="hljs-attr">globals</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">setupFiles</span>: <span class="hljs-string">&#x27;./testSetup.js&#x27;</span>,<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>
<p>通过设置 <code>globals: true</code> ，我们无需在测试中导入关键字，如 <code>describe</code>、<code>test</code> 和 <code>expect</code>。</p>
<p>测试是否渲染了笔记内容：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; render, screen &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@testing-library/react&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Note</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Note&#x27;</span>;<br><br><span class="hljs-title function_">test</span>(<span class="hljs-string">&#x27;renders content&#x27;</span>, <span class="hljs-function">() =&gt;</span> &#123;<br>  <span class="hljs-keyword">const</span> note = &#123;<br>    <span class="hljs-attr">content</span>: <span class="hljs-string">&#x27;Component testing is done with react-testing-library&#x27;</span>,<br>    <span class="hljs-attr">important</span>: <span class="hljs-literal">true</span>,<br>  &#125;;<br><br>  <span class="hljs-title function_">render</span>(<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Note</span> <span class="hljs-attr">note</span>=<span class="hljs-string">&#123;note&#125;</span> /&gt;</span></span>);<br><br>  <span class="hljs-keyword">const</span> element = screen.<span class="hljs-title function_">getByText</span>(<br>    <span class="hljs-string">&#x27;Component testing is done with react-testing-library&#x27;</span><br>  );<br>  <span class="hljs-title function_">expect</span>(element).<span class="hljs-title function_">toBeDefined</span>();<br>&#125;);<br></code></pre></td></tr></table></figure>
<p><code>screen.debug()</code> 命令可以将一个组件的 HTML 打印到终端</p>
<p>在处理事件时，使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://testing-library.com/docs/user-event/intro">user-event</a> 库：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><code class="hljs shell">npm install --save-dev @testing-library/user-event<br></code></pre></td></tr></table></figure>
<p>事件处理程序是一个用 Jest 定义的 mock 函数</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> mockHandler = vi.<span class="hljs-title function_">fn</span>();<br></code></pre></td></tr></table></figure>
<p>一个 session 被启动以与渲染的组件进行交互。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> user = userEvent.<span class="hljs-title function_">setup</span>();<br></code></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">await</span> user.<span class="hljs-title function_">click</span>(button);<br><span class="hljs-keyword">const</span> button = screen.<span class="hljs-title function_">getByText</span>(<span class="hljs-string">&#x27;make not important&#x27;</span>);<br></code></pre></td></tr></table></figure>
<h3 id="端到端测试">端到端测试</h3>
<p>前面讲的都是单元测试，实际上也可以进行整体测试</p>
<p>使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://playwright.dev/">Playwright</a></p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">describe</span>(<span class="hljs-string">&#x27;Note app&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title function_">it</span>(<span class="hljs-string">&#x27;front page can be opened&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    cy.<span class="hljs-title function_">visit</span>(<span class="hljs-string">&#x27;http://localhost:3000&#x27;</span>);<br>    cy.<span class="hljs-title function_">contains</span>(<span class="hljs-string">&#x27;Notes&#x27;</span>);<br>    cy.<span class="hljs-title function_">contains</span>(<br>      <span class="hljs-string">&#x27;Note app, Department of Computer Science, University of Helsinki 2022&#x27;</span><br>    );<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure>
<p>向窗体中输入信息：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">describe</span>(<span class="hljs-string">&#x27;Note app&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-title function_">it</span>(<span class="hljs-string">&#x27;user can log in&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    cy.<span class="hljs-title function_">contains</span>(<span class="hljs-string">&#x27;login&#x27;</span>).<span class="hljs-title function_">click</span>();<br>    cy.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;#username&#x27;</span>).<span class="hljs-title function_">type</span>(<span class="hljs-string">&#x27;mluukkai&#x27;</span>);<br>    cy.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;#password&#x27;</span>).<span class="hljs-title function_">type</span>(<span class="hljs-string">&#x27;salainen&#x27;</span>);<br>    cy.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;#login-button&#x27;</span>).<span class="hljs-title function_">click</span>();<br>    cy.<span class="hljs-title function_">contains</span>(<span class="hljs-string">&#x27;Matti Luukkainen logged in&#x27;</span>);<br>  &#125;);<br>&#125;);<br></code></pre></td></tr></table></figure>
<h2 id="利用-Redux-进行状态管理">利用 Redux 进行状态管理</h2>
<h3 id="Flux-架构与-Redux">Flux 架构与 Redux</h3>
<p>在 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://redux.js.org/">Redux</a> 中，状态被完全从 React 组件中分离出来，进入它自己的存储</p>
<p>存储器的状态通过动作改变，可以自定义一个动作：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript">&#123;<br>  <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;INCREMENT&#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>动作对应用状态的影响通过 reducer 实现，如：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">counterReducer</span> = (<span class="hljs-params">state = <span class="hljs-number">0</span>, action</span>) =&gt; &#123;<br>  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;INCREMENT&#x27;</span>:<br>      <span class="hljs-keyword">return</span> state + <span class="hljs-number">1</span>;<br>    <span class="hljs-attr">default</span>:<br>      <span class="hljs-keyword">return</span> state;<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>
<p>reducer 作为创建存储的一个参数：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> store = <span class="hljs-title function_">createStore</span>(counterReducer);<br></code></pre></td></tr></table></figure>
<p>操作则使用 <code>dispatch()</code> 方法，如：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript">store.<span class="hljs-title function_">dispatch</span>(&#123; <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;INCREMENT&#x27;</span> &#125;);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(store.<span class="hljs-title function_">getState</span>()); <span class="hljs-comment">// 获取状态</span><br></code></pre></td></tr></table></figure>
<p>注意 reducer 必须是一个<strong>纯函数</strong></p>
<p>让应用能够访问存储的方法：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Provider</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>;<br><br><span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">createRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;root&#x27;</span>)).<span class="hljs-title function_">render</span>(<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Provider</span> <span class="hljs-attr">store</span>=<span class="hljs-string">&#123;store&#125;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">Provider</span>&gt;</span></span><br>);<br></code></pre></td></tr></table></figure>
<p>现在使用 <code>useDispatch()</code> 分派动作，相应的，使用 <code>useSelector</code> 获取数据：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; useSelector, useDispatch &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-redux&#x27;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> dispatch = <span class="hljs-title function_">useDispatch</span>();<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">toggleImportance</span> = (<span class="hljs-params">id</span>) =&gt; &#123;<br>    <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">toggleImportanceOf</span>(id));<br>  &#125;;<br>  <span class="hljs-keyword">const</span> notes = <span class="hljs-title function_">useSelector</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state);<br>&#125;;<br></code></pre></td></tr></table></figure>
<h3 id="再来点-reducers">再来点 reducers</h3>
<p>可以使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://redux-toolkit.js.org/">Redux Toolkit</a> 组合两个 reducer：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> store = <span class="hljs-title function_">configureStore</span>(&#123;<br>  <span class="hljs-attr">reducer</span>: &#123;<br>    <span class="hljs-attr">notes</span>: noteReducer,<br>    <span class="hljs-attr">filter</span>: filterReducer,<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>
<p>用 createSlice 函数创建 reducer 和相应的动作创建器</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> noteSlice = <span class="hljs-title function_">createSlice</span>(&#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;notes&#x27;</span>,<br>  initialState,<br>  <span class="hljs-attr">reducers</span>: &#123;<br>    <span class="hljs-title function_">createNote</span>(<span class="hljs-params">state, action</span>) &#123;<br>      <span class="hljs-keyword">const</span> content = action.<span class="hljs-property">payload</span>;<br>      state.<span class="hljs-title function_">push</span>(&#123;<br>        content,<br>        <span class="hljs-attr">important</span>: <span class="hljs-literal">false</span>,<br>        <span class="hljs-attr">id</span>: <span class="hljs-title function_">generateId</span>(),<br>      &#125;);<br>    &#125;,<br>  &#125;,<br>&#125;);<br></code></pre></td></tr></table></figure>
<p>注意到 <code>state</code> 可变了</p>
<h3 id="在-Redux-应用中与后端通信">在 Redux 应用中与后端通信</h3>
<p>使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/reduxjs/redux-thunk">Redux Thunk</a> 库来实现动作</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">initializeNotes</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span> (dispatch) =&gt; &#123;<br>    <span class="hljs-keyword">const</span> notes = <span class="hljs-keyword">await</span> noteService.<span class="hljs-title function_">getAll</span>();<br>    <span class="hljs-title function_">dispatch</span>(<span class="hljs-title function_">setNotes</span>(notes));<br>  &#125;;<br>&#125;;<br></code></pre></td></tr></table></figure>
<h3 id="React-Query，useReducer-和-context">React Query，useReducer 和 context</h3>
<p>用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://tanstack.com/query/latest/docs/react/">React Query</a> 存储并管理从服务器检索的数据</p>
<p>将这个库中的函数传递给整个应用：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">QueryClient</span>, <span class="hljs-title class_">QueryClientProvider</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-query&#x27;</span>;<br><span class="hljs-keyword">const</span> queryClient = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryClient</span>();<br><span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">createRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;root&#x27;</span>)).<span class="hljs-title function_">render</span>(<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">QueryClientProvider</span> <span class="hljs-attr">client</span>=<span class="hljs-string">&#123;queryClient&#125;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">QueryClientProvider</span>&gt;</span></span><br>);<br></code></pre></td></tr></table></figure>
<p>获取方法：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> result = <span class="hljs-title function_">useQuery</span>(<span class="hljs-string">&#x27;notes&#x27;</span>, <span class="hljs-function">() =&gt;</span><br>  axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;http://localhost:3001/notes&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> res.<span class="hljs-property">data</span>)<br>);<br></code></pre></td></tr></table></figure>
<p>使用 mutation 创建新笔记并在本地插入：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">const</span> newNoteMutation = <span class="hljs-title function_">useMutation</span>(createNote, &#123;<br>    <span class="hljs-attr">onSuccess</span>: <span class="hljs-function">(<span class="hljs-params">newNote</span>) =&gt;</span> &#123;<br>      <span class="hljs-keyword">const</span> notes = queryClient.<span class="hljs-title function_">getQueryData</span>(<span class="hljs-string">&#x27;notes&#x27;</span>);<br>      queryClient.<span class="hljs-title function_">setQueryData</span>(<span class="hljs-string">&#x27;notes&#x27;</span>, notes.<span class="hljs-title function_">concat</span>(newNote));<br>    &#125;,<br>  &#125;);<br>&#125;;<br></code></pre></td></tr></table></figure>
<p><code>useReducer</code> 提供了为应用创建状态的机制：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> [counter, counterDispatch] = <span class="hljs-title function_">useReducer</span>(counterReducer, <span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure>
<p>使用 <code>createContext()</code> 创建 context，这样就不需要层层传递给各组件了：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><code class="hljs js">&lt;<span class="hljs-title class_">CounterContext</span>.<span class="hljs-property">Provider</span> value=&#123;[counter, counterDispatch]&#125;&gt;<br>  ...<br>&lt;/<span class="hljs-title class_">CounterContext</span>.<span class="hljs-property">Provider</span>&gt;<br></code></pre></td></tr></table></figure>
<p>其他组件可以使用 <code>useContext</code> 访问</p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%B5%AB%E5%B0%94%E8%BE%9B%E5%9F%BA%E5%A4%A7%E5%AD%A6/">赫尔辛基大学</a><a class="post-meta__tags" href="/tags/web/">web</a></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/cc1b9611.html" title="JavaScript"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/JavaScript.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">JavaScript</div></div><div class="info-2"><div class="info-item-1">写在最前 基于 Marijn Haverbeke 的 Eloquent JavaScript 编写 JavaScript 和 Java 没有任何关系，这个名字是为了蹭 Java 的热度 console.log(&#x27;Hello, world!&#x27;); VSCode 开发环境配置 JavaScript/TypeScript + React 原生支持（毕竟 VS Code 就是用 TypeScript 编写的，所有的扩展都是用 JS 写的，但可以添加一些提高开发效率的代码片段 JavaScript (ES6) code snippets 支持 JS/TS，JSX/TSX，html 等 摘录一些常用的： 导入与导出：    触发方式 功能 示例     imp 导入整个模块 import fs from 'fs';   imn 匿名模块导入 import 'animate.css'   imd 使用解构导入 import &#123;rename&#125; from 'fs';   rqr 需要包 require('');   req 以 const...</div></div></div></a><a class="pagination-related" href="/posts/13aafbc3.html" title="包管理器"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">包管理器</div></div><div class="info-2"><div class="info-item-1">Python 包管理器——uv uv 是一个用于管理 Python 虚拟环境的工具，特点在于速度快 替换为阿里源： 在 ~/.config/uv/uv.toml（Linux）或 %APPDATA%\uv\uv.toml（Windows）中添加如下内容： [[index]]    url    =&quot;https://mirrors.aliyun.com/pypi/simple/&quot;    default=true project 管理：  创建新的项目：uv init &lt;project_name&gt; 向项目中添加新的包：uv add &lt;package_name&gt; 移除：uv remove &lt;package_name&gt; 运行某个脚本：uv run path/to/script.py 运行一条命令：uv run &quot;command&quot; 使用指定的环境变量文件运行：uv run --env-file .env script.py  Python 版本管理：  安装指定版本：uv install python...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="iconfont icon-tuijian"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/posts/e5d89884.html" title="全栈公开课（第二部分）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/%E5%85%A8%E6%A0%88%E5%85%AC%E5%BC%80%E8%AF%BE%EF%BC%88%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%EF%BC%89.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-03</div><div class="info-item-2">全栈公开课（第二部分）</div></div><div class="info-2"><div class="info-item-1">React router、自定义 hook，利用 CSS 和 webpack 给 app 添加样式 React-router 使用 React Router 库生成导航栏： import &#123; BrowserRouter as Router, Routes, Route, Link &#125; from &#x27;react-router-dom&#x27;;const App = () =&gt; &#123;  const padding = &#123;    padding: 5,  &#125;;  return (    &lt;Router&gt;      &lt;div&gt;        &lt;Link style=&#123;padding&#125; to=&#x27;/&#x27;&gt;          home        &lt;/Link&gt;        &lt;Link style=&#123;padding&#125; to=&#x27;/notes&#x27;&gt;          notes       ...</div></div></div></a><a class="pagination-related" href="/posts/5dc45f0c.html" title="Jupyter Notebook 学习笔记"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/Jupyter%20Notebook%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-16</div><div class="info-item-2">Jupyter Notebook 学习笔记</div></div><div class="info-2"><div class="info-item-1">什么是 Jupyter Notebook  Jupyter Notebook 是基于网页的用于交互计算的应用程序。其可被应用于全过程计算：开发、文档编写、运行代码和展示结果。——Jupyter Notebook 官方介绍  所以简单来说就是以网页形式打开，可以在其中直接编写并运行代码，代码的运行结果也会直接显示在代码块下，同时说明文档也可以直接编写在下面，支持 markdown增强版博客 组成部分：  网页应用 文档  安装和启动 一般搭配 Anaconda 使用，一般来说安装后已经自动安装了 Jupyter Notebook 了。若没有，可以手动安装： conda install notebook 运行： jupyter notebook 该命令以默认端口（8888）启动，若被占用，则顺延至 8889 等。同时浏览器自动访问该网址 注意：终端不要关闭，否则会断开与本地服务器的连接 当然也可以用 --port xxxx 指定 xxxx 端口启动，也可以添加 --no-browser 参数不打开浏览器 设置 Jupyter Notebook...</div></div></div></a><a class="pagination-related" href="/posts/cc1b9611.html" title="JavaScript"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/JavaScript.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-25</div><div class="info-item-2">JavaScript</div></div><div class="info-2"><div class="info-item-1">写在最前 基于 Marijn Haverbeke 的 Eloquent JavaScript 编写 JavaScript 和 Java 没有任何关系，这个名字是为了蹭 Java 的热度 console.log(&#x27;Hello, world!&#x27;); VSCode 开发环境配置 JavaScript/TypeScript + React 原生支持（毕竟 VS Code 就是用 TypeScript 编写的，所有的扩展都是用 JS 写的，但可以添加一些提高开发效率的代码片段 JavaScript (ES6) code snippets 支持 JS/TS，JSX/TSX，html 等 摘录一些常用的： 导入与导出：    触发方式 功能 示例     imp 导入整个模块 import fs from 'fs';   imn 匿名模块导入 import 'animate.css'   imd 使用解构导入 import &#123;rename&#125; from 'fs';   rqr 需要包 require('');   req 以 const...</div></div></div></a><a class="pagination-related" href="/posts/a541262a.html" title="Spring Boot"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/Spring%20Boot.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-17</div><div class="info-item-2">Spring Boot</div></div><div class="info-2"><div class="info-item-1">Maven Maven 可以用于管理 Java 项目的依赖 在 pom.xml 文件中指定了 Maven 坐标，其构成如下：  groupId：通常是域名反写 artifactId：通常是模块名称 version：版本号  引入依赖：在 &lt;dependencies&gt; 标签下，使用 &lt;dependency&gt; 引入标签，并定义 Maven 坐标 依赖有传递性，可以使用 &lt;exclusion&gt; 手动排除依赖的资源 使用 &lt;scope&gt; 设置其作用范围，通常使用默认的和 &lt;test&gt; Maven 有 3 套独立的生命周期：  clean default：编译、测试、打包、部署等 site：生成报告、发布站点  可以手动执行其中的若干个生命周期 请求与响应 Tomcat 是一个轻量级的 web 服务器，支持 Servlet 规范 几种请求参数： 简单参数：名字一致，也可以使用一个对象接收多个参数 GET...</div></div></div></a><a class="pagination-related" href="/posts/76f4d2c5.html" title="Svelte"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/Svelte.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-18</div><div class="info-item-2">Svelte</div></div><div class="info-2"><div class="info-item-1">Svelte 是一个最近越来越流行的前端库 安装 快速开始： bunx sv create my-app 调试运行： bun --bun run dev 如果想要构建的话，需要修改适配器：bun add -D svelte-adapter-bun 修改 svelte.config.js： import adapter from &quot;svelte-adapter-bun&quot;; 构建： bun --bun run build 基础 &lt;script lang=&quot;ts&quot;&gt;	let name = &#x27;Svelte&#x27;;&lt;/script&gt;&lt;p&gt;Hello &#123;name&#125;!&lt;/p&gt;&lt;style&gt;	p &#123;		color: goldenrod;		font-family: &#x27;Comic Sans MS&#x27;, cursive;		font-size:...</div></div></div></a><a class="pagination-related" href="/posts/13aafbc3.html" title="包管理器"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-31</div><div class="info-item-2">包管理器</div></div><div class="info-2"><div class="info-item-1">Python 包管理器——uv uv 是一个用于管理 Python 虚拟环境的工具，特点在于速度快 替换为阿里源： 在 ~/.config/uv/uv.toml（Linux）或 %APPDATA%\uv\uv.toml（Windows）中添加如下内容： [[index]]    url    =&quot;https://mirrors.aliyun.com/pypi/simple/&quot;    default=true project 管理：  创建新的项目：uv init &lt;project_name&gt; 向项目中添加新的包：uv add &lt;package_name&gt; 移除：uv remove &lt;package_name&gt; 运行某个脚本：uv run path/to/script.py 运行一条命令：uv run &quot;command&quot; 使用指定的环境变量文件运行：uv run --env-file .env script.py  Python 版本管理：  安装指定版本：uv install python...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/illustration/%E5%A4%B4%E5%83%8F_%E7%81%B0%E5%A4%AA%E7%8B%BC.webp" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Aefrivern</div><div class="author-info-description">我一定会回来的</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">187</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">243</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/aefrivern" rel="external nofollow noreferrer" target="_blank" title="icon-github"><i class="GitHub"></i></a><a class="social-icon" href="mailto:2771503468@qq.com" rel="external nofollow noreferrer" target="_blank" title="icon-youxiang"><i class="QQ邮箱"></i></a><a class="social-icon" href="https://steamcommunity.com/id/old_driver_zero" rel="external nofollow noreferrer" target="_blank" title="icon-steam"><i class="Steam"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><a class="faa-parent animated-hover"><svg class="faa-tada icon" style="height:25px;width:25px;fill:currentColor;position:relative;top:5px" aria-hidden="true"><use xlink:href="#icon-mulu"></use></svg></a><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-app-%E5%9F%BA%E7%A1%80"><span class="toc-number">1.</span> <span class="toc-text">Web app 基础</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#React-%E5%85%A5%E9%97%A8"><span class="toc-number">2.</span> <span class="toc-text">React 入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#React-%E7%AE%80%E4%BB%8B"><span class="toc-number">2.1.</span> <span class="toc-text">React 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E7%8A%B6%E6%80%81%EF%BC%8C%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86"><span class="toc-number">2.2.</span> <span class="toc-text">组件状态，事件处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5-React-%E5%BA%94%E7%94%A8%E8%B0%83%E8%AF%95"><span class="toc-number">2.3.</span> <span class="toc-text">深入 React 应用调试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8E%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%80%9A%E4%BF%A1"><span class="toc-number">3.</span> <span class="toc-text">与服务端通信</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E6%B8%B2%E6%9F%93%E9%9B%86%E5%90%88%E5%88%B0%E6%A8%A1%E5%9D%97%E5%AD%A6%E4%B9%A0"><span class="toc-number">3.1.</span> <span class="toc-text">从渲染集合到模块学习</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E5%8D%95"><span class="toc-number">3.2.</span> <span class="toc-text">表单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-number">3.3.</span> <span class="toc-text">从服务器获取数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%B0%86%E6%95%B0%E6%8D%AE-Alert-%E5%87%BA%E6%9D%A5"><span class="toc-number">3.4.</span> <span class="toc-text">在服务端将数据 Alert 出来</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%99-React-%E5%BA%94%E7%94%A8%E5%8A%A0%E7%82%B9%E6%A0%B7%E5%BC%8F"><span class="toc-number">3.5.</span> <span class="toc-text">给 React 应用加点样式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8-NodeJS-%E5%92%8C-Express-%E5%86%99%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%A8%8B%E5%BA%8F"><span class="toc-number">4.</span> <span class="toc-text">用 NodeJS 和 Express 写服务端程序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Node-js-%E4%B8%8E-Express"><span class="toc-number">4.1.</span> <span class="toc-text">Node.js 与 Express</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%8A%E5%BA%94%E7%94%A8%E9%83%A8%E7%BD%B2%E5%88%B0%E7%BD%91%E4%B8%8A"><span class="toc-number">4.2.</span> <span class="toc-text">把应用部署到网上</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E6%95%B0%E6%8D%AE%E5%AD%98%E5%85%A5-MongoDB"><span class="toc-number">4.3.</span> <span class="toc-text">将数据存入 MongoDB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ESLint-%E4%B8%8E%E4%BB%A3%E7%A0%81%E6%A3%80%E6%9F%A5"><span class="toc-number">4.4.</span> <span class="toc-text">ESLint 与代码检查</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-Express-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%A8%8B%E5%BA%8F-%E4%BB%A5%E5%8F%8A%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="toc-number">5.</span> <span class="toc-text">测试 Express 服务端程序, 以及用户管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%90%8E%E7%AB%AF%E7%BB%93%E6%9E%84%E5%88%B0%E6%B5%8B%E8%AF%95%E5%85%A5%E9%97%A8"><span class="toc-number">5.1.</span> <span class="toc-text">从后端结构到测试入门</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E5%90%8E%E7%AB%AF%E5%BA%94%E7%94%A8"><span class="toc-number">5.2.</span> <span class="toc-text">测试后端应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="toc-number">5.3.</span> <span class="toc-text">用户管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%86%E9%92%A5%E8%AE%A4%E8%AF%81"><span class="toc-number">5.4.</span> <span class="toc-text">密钥认证</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-React-%E5%BA%94%E7%94%A8"><span class="toc-number">6.</span> <span class="toc-text">测试 React 应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E6%88%90%E5%89%8D%E5%8F%B0%E7%9A%84%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="toc-number">6.1.</span> <span class="toc-text">完成前台的登录功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#props-children-%E4%B8%8E-proptypes"><span class="toc-number">6.2.</span> <span class="toc-text">props.children 与 proptypes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95-React-%E5%BA%94%E7%94%A8"><span class="toc-number">6.3.</span> <span class="toc-text">进行测试 React 应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%AF%E5%88%B0%E7%AB%AF%E6%B5%8B%E8%AF%95"><span class="toc-number">6.4.</span> <span class="toc-text">端到端测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8-Redux-%E8%BF%9B%E8%A1%8C%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86"><span class="toc-number">7.</span> <span class="toc-text">利用 Redux 进行状态管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Flux-%E6%9E%B6%E6%9E%84%E4%B8%8E-Redux"><span class="toc-number">7.1.</span> <span class="toc-text">Flux 架构与 Redux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%8D%E6%9D%A5%E7%82%B9-reducers"><span class="toc-number">7.2.</span> <span class="toc-text">再来点 reducers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8-Redux-%E5%BA%94%E7%94%A8%E4%B8%AD%E4%B8%8E%E5%90%8E%E7%AB%AF%E9%80%9A%E4%BF%A1"><span class="toc-number">7.3.</span> <span class="toc-text">在 Redux 应用中与后端通信</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#React-Query%EF%BC%8CuseReducer-%E5%92%8C-context"><span class="toc-number">7.4.</span> <span class="toc-text">React Query，useReducer 和 context</span></a></li></ol></li></ol></div></div><div class="card-widget card-post-series"><div class="item-headline"><svg class="meta_icon post-ui-icon" style="width:25px;height:25px;position:relative;top:5px"><use xlink:href="#icon-a-layergroup"></use></svg><span>系列文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/e5d89884.html" title="全栈公开课（第二部分）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/%E5%85%A8%E6%A0%88%E5%85%AC%E5%BC%80%E8%AF%BE%EF%BC%88%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%EF%BC%89.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="全栈公开课（第二部分）"></a><div class="content"><a class="title" href="/posts/e5d89884.html" title="全栈公开课（第二部分）">全栈公开课（第二部分）</a><time datetime="2024-01-03T00:17:22.000Z" title="发表于 2024-01-03 08:17:22">2024-01-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/320cf12b.html" title="全栈公开课（第一部分）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/gallery/cover/%E5%85%A8%E6%A0%88%E5%85%AC%E5%BC%80%E8%AF%BE%EF%BC%88%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%89.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="全栈公开课（第一部分）"></a><div class="content"><a class="title" href="/posts/320cf12b.html" title="全栈公开课（第一部分）">全栈公开课（第一部分）</a><time datetime="2023-12-27T00:17:22.000Z" title="发表于 2023-12-27 08:17:22">2023-12-27</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="ft"><div class="ft-item-1"><div class="t-top"><div class="t-t-l"><p class="ft-t t-l-t">格言🧬</p><div class="bg-ad"><div>安得广厦千万间，大庇天下寒士俱欢颜，风雨不动安如山。</div></div></div><div class="t-t-r"><p class="ft-t t-l-t">猜你想看💡</p><ul class="ft-links"><li><a href="/comments/">留点什么</a><a href="/random/">随便逛逛</a></li><li><a href="/about/">关于</a><a href="/archives/">文章归档</a></li><li><a href="/categories/">文章分类</a><a href="/tags/">文章标签</a></li><li><a href="/gallery/">我的画廊</a><a href="/charts/">网站统计</a></li></ul></div></div></div></div><div class="copyright">&copy;2022 - 2025 By Aefrivern</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"></div><script async src="//at.alicdn.com/t/c/font_4031045_1yiosqv4vch.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#web_bg",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      window.location.href = e.request.responseURL
    }
  })
})()</script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/lite/builds/browser.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script></div></div><!-- hexo injector body_end start --><script async src="//at.alicdn.com/t/c/font_4031045_izvon5l4fr8.js"></script><!-- hexo injector body_end end --></body></html>